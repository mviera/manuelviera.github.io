
<head>
    <meta charset="utf-8">

    <title>Empezando con MongoDB Part.II</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="../index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Manuel Viera">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Empezando con MongoDB Part.II">
    <meta property="og:description" content="En mi anterior post hablaba sobre cómo empezar con MongoDB, una base de datos NoSQL orientada a documentos; y como sigo estudiándola y me parece interesante, me gustaría seguir compartiendo y profundizando sobre el uso de MongoDB, así que he decidido escribir una segunda parte de este anterior post.  El">
    <meta property="og:url" content="http://manuelviera.com/blog/empezando-con-mongodb-part-ii/">
    <meta property="article:published_time" content="2013-03-02T00:00:00.000Z">
    <meta property="article:modified_time" content="2020-06-14T15:55:30.000Z">
    <meta property="article:tag" content="tech">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Empezando con MongoDB Part.II">
    <meta name="twitter:description" content="En mi anterior post hablaba sobre cómo empezar con MongoDB, una base de datos NoSQL orientada a documentos; y como sigo estudiándola y me parece interesante, me gustaría seguir compartiendo y profundizando sobre el uso de MongoDB, así que he decidido escribir una segunda parte de este anterior post.  El">
    <meta name="twitter:url" content="http://manuelviera.com/blog/empezando-con-mongodb-part-ii/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Manuel Viera">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="tech">
    <meta name="twitter:site" content="@mviera">
    <meta name="twitter:creator" content="@mviera">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Manuel Viera",
        "url": "http://manuelviera.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "http://manuelviera.com/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Manuel Viera",
        "image": {
            "@type": "ImageObject",
            "url": "http://manuelviera.com/content/images/2020/06/2020-06-22-161222_428x430_scrot.png",
            "width": 428,
            "height": 430
        },
        "url": "http://manuelviera.com/author/mviera/",
        "sameAs": [
            "https://manuelviera.com",
            "https://twitter.com/mviera"
        ]
    },
    "headline": "Empezando con MongoDB Part.II",
    "url": "http://manuelviera.com/blog/empezando-con-mongodb-part-ii/",
    "datePublished": "2013-03-02T00:00:00.000Z",
    "dateModified": "2020-06-14T15:55:30.000Z",
    "keywords": "tech",
    "description": "En mi anterior post [/blog/empezando-con-mongodb/] hablaba sobre cómo empezar\ncon MongoDB [/blog/empezando-con-mongodb/], una base de datos NoSQL orientada a\ndocumentos; y como sigo estudiándola y me parece interesante, me gustaría seguir\ncompartiendo y profundizando sobre el uso de MongoDB, así que he decidido\nescribir una segunda parte de este anterior post.\n\nEl objetivo de este post es bien sencillo. Cubrirá las operaciones principales\nbásicas de MongoDB, también conocidas como operaciones CR",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://manuelviera.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.19">
    <link rel="alternate" type="application/rss+xml" title="Manuel Viera" href="../../rss/index.html">

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,600,400">
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather",serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans",sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata,monospace,sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata,monospace,sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0,0,0,0.2),0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans",sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans",sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans",sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-image img{object-fit:cover;}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans",sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../../">Manuel Viera</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Empezando con MongoDB Part.II</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../../author/mviera/">Manuel Viera</a></p>
                    <time class="post-date" datetime="2013-03-02">2013-03-02</time>
                </section>
            </header>
            <section class="post-content">

                <p>En mi <a href="../../empezando-con-mongodb/">anterior post</a> hablaba sobre <a href="../../empezando-con-mongodb/">cómo empezar con MongoDB</a>, una base de datos NoSQL orientada a documentos; y como sigo estudiándola y me parece interesante, me gustaría seguir compartiendo y profundizando sobre el uso de MongoDB, así que he decidido escribir una segunda parte de este anterior post.</p>
<p>El objetivo de este post es bien sencillo. Cubrirá las operaciones principales básicas de MongoDB, también conocidas como operaciones <strong>CRUD</strong>, que significa <strong>C</strong> reate, <strong>R</strong> ead, <strong>U</strong> pdate y <strong>D</strong> elete. ¡Así que empecemos con ello!</p>

<p>Antes de nada empezaremos recordando cómo iniciar nuestra base de datos<br>
utilizando el comando <code>mongod</code>. Recordad que debemos especificar la ruta donde se almacenará la base de datos utilizando el parámetro <code>--dbpath</code>. Dicho esto, podremos ejecutar una instrucción como la siguiente:</p>
<pre><code>$ mongod --dbpath test
</code></pre>
<p>En este caso he utilizado un directorio llamado <em>test</em> donde alojaré esta base de datos de pruebas. Apuntar que al no especificar un puerto con el parámetro <code>--port</code>, la instancia de <code>mongod</code> utilizará el puerto <code>27017</code> por defecto.</p>
<p>Esta instrucción tiene un "inconveniente" y es que no podremos seguir<br>
utilizando nuestra consola actual, pues la ejecución de <code>mongod</code> se realiza en primer plano, o <em>foreground</em>. Para evitar esto podemos hacer uso del parámetro <code>--fork</code> que creará un <em>fork</em> del proceso del servidor permitiendo poder seguir utilizando nuestra consola. La opción <code>--fork</code> requiere que se especifique además un fichero de log utilizando el parámetro <code>--logpath</code> o <code>--syslog</code>, así que la instrucción quedaría de la siguiente forma:</p>
<pre><code>$ mongod --dbpath test --logappend --logpath test.log --fork
forked process: 10017
all output going to: /home/mviera/Downloads/mongodb/test.log
child process started successfully, parent exiting
</code></pre>
<p><strong>Nota:</strong> Además he utilizado la opción <code>--logappend</code> para evitar que<br>
sobrescriba el contenido del fichero de log. En este caso seguirá concatenando datos al contenido actual del fichero.</p>
<p>Una vez funcionando nuestra instancia de <code>mongod</code>, podemos conectarnos a la<br>
consola utilizando el comando <code>mongo</code> de la siguiente forma:</p>
<pre><code>$ mongo
MongoDB shell version: 2.2.3
connecting to: test
&gt;
</code></pre>
<p><strong>Nota:</strong> No es necesario especificar el puerto porque se está utilizando  el puerto por defecto (<code>27017</code>).</p>
<p>Todo listo, así que ¡empecemos a crear documentos!</p>
<h2 id="introduciendocontenido">Introduciendo contenido</h2>
<p>Seguro que muchos ya os imagináis cómo se realiza este tipo de operación básica en una base de datos SQL como MySQL, PosgreSQL, SQLite, etc; pero en MongoDB se realiza de una forma muy diferente, por lo menos referente a cómo se realiza en una base de datos SQL.</p>
<p>Una inserción de datos sencilla en SQL podría ser de la siguiente forma:</p>
<pre><code>INSERT INTO users (firstName, lastName, username, age, city)
VALUES ('Manuel', 'Viera', 'mviera', 26, 'Sevilla');
</code></pre>
<p>En MongoDB es completamente diferente. En mi anterior post ya traté rápidamente las inserciones y si recordáis, comentaba que MongoDB está orientado a documentos y que estos documentos siguen el estilo JSON (JavaScript Object Notation).</p>
<p>Para realizar una inserción en MongoDB utilizaremos el método <code>insert()</code> al que llamaremos pasándole como parámetro el documento a introducir, el cual,<br>
siguiendo el ejemplo anterior, sería representado en formato JSON de la<br>
siguiente forma:</p>
<pre><code>{
  "firstName" : "Manuel",
  "lastName" : "Viera",
  "username" : "mviera",
  "age" : 26,
  "city" : "Sevilla"
}
</code></pre>
<p>Recordad también que en MongoDB los documentos se almacenan en colecciones (o <em>collections</em> en inglés), así que para seguir con el ejemplo introduciremos este documento en una colección llamada <code>users</code>.</p>
<pre><code>&gt; db.users.insert({
 firstName: "Manuel",
 lastName: "Viera",
 username: "mviera",
 age: 26,
 city: "Sevilla"
 })
</code></pre>
<p>Bien. ¿Qué tenemos hasta ahora? Por defecto cuando nos conectamos a una<br>
instancia MongoDB sin especificar una base de datos, se utilizará por defecto <code>test</code>. Así que hemos creado un documento dentro de la colección <code>users</code> en la base de datos <code>test</code>.</p>
<p><strong>Nota:</strong> A modo de recordatorio, no es necesario crear previamente la<br>
colección antes de introducir documentos. MongoDB lo hará por nosotros<br>
automáticamente si la colección no existe.</p>
<p>¿Pero cómo recuperamos los datos introducidos?</p>
<h2 id="recuperandolosdocumentos">Recuperando los documentos</h2>
<p>Para seleccionar, buscar, encontrar documentos dentro de nuestra colección<br>
utilizaremos uno de los siguientes métodos:</p>
<ul>
<li><code>find()</code> : que devolverá un cursor con todos los documentos recuperados de la base de datos.</li>
<li><code>findOne()</code> : que devuelve solamente un documento.</li>
</ul>
<p>El uso de <code>find()</code> es muy sencillo, como podéis ver a continuación:</p>
<pre><code>&gt; db.users.find()
{ "_id" : ObjectId("5131f87b350e650534c68d8e"), "firstName" : "Manuel", "lastName" : "Viera", "username" : "mviera", "age" : 26, "city" : "Sevilla" }
&gt;
</code></pre>
<p>En este caso tanto <code>find()</code> como <code>findOne()</code> devolverán resultados idénticos, pues ahora mismo sólo contamos con un documento en nuestra colección <code>users</code>:</p>
<pre><code>&gt; db.users.findOne()
{
        "_id" : ObjectId("5131f87b350e650534c68d8e"),
        "firstName" : "Manuel",
        "lastName" : "Viera",
        "username" : "mviera",
        "age" : 26,
        "city" : "Sevilla"
}
&gt;
</code></pre>
<p>Si os fijáis en un detalle, <code>findOne()</code> devuelve el contenido de una forma<br>
mucho más legible al ojo humano que <code>find()</code>. Esto también podemos conseguirlo con <code>find()</code> si utilizamos además el método <code>pretty()</code> de la siguiente forma:</p>
<pre><code>&gt; db.users.find().pretty()
{
        "_id" : ObjectId("5131f87b350e650534c68d8e"),
        "firstName" : "Manuel",
        "lastName" : "Viera",
        "username" : "mviera",
        "age" : 26,
        "city" : "Sevilla"
}
</code></pre>
<p>Al igual que <code>pretty()</code> también podemos utilizar otros métodos como <code>count()</code> que nos devuelve la cantidad total de documentos devueltos:</p>
<pre><code>&gt; db.users.find().count()
1
&gt;

O directamente sobre la colección `users` para saber el total de documentos de dicha colección:

&gt; db.users.count()
5
&gt;
</code></pre>
<p>Si introducimos más documentos de prueba, se aprecia que el contador total de documentos cambia:</p>
<pre><code>&gt; db.users.insert({firstName:"Paco", lastName:"Laverdaque", username: "laverdaque", age: 40, city: "Madrid"})
&gt; db.users.insert({firstName:"Raul", lastName:"Martin", username: "rmartin", age: 39, city: "Malaga"})
&gt; db.users.insert({firstName:"Jose", lastName:"Castillo", username: "lolo", age: 25, city: "Cadiz"})
&gt; db.users.insert({firstName:"Jose Luis", lastName:"Romero", username: "selu", age: 27, city: "Barcelona"})
&gt; 
&gt; db.users.count()
5
</code></pre>
<p>Pero no siempre vamos a querer recuperar todos los documentos de nuestra colección...</p>
<h3 id="cmofiltrardocumentos">¿Cómo filtrar documentos?</h3>
<p>Seguro que muchos ya estáis pensando en la cláusula <code>WHERE</code> de las sentencias SQL. Por ejemplo, si quisiéramos recuperar aquellos usuarios cuya ciudad es Sevilla, con una sentencia SQL sería:</p>
<pre><code>&gt; SELECT * FROM users WHERE city="Sevilla";
</code></pre>
<p>Sin embargo, en MongoDB es de la siguiente forma:</p>
<pre><code>&gt; db.users.find({ city: "Sevilla" })
</code></pre>
<p>De esta forma, pasamos como parámetro un documento JSON con la cláusula a<br>
cumplir, en este caso que la clave <strong>city</strong> tenga como valor <em>Sevilla</em>.</p>
<p>¿Y cómo podemos concatenar cláusulas? Es decir, cómo sería si quisiéramos<br>
recuperar aquellos usuarios cuya ciudad es Sevilla <strong>y</strong> además su edad sea 26:</p>
<pre><code>&gt; db.users.find({ city: "Sevilla", age: 26 })
</code></pre>
<p>Como se puede observar, solamente se necesita agregar una segunda clave o campo al documento JSON que se le pasa al método <code>find()</code>.</p>
<p><strong>Nota:</strong> MongoDB aplica por defecto un <strong>AND</strong> entre cláusulas, es decir,<br>
imaginaos que la coma (<strong>,</strong>) es un operador <strong>AND</strong>.</p>
<p>Para utilizar un operador <strong>OR</strong> deberemos usar el operador <code>$or</code> de MongoDB, de la siguiente forma:</p>
<pre><code>&gt; db.users.find({ $or: [ {city:"Sevilla"}, {city:"Malaga"} ] })
</code></pre>
<p>En este caso hemos recuperado aquellos usuarios cuya ciudad es Sevilla <strong>o</strong> Málaga.</p>
<p>Podéis aprender más sobre operadores en <a href="http://docs.mongodb.org/manual/reference/operators/">http://docs.mongodb.org/manual/reference/operators/</a>.<br>
Algunos de ellos son:</p>
<ul>
<li><code>$gt</code>: mayor que (o <em>greater than</em> en inglés).</li>
<li>`$lt: menor que (o <em>lower than</em> en inglés).</li>
<li><code>$gte</code>: mayor o igual que (o <em>greather or equal than</em> en inglés).</li>
<li><code>$lte</code>: menor o igual que (o <em>lower or equal than</em> en inglés).</li>
<li><code>$not</code>: no (negación o <em>not</em> en inglés).</li>
<li><code>$in</code>: en, para buscar dentro de un array.</li>
<li><code>$nin</code>: no en, para buscar algo que no se encuentre en un determinado array (o <em>not in</em> en inglés).</li>
<li><code>$ne</code>: no es igual a (o <em>not equal to</em> en inglés).</li>
</ul>
<p>Pero, no siempre vamos a querer recuperar todos los campos de un documento,<br>
quizás solo necesitemos un algunos de ellos...</p>
<h2 id="cmoseleccionarciertoscampos">¿Cómo seleccionar ciertos campos?</h2>
<p>Al igual que en una sentencia <code>SELECT</code>, en una base de datos SQL, podemos<br>
especificar qué determinados campos queremos obtener tras seleccionar los<br>
documentos, en MongoDB también podemos hacerlo.</p>
<p>Hasta ahora hemos estado utilizando <code>find()</code> como una sentencia SQL <code>SELECT *</code>, es decir:</p>
<pre><code>&gt; db.users.find()
</code></pre>
<p>es equivalente a</p>
<pre><code>&gt; SELECT * FROM users;
</code></pre>
<p>Pero ¿y si lo que queremos es solamente recuperar los campos <em>username</em> y<br>
<em>age</em>? En una sentencia SQL sería de la siguiente forma:</p>
<pre><code>&gt; SELECT username, age, city FROM users;
</code></pre>
<p>En cambio, en MongoDB sería de la siguiente forma:</p>
<pre><code>&gt; db.users.find({}, {username:1, age:1})
{ "_id" : ObjectId("5131f87b350e650534c68d8e"), "username" : "mviera", "age" : 26 }
{ "_id" : ObjectId("5131fdc8350e650534c68d8f"), "username" : "laverdaque", "age" : 40 }
{ "_id" : ObjectId("5131fe00350e650534c68d90"), "username" : "rmartin", "age" : 39 }
{ "_id" : ObjectId("5131fe20350e650534c68d91"), "username" : "lolo", "age" : 25 }
{ "_id" : ObjectId("5131fe80350e650534c68d92"), "username" : "selu", "age" : 27 }
</code></pre>
<p>Sin embargo, como podéis observar, aunque no hemos especificado el campo <code>_id</code> sigue apareciendo en la salida. Como ya comenté en el anterior post, MongoDB siempre muestra el campo <code>_id</code> a menos que especifiquemos explicitamente que no queramos que lo haga. Y sería de la siguiente forma:</p>
<pre><code>&gt; db.users.find( {}, { username:1, age:1, _id:0 })
{ "username" : "mviera", "age" : 26 }
{ "username" : "laverdaque", "age" : 40 }
{ "username" : "rmartin", "age" : 39 }
{ "username" : "lolo", "age" : 25 }
{ "username" : "selu", "age" : 27 }
</code></pre>
<p>En resumen, si analizamos la sintaxis del método <code>find()</code>, primero se<br>
especifica un documento JSON con las cláusulas del filtro que queremos aplicar y a continuación, si lo preferimos, podemos activar o desactivar cierto campos de la salida:</p>
<ul>
<li><strong>1</strong> : indica que queremos que muestre el campo especificado.</li>
<li><strong>0</strong> : indica que no queremos que dicho campo se muestre en la salida.</li>
</ul>
<h1 id="actualizandodatosdelosdocumentos">Actualizando datos de los documentos</h1>
<p>Una vez que somos capaces de introducir documentos en nuestra colección,<br>
recuperarlos todos o aquellos que nos interesan utilizando una <em>query</em> es hora de conocer cómo podemos actualizar los datos de nuestros documentos.</p>
<p>Para ello utilizaremos el método <code>update()</code> cuya sintaxis es la siguiente:</p>
<pre><code>&gt; db.collection.update( &lt;query&gt;, &lt;update&gt;, options )
&gt;
</code></pre>
<ul>
<li>El parámetro <code>&lt;query&gt;</code> hace referencia a una query como las que usabamos con el comando <code>find()</code>, la cual nos permitirá seleccionar aquellos documentos los cuales queremos modificar. De otra forma, si no se especifica una query se estarían seleccionando todos los documentos de una colección.</li>
<li>El parámetro <code>&lt;update&gt;</code> en el que podemos especificar un documento completo, que actualizará cada uno de los campos del documento seleccionado; o también podemos especificar solamente el campo del documento que queremos especificar, lo cual es más eficiente comparado con actualizar todos los campos del documento.</li>
</ul>
<p>Y con respecto a las opciones podemos citar:</p>
<ul>
<li><code>upsert</code>: si se establece este parámetro a <strong>true</strong> y no hay documento que coincida con la <code>&lt;query&gt;</code> especificada, el método <code>update()</code> insertará un nuevo documento en la colección con los valores especificados en el parámetro <code>&lt;update&gt;</code>.</li>
<li><code>multi</code> : por defecto MongoDB solo actualiza un documento al mismo tiempo, si necesitamos actualizar más de un documento al mismo tiempo debemos establecer este parámetro a <strong>true</strong>.</li>
</ul>
<h2 id="actualizarundocumentocompleto">Actualizar un documento completo</h2>
<p>Esta no es la forma más eficiente de actualizar el contenido de un documento, como comenté anteriormente, pues es necesario que se especifique el contenido completo del documento, y en caso de ser un documento muy grande puede llegar a ser bastante ineficiente, ya que tendra que actualizarse el valor de cada campo aunque no hay cambiado.</p>
<p>Imaginemos que queremos modificar un documento para cambiar solamente el valor del campo <strong>age</strong> (edad). Tendríamos que realizar lo siguiente:</p>
<pre><code>&gt; db.users.update({ username: "rmartin" }, { "firstName" : "Raul", "lastName" : "Martin", "username" : "rmartin", "age" : 40, "city" : "Malaga" } })
</code></pre>
<p>Con esta instrucción hemos cambiado el valor del campo <strong>age</strong> de 39 a 40, incluyendo los demás campos que serán actualizados con los mismos datos.</p>
<p>También es posible hacerlo de la siguiente forma para nuestra comodidad:</p>
<pre><code>&gt; user = db.users.findOne({ username:"rmartin" })
{
        "_id" : ObjectId("5131fe00350e650534c68d90"),
        "firstName" : "Raul",
        "lastName" : "Martin",
        "username" : "rmartin",
        "age" : 39,
        "city" : "Malaga"
}
&gt; user.age 
39
&gt; 
&gt; user.age = 40
40
&gt; 
&gt; db.users.update({ username:"rmartin" }, user )
</code></pre>
<ol>
<li>Recupero el documento completo referente al usuario cuyo <em>username</em> es <em>rmartin</em> y lo almaceno en la variable <code>user</code>.</li>
<li>Compruebo el valor actual del campo <em>age</em> accediendo al objeto <code>user</code> haciendo uso del <em>dot notation</em> (notación por punto: user.campo)</li>
<li>Modifico el valor del campo <em>age</em> estableciéndolo a 40.</li>
<li>Utilizo el método <code>update()</code> seleccionando de nuevo el mismo objeto que al principio (usando la misma query) e indico el nuevo documento a continuación, en este caso, almacenado en la variable <code>user</code>.</li>
</ol>
<h2 id="actualizandouncampoconcretodeundocumento">Actualizando un campo concreto de un documento</h2>
<p>Sin embargo, existe una alternativa mucho más eficiente para actualizar el<br>
valor de ciertos campos en un documento. Para ello será necesario volver a<br>
hacer uso de los operadores como los anteriormente citados. Algunos de estos son:</p>
<ul>
<li>
<p><code>$set</code>: que permite establecer un nuevo valor a un campo del documento. Si el campo no existe actualmente en el documento, será creado automáticamente. Por ejemplo:</p>
<pre><code>  &gt; db.users.update({ age: 26, city: "Sevilla" }, { $set: { weight: 68.9 } })
</code></pre>
</li>
</ul>
<p>En este caso se ha seleccionado un usuario cuya edad sea 26 y su ciudad<br>
Sevilla, y se ha añadido el campo <strong>weight</strong>.</p>
<ul>
<li>
<p><code>$addToSet</code>: para añadir elementos un array. Por ejemplo, si quisieramos añadir un nuevo campo llamado <em>likes</em> con los gustos de un usuario:</p>
<pre><code>&gt; db.users.update({ username:"mviera" }, {$addToSet: { likes: "photography" }})
&gt; db.users.update({ username:"mviera" }, {$addToSet: { likes: "music" }})
&gt;
&gt; db.users.findOne({ username: "mviera" })
{
    "_id" : ObjectId("5131f87b350e650534c68d8e"),
    "age" : 26,
    "city" : "Sevilla",
    "firstName" : "Manuel",
    "lastName" : "Viera",
    "likes" : [
            "photography",
            "music"
    ],
    "username" : "mviera",
    "weight" : 68.9
}
&gt;
</code></pre>
</li>
<li>
<p><code>$inc</code>: permite incrementar el valor numérico de uno de los campos del documento. Por ejemplo, si quisieramos incrementar en 5 la edad del usuario <em>mviera</em>:</p>
<pre><code>  &gt; db.users.update({ username:"mviera" }, {$inc: {age: 5}})
  &gt; db.users.find({ username: "mviera" }, {username: 1, age: 1, _id:0})
</code></pre>
<p>{ "age" : 31, "username" : "mviera" }</p>
</li>
</ul>
<p>Para más información acerca de los operadores utilzados en el método <code>update()</code> podéis consultar<br>
<a href="http://docs.mongodb.org/manual/applications/update/#update-operators">http://docs.mongodb.org/manual/applications/update/#update-operators</a></p>
<h2 id="eliminandodocumentos">Eliminando documentos</h2>
<p>Para eliminar documentos de nuestra colección utilizaremos el método <code>remove()</code> en la shell de MongoDB. Si ya sabes cómo utilizar el método <code>find()</code> no supondrá ningún problema porque solamente requiere que se le especifique el filtro o búsqueda de los documentos que se quieren eliminar. Su sintaxis es la siguiente:</p>
<pre><code>db.collection.remove( &lt;query&gt;, &lt;justOne&gt; )
</code></pre>
<p>De forma que si queremos eliminar de la colección todos los usuarios cuya edad sea mayor a 30 utilizaríamos la siguiente instrucción:</p>
<pre><code>&gt; db.users.remove({ age: { $gt: 30 } })
</code></pre>
<p>El parámetro <code>justOne</code> permite indicar al método <code>remove()</code> si queremos<br>
eliminar solamente un documento de todos los coincidentes. En ese caso, se debe pasar el valor <em>true</em> o <em>1</em>, de la siguiente forma:</p>
<pre><code>&gt; db.users.remove({ age: { $gt: 30 } }, true )
</code></pre>
<p>Es posible utilizar el método <code>remove()</code> para eliminar todos los documentos de una colección si no se especifica una query o si ésta está vacía, es decir, <code>db.users.remove({})</code>. Pero en este caso, si queremos eliminar todos los documentos de una colección, es recomendable utilizar el método <code>drop()</code>, que <strong>elimina la colección completa</strong>:</p>
<pre><code>&gt; db.users.drop()
</code></pre>
<p>¡Y eso es todo! Espero que os haya sido útil y por lo menos hayáis aprendido algo nuevo. Intentaré seguir escribiendo sobre MongoDB, ahora que ya conocemos lo básico.</p>
<p>Un saludo,<br>
Manu.</p>


            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../../">Manuel Viera</a> © 2020</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
