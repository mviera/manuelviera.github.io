
<head>
    <meta charset="utf-8">

    <title>Nginx</title>

    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

    <link rel="shortcut icon" href="../../../favicon.ico" type="image/x-icon">
    <link rel="canonical" href="../index.html">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Manuel Viera">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Nginx">
    <meta property="og:description" content="Hace bastante tiempo que tengo en mente escribir un post sobre Nginx  (pronunciado como &amp;quot;engine x&amp;quot;), aunque ya lo he comentado en algún otro post  anterior, y creo que hoy va a ser el día. No por nada en especial, si no porque me apetece compartirlo y además">
    <meta property="og:url" content="http://manuelviera.com/blog/nginx/">
    <meta property="article:published_time" content="2012-11-23T00:00:00.000Z">
    <meta property="article:modified_time" content="2020-07-27T11:36:51.000Z">
    <meta property="article:tag" content="tech">
    
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Nginx">
    <meta name="twitter:description" content="Hace bastante tiempo que tengo en mente escribir un post sobre Nginx  (pronunciado como &amp;quot;engine x&amp;quot;), aunque ya lo he comentado en algún otro post  anterior, y creo que hoy va a ser el día. No por nada en especial, si no porque me apetece compartirlo y además">
    <meta name="twitter:url" content="http://manuelviera.com/blog/nginx/">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Manuel Viera">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="tech">
    <meta name="twitter:site" content="@mviera">
    <meta name="twitter:creator" content="@mviera">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Manuel Viera",
        "url": "http://manuelviera.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "http://manuelviera.com/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Manuel Viera",
        "image": {
            "@type": "ImageObject",
            "url": "http://manuelviera.com/content/images/2020/06/2020-06-22-161222_428x430_scrot.png",
            "width": 428,
            "height": 430
        },
        "url": "http://manuelviera.com/author/mviera/",
        "sameAs": [
            "https://manuelviera.com",
            "https://twitter.com/mviera"
        ]
    },
    "headline": "Nginx",
    "url": "http://manuelviera.com/blog/nginx/",
    "datePublished": "2012-11-23T00:00:00.000Z",
    "dateModified": "2020-07-27T11:36:51.000Z",
    "keywords": "tech",
    "description": "Hace bastante tiempo que tengo en mente escribir un post sobre Nginx\n(pronunciado como &quot;engine x&quot;), aunque ya lo he comentado en algún otro post\nanterior, y creo que hoy va a ser el día. No por nada en especial, si no porque\nme apetece compartirlo y además es un servidor web que me gusta mucho y que, en\nciertos aspectos, ha ido conquistando terreno de otros servidores web.\n\n¿Qué es Nginx?\nComo decía, Nginx [http://nginx.org/] es un servidor HTTP libre, de código\nabierto, de alto rendimiento y qu",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "http://manuelviera.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.19">
    <link rel="alternate" type="application/rss+xml" title="Manuel Viera" href="../../rss/index.html">

    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Merriweather:300,700,700italic,300italic%7COpen+Sans:700,600,400">
    <style amp-custom>html{font-family:sans-serif;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,details,figcaption,figure,footer,header,main,menu,nav,section,summary{display:block}audio,canvas,progress,video{display:inline-block;vertical-align:baseline}audio:not([controls]){display:none;height:0}[hidden],template{display:none}a{background-color:transparent}a:active,a:hover{outline:0}abbr[title]{border-bottom:1px dotted}b,strong{font-weight:bold}dfn{font-style:italic}h1{margin:0.67em 0;font-size:2em}mark{background:#ff0;color:#000}small{font-size:80%}sub,sup{position:relative;vertical-align:baseline;font-size:75%;line-height:0}sup{top:-0.5em}sub{bottom:-0.25em}img{border:0}amp-img{border:0}svg:not(:root){overflow:hidden}figure{margin:1em 40px}hr{box-sizing:content-box;height:0}pre{overflow:auto}code,kbd,pre,samp{font-family:monospace,monospace;font-size:1em}button,input,optgroup,select,textarea{margin:0;color:inherit;font:inherit}button{overflow:visible}button,select{text-transform:none}button,html input[type="button"],input[type="reset"],input[type="submit"]{cursor:pointer;-webkit-appearance:button}button[disabled],html input[disabled]{cursor:default}button::-moz-focus-inner,input::-moz-focus-inner{padding:0;border:0}input{line-height:normal}input[type="checkbox"],input[type="radio"]{box-sizing:border-box;padding:0}input[type="number"]::-webkit-inner-spin-button,input[type="number"]::-webkit-outer-spin-button{height:auto}input[type="search"]{-webkit-appearance:textfield}input[type="search"]::-webkit-search-cancel-button,input[type="search"]::-webkit-search-decoration{-webkit-appearance:none}fieldset{margin:0 2px;padding:0.35em 0.625em 0.75em;border:1px solid #c0c0c0}legend{padding:0;border:0}textarea{overflow:auto}optgroup{font-weight:bold}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}html{max-height:100%;height:100%;font-size:62.5%;-webkit-tap-highlight-color:rgba(0,0,0,0)}body{max-height:100%;height:100%;color:#3a4145;background:#f4f8fb;letter-spacing:0.01rem;font-family:"Merriweather",serif;font-size:1.8rem;line-height:1.75em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1}::-moz-selection{background:#d6edff}::selection{background:#d6edff}h1,h2,h3,h4,h5,h6{margin:0 0 0.3em 0;color:#2e2e2e;font-family:"Open Sans",sans-serif;line-height:1.15em;text-rendering:geometricPrecision;-webkit-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-moz-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1;-o-font-feature-settings:"dlig" 1,"liga" 1,"lnum" 1,"kern" 1}h1{text-indent:-2px;letter-spacing:-1px;font-size:2.6rem}h2{letter-spacing:0;font-size:2.4rem}h3{letter-spacing:-0.6px;font-size:2.1rem}h4{font-size:1.9rem}h5{font-size:1.8rem}h6{font-size:1.8rem}a{color:#4a4a4a}a:hover{color:#111}p,ul,ol,dl{margin:0 0 2.5rem 0;font-size:1.5rem;text-rendering:geometricPrecision;-webkit-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-moz-font-feature-settings:"liga" 1,"onum" 1,"kern" 1;-o-font-feature-settings:"liga" 1,"onum" 1,"kern" 1}ol,ul{padding-left:2em}ol ol,ul ul,ul ol,ol ul{margin:0 0 0.4em 0;padding-left:2em}dl dt{float:left;clear:left;overflow:hidden;margin-bottom:1em;width:180px;text-align:right;text-overflow:ellipsis;white-space:nowrap;font-weight:700}dl dd{margin-bottom:1em;margin-left:200px}li{margin:0.4em 0}li li{margin:0}hr{display:block;margin:1.75em 0;padding:0;height:1px;border:0;border-top:#efefef 1px solid}blockquote{box-sizing:border-box;margin:1.75em 0 1.75em 0;padding:0 0 0 1.75em;border-left:#4a4a4a 0.4em solid;-moz-box-sizing:border-box}blockquote p{margin:0.8em 0;font-style:italic}blockquote small{display:inline-block;margin:0.8em 0 0.8em 1.5em;color:#ccc;font-size:0.9em}blockquote small:before{content:"\2014 \00A0"}blockquote cite{font-weight:700}blockquote cite a{font-weight:normal}mark{background-color:#fdffb6}code,tt{padding:1px 3px;border:#e3edf3 1px solid;background:#f7fafb;border-radius:2px;white-space:pre-wrap;font-family:Inconsolata,monospace,sans-serif;font-size:0.85em;font-feature-settings:"liga" 0;-webkit-font-feature-settings:"liga" 0;-moz-font-feature-settings:"liga" 0}pre{overflow:auto;box-sizing:border-box;margin:0 0 1.75em 0;padding:10px;width:100%;border:#e3edf3 1px solid;background:#f7fafb;border-radius:3px;white-space:pre;font-family:Inconsolata,monospace,sans-serif;font-size:0.9em;-moz-box-sizing:border-box}pre code,pre tt{padding:0;border:none;background:transparent;white-space:pre-wrap;font-size:inherit}kbd{display:inline-block;margin-bottom:0.4em;padding:1px 8px;border:#ccc 1px solid;background:#f4f4f4;border-radius:4px;box-shadow:0 1px 0 rgba(0,0,0,0.2),0 1px 0 0 #fff inset;color:#666;text-shadow:#fff 0 1px 0;font-size:0.9em;font-weight:700}table{box-sizing:border-box;margin:1.75em 0;max-width:100%;width:100%;background-color:transparent;-moz-box-sizing:border-box}table th,table td{padding:8px;border-top:#efefef 1px solid;vertical-align:top;text-align:left;line-height:20px}table th{color:#000}table caption + thead tr:first-child th,table caption + thead tr:first-child td,table colgroup + thead tr:first-child th,table colgroup + thead tr:first-child td,table thead:first-child tr:first-child th,table thead:first-child tr:first-child td{border-top:0}table tbody + tbody{border-top:#efefef 2px solid}table table table{background-color:#fff}table tbody > tr:nth-child(odd) > td,table tbody > tr:nth-child(odd) > th{background-color:#f6f6f6}table.plain tbody > tr:nth-child(odd) > td,table.plain tbody > tr:nth-child(odd) > th{background:transparent}iframe,amp-iframe,.fluid-width-video-wrapper{display:block;margin:1.75em 0}.fluid-width-video-wrapper iframe,.fluid-width-video-wrapper amp-iframe{margin:0}textarea,select,input{margin:0 0 5px 0;padding:6px 9px;width:260px;outline:0;border:#e7eef2 1px solid;background:#fff;border-radius:4px;box-shadow:none;font-family:"Open Sans",sans-serif;font-size:1.6rem;line-height:1.4em;font-weight:100;-webkit-appearance:none}textarea{min-width:250px;min-height:80px;max-width:340px;width:100%;height:auto}input[type="text"]:focus,input[type="email"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="number"]:focus,input[type="date"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="time"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,textarea:focus{outline:none;outline-width:0;border:#bbc7cc 1px solid;background:#fff}select{width:270px;height:30px;line-height:30px}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.clearfix{zoom:1}.main-header{position:relative;display:table;overflow:hidden;box-sizing:border-box;width:100%;height:50px;background:#5ba4e5 no-repeat center center;background-size:cover;text-align:left;-webkit-box-sizing:border-box;-moz-box-sizing:border-box}.content{background:#fff;padding-top:15px}.blog-title,.content{margin:auto;max-width:600px}.blog-title a{display:block;padding-right:16px;padding-left:16px;height:50px;color:#fff;text-decoration:none;font-family:"Open Sans",sans-serif;font-size:16px;line-height:50px;font-weight:600}.post{position:relative;margin-top:0;margin-right:16px;margin-left:16px;padding-bottom:0;max-width:100%;border-bottom:#ebf2f6 1px solid;word-wrap:break-word;font-size:0.95em;line-height:1.65em}.post-header{margin-bottom:1rem}.post-title{margin-bottom:0}.post-title a{text-decoration:none}.post-meta{display:block;margin:3px 0 0 0;color:#9eabb3;font-family:"Open Sans",sans-serif;font-size:1.3rem;line-height:2.2rem}.post-meta a{color:#9eabb3;text-decoration:none}.post-meta a:hover{text-decoration:underline}.post-meta .author{margin:0;font-size:1.3rem;line-height:1.3em}.post-date{display:inline-block;text-transform:uppercase;white-space:nowrap;font-size:1.2rem;line-height:1.2em}.post-image{margin:0;padding-top:3rem;padding-bottom:30px;border-top:1px #E8E8E8 solid}.post-image img{object-fit:cover;}.post-content amp-img,.post-content amp-anim{position:relative;left:50%;display:block;padding:0;min-width:0;max-width:112%;width:calc(100% + 32px);height:auto;transform:translateX(-50%);-webkit-transform:translateX(-50%);-ms-transform:translateX(-50%)}.footnotes{font-size:1.3rem;line-height:1.6em;font-style:italic}.footnotes li{margin:0.6rem 0}.footnotes p{margin:0}.footnotes p a:last-child{text-decoration:none}.site-footer{position:relative;margin:0 auto 20px auto;padding:1rem 15px;max-width:600px;color:rgba(0,0,0,0.5);font-family:"Open Sans",sans-serif;font-size:1.1rem;line-height:1.75em}.site-footer a{color:rgba(0,0,0,0.5);text-decoration:none;font-weight:bold}.site-footer a:hover{border-bottom:#bbc7cc 1px solid}.poweredby{display:block;float:right;width:45%;text-align:right}.copyright{display:block;float:left;width:45%}</style>

    <style amp-boilerplate>body{-webkit-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-moz-animation:-amp-start 8s steps(1,end) 0s 1 normal both;-ms-animation:-amp-start 8s steps(1,end) 0s 1 normal both;animation:-amp-start 8s steps(1,end) 0s 1 normal both}@-webkit-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-moz-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-ms-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@-o-keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}@keyframes -amp-start{from{visibility:hidden}to{visibility:visible}}</style><noscript><style amp-boilerplate>body{-webkit-animation:none;-moz-animation:none;-ms-animation:none;animation:none}</style></noscript>
    <script async src="https://cdn.ampproject.org/v0.js"></script>

    

</head>

<body class="amp-template">
    <header class="main-header">
        <nav class="blog-title">
            <a href="../../../">Manuel Viera</a>
        </nav>
    </header>

    <main class="content" role="main">
        <article class="post">

            <header class="post-header">
                <h1 class="post-title">Nginx</h1>
                <section class="post-meta">
                    <p class="author">by <a href="../../../author/mviera/">Manuel Viera</a></p>
                    <time class="post-date" datetime="2012-11-23">2012-11-23</time>
                </section>
            </header>
            <section class="post-content">

                <p>Hace bastante tiempo que tengo en mente escribir un post sobre Nginx<br>
(pronunciado como "engine x"), aunque ya lo he comentado en algún otro post<br>
anterior, y creo que hoy va a ser el día. No por nada en especial, si no porque me apetece compartirlo y además es un servidor web que me gusta mucho y que, en ciertos aspectos, ha ido conquistando terreno de otros servidores web.</p>
<h2 id="quesnginx">¿Qué es Nginx?</h2>
<p>Como decía, <a href="http://nginx.org/">Nginx</a> es un servidor HTTP libre, de código abierto, de alto rendimiento y que puede ser utilizado para actuar tanto como proxy HTTP reverso, como proxy IMAP/POP3. Nginx es famoso por ser muy ligero, ya que consume muy pocos recursos del sistema; es muy estable, y además su configuración es relativamente sencilla, bastante más simple a la vista que la configuración de Apache2.</p>
<p>Su instalación es bastante sencilla también, independientemente de que lo<br>
hagamos mediante herramientas de paquetería o compilando del código fuente<br>
directamente.</p>
<p>Como apunte, decir que fue escrito por <a href="http://sysoev.ru/en/">Igor Sysoev</a>, de origen ruso, escrito para solventar un problema llamado <a href="http://www.kegel.com/c10k.html">C10K</a>. Resumiendo, ser capaz de manejar 10.000 clientes de forma simultanea.</p>
<p>La primera vez que instalé Nginx, compilando desde las fuentes, fue allá por 2008 simplemente por probarlo. No fue hasta 2009 ó 2010 cuando empecé a usarlo de verdad cuando trabajaba en <a href="http://yaco.es">Yaco Sistemas</a>, para realizar despliegues de aplicaciones web con Django. Y recuerdo que mi primer despliegue utilizando <a href="http://merengueproject.org/">Merengue Project</a> + Nginx + uWSGI, con el fin de ver si mejoraba el rendimiento y la verdad es que quedamos encantados. Así que vamos a instalarlo ya!</p>
<h2 id="instalandonginxperocmo">Instalando Nginx ¿pero cómo?</h2>
<p>Es posible que antes de instalar nos surjan dudas con respecto a la forma de instalar ya sea Nginx u otro software en nuestro sistema. Hay varias formas de instalar Nginx:</p>
<ul>
<li>Descargar el código fuente y seguir el proceso de instalación típico: configurar, compilar e instalar; también conocido como <strong>cmmi</strong> (<strong>c</strong>onfigure - <strong>m</strong>ake - <strong>m</strong>ake <strong>i</strong>nstall).</li>
<li>Utilizando las herramientas de paquetería de nuestra distribución: <strong>Aptitude</strong> o <strong>APT</strong> si utilizamos una distribución basada en Debian, <strong>yum</strong> si utilizamos CentOS, RedHat, Fedora o similar; etc.</li>
<li>Añadir el repositorio oficial de Nginx a nuestro sistema de paquetería, si hubiera alguno disponible y compatible; en caso de que no estuviese disponible el paquete en nuestra distribución.</li>
<li>Descargar el paquete de instalación compatible con nuestro sistema de paquetería, de otra distribución e instalarlo con las herramientas habituales en nuestro sistema.</li>
<li>Descargar un paquete de instalación (<strong>.deb</strong> o <strong>.rpm</strong>, por ejemplo) y convertirlo con <strong>alien</strong> si el paquete descargado no es compatible con nuestro sistema de paquetería.</li>
</ul>
<p>Todas estas formas permitirían instalar Nginx, pero <strong>no todas son<br>
aconsejables</strong>, según qué casos, me explico.</p>
<p>Si se trata de una <strong>instalación en producción</strong>, y con ello me refiero a la instalación de Nginx en un servidor de un cliente, o en un servidor de<br>
producción para nuestra empresa; me decantaría sin dudar por la <strong>instalación mediante el sistema de paquetería</strong>. De esta forma, contaría con todas las posibles futuras actualizaciones de seguridad y/o correcciones del paquete de forma muy cómoda utilizando las herramientas de paquetería del sistema.</p>
<p>Si la instalación de Nginx se va a realizar en un <strong>sistema antiguo</strong>, y en ese caso, si es que existe un paquete para Nginx en el sistema de paquetería, es probable que sea <strong>más antiguo y desactualizado</strong> que la versión actual de Nginx. Con lo que es muy posible que no cuente con mejoras de <strong>fallos de seguridad</strong>, arreglos de <strong>bugs</strong> encontrados, etc; en este caso, personalmente, optaría por una <strong>instalación desde las fuentes</strong>. Es cierto que antes de instalar desde las fuentes sopesaría mis necesidades sobre Nginx, es decir, si es una instalación en producción pero sólo voy a servir <strong>HTML estático</strong>, es muy posible que aun siendo una versión antigua de Nginx, hubiera optado por la <strong>instalación por paquetería</strong>. Pero si el fin es servir una <strong>web más compleja</strong>, optaría por <strong>utilizar la versión estable más reciente de Nginx</strong> y <strong>compilar desde las fuentes</strong>.</p>
<p>Con respecto a <strong>descargar un paquete de otra distribución</strong> o convertir el<br>
paquete con <strong>alien</strong>, <strong>no lo recomendaría</strong> a menos que fuera una situación extrema, que no haya otro camino, y si la distribución a la que pertenece el paquete es muy similar a la que estamos usando. En cualquier otro caso, no lo usaría nunca, ya que: <strong>no</strong> contamos con futuras <strong>actualizaciones</strong> del paquete, al pertenecer a otra distribución <strong>es posible que los ficheros se instalen</strong> en <strong>directorios no habituales en nuestra distribución</strong>, es posible que los <strong>scripts SysV</strong> del servicio <strong>no funcionen</strong>, etc.</p>
<p>Esto sólo es mi humilde opinión de lo que haría en una situación real. Es<br>
imposible describir todas las posibilidades o dar unas directrices de qué hacer en una determinada situación, más que elegir una nosotros mismos basándonos en nuestro conocimiento, experiencia y muchos otros factores. En caso de dudar, si es posible, es aconsejable obtener una segunda opinión de un compañero o consultarlo con alguien con rango superior.</p>
<p>Y bueno, después de esta parrafada (perdón), nos puede quedar claro, qué dos opciones de instalación elegiría yo, <strong>IMHO</strong> (¿qué pensais vosotros?) Así que veremos la instalación utilizando herramientas de paquetería y compilando desde el código fuente.</p>
<h2 id="instalacinporpaquetera">Instalación por paquetería</h2>
<p>La instalación por paquetería es bastante trivial si ya estamos familiarizados con estas herramientas. Bastaría con buscar el paquete en la base de datos de nuestro sistema de paquetería, ver el nombre e instalarlo.</p>
<h3 id="debian">Debian</h3>
<p>En <strong>Debian 7</strong> (wheezy) que es la que estoy usando actualmente hay varios<br>
paquetes de Nginx en los repositorios oficiales de Debian:</p>
<ul>
<li><code>nginx-light</code> : una versión "light" que sólo incluye un Nginx precompilado con unos cuantos módulos, pero no todos.</li>
<li><code>nginx-full</code> : incluye Nginx precompilado con todos los módulos estandar incluidos.</li>
<li><code>nginx-extras</code> : se trata de Nginx precompilado con todos los módulos estandar más una serie de módulos extras incluyendo algunos como Perl.</li>
</ul>
<p>Depende de las necesidades que tengamos instalaremos uno u otro, pero en este caso instalaré nginx-full, y para ello ejecutaremos la siguiente instrucción:</p>
<pre><code>root@debian:~# apt-get install nginx-full
</code></pre>
<p>La instalación no tardará mucho en finalizar y tendremos instalado Nginx en<br>
nuestro sistema. Una de las ventajas de utilizar el sistema de paquetería de nuestro sistema frente a compilar nuestra propia versión de Nginx es que el paquete además de instalar Nginx, instala ciertas utilidades adicionales como pueden ser los scripts de inicio SysV y demás scripts que nos permiten<br>
arrancar, reiniciar o parar nuestro servidor Nginx. Para arrancar Nginx<br>
utilizaremos, como root, el comando <strong>service</strong>:</p>
<pre><code>root@debian:~# service nginx start
Starting nginx: nginx.
</code></pre>
<p>Si consultamos el estado utilizando el parámetro <strong>status</strong> podremos ver que Nginx ya se encuentra en funcionamiento:</p>
<pre><code>root@debian:~# service nginx status
nginx is running.
</code></pre>
<p>Para comprobar si realmente el puerto 80 (http/tcp) está escuchando podemos<br>
utilizar el comando <strong>netstat</strong> de la siguiente forma:</p>
<pre><code>root@debian:~# netstat -ntp
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name
tcp        0      0 192.168.1.40:80         192.168.1.35:60110      ESTABLISHED 3262/nginx: worker
</code></pre>
<h3 id="centos">CentOS</h3>
<p>En <strong>CentOS</strong> al parecer no hay paquete en los repositorios oficiales por<br>
defecto, así que hay que añadir primero el repositorio a nuestra lista de<br>
repositorios y luego instalarlo. Es muy fácil, sólo hay que hace lo siguiente:</p>
<p>Podemos descargar el paquete <strong>RPM</strong> que instala la configuración del<br>
repositorio y posteriormente instalarlo con la utilida <code>rpm</code>, o instalarlo<br>
directamente con la utilidad <code>yum</code> pasando la URL completa hacia el fichero RPM de la siguiente forma:</p>
<pre><code>[root@centos /]# yum install http://nginx.org/packages/centos/6/noarch/RPMS/nginx-release-centos-6-0.el6.ngx.noarch.rpm
</code></pre>
<p>Una vez instalado, podemos consultar la configuración del repositorio de Nginx que se ha instalado en el fichero <code>/etc/yum.repos.d/nginx.repo</code>. Tras instalar la configuración del repositorio, ya solo nos queda utilizar <code>yum</code> para instalar Nginx:</p>
<pre><code>[root@centos /]# yum install nginx
</code></pre>
<p>Ya solo nos queda arrancar nuestro Nginx utilizando la utilidad <code>service</code> al igual que hicimos en Debian.</p>
<p><strong>IMPORTANTE:</strong> Es posible que en CentOS ya se encuentre ejecutándose una<br>
instancia de <code>httpd</code> (Apache2) por defecto. Antes de arrancar Nginx es<br>
necesario parar dicha instancia o Nginx informará con un error indicando que el puerto 80 (http/tcp) se encuentra ocupado.</p>
<pre><code>[root@centos /]# service nginx start
Starting nginx: nginx: [emerg] bind() to 0.0.0.0:80 failed (98: Address already in use)
</code></pre>
<p>Si accedemos ahora utilizando nuestro navegador a <code>http://localhost:80</code> veremos un útil, pero poco bonito, mensaje: <strong>Welcome to nginx!</strong> El fichero de configuración para ambos casos se encuentra en <code>/etc/nginx/nginx.conf</code>.</p>
<h2 id="instalandodesdelasfuentes">Instalando desde las fuentes</h2>
<p>Antes de comenzar, deberemos disponer en nuestro sistema de ciertas utilidades que serán de vital importancia para poder compilar en nuestro sistema, como <strong>gcc</strong>, <strong>make</strong> y otras librerias de desarrollo que se necesitan instaladas para poder compilar Nginx:</p>
<pre><code>root@debian:~# apt-get install gcc make libpcre3 libpcre3-dev zlib1g zlib1g-dev
</code></pre>
<p>Instalados los prerequisitos, procedemos entonces con la descarga de las<br>
fuentes de Nginx desde su sitio oficial:</p>
<pre><code>root@debian:~# wget http://nginx.org/download/nginx-1.2.4.tar.gz
</code></pre>
<p>A continuación descomprimimos y procedemos con la configuración, compilación e instalación:</p>
<pre><code>root@debian:~# tar xzf nginx-1.2.4.tar.gz 
root@debian:~# cd nginx-1.2.4/
root@debian:~/nginx-1.2.4# 
root@debian:~/nginx-1.2.4# ./configure &amp;&amp; make &amp;&amp; make install
</code></pre>
<p>Por defecto, Nginx se instala en <code>/usr/local/</code> aunque podemos modificar este comportamiento con <code>./configure --prefix=/path/to/install/</code>. Como comentaba antes, esta vez no contamos con scripts de inicio SysV, así que tendremos que arrancar Nginx de forma manual, ejecutando directamente el binario de <code>nginx</code>:</p>
<pre><code>root@debian:~# /usr/local/nginx/sbin/nginx
</code></pre>
<p>Si todo va bien, deberíamos tener inmediatamente el puerto 80 escuchando<br>
peticiones HTTP en nuestro sistema. Para para Nginx, también deberemos hacerlo de forma totalmente manual, utilizando la opción <code>-s</code> y pasándole el argumento <code>stop</code>; aunque también se puede hacer uso de otros argumentos como <code>quit</code>, <code>reopen</code> y <code>reload</code>:</p>
<pre><code>root@debian:~# /usr/local/nginx/sbin/nginx -s stop
</code></pre>
<h2 id="laconfiguracinpordefecto">La configuración por defecto</h2>
<p>La ubicación del fichero de configuración cambia dependiendo de la forma en que se haya instalado, a menos que cambiemos el comportamiento por defecto con <code>./configure --conf-path</code> al compilar desde las fuentes. Si Nginx ha sido instalado utilizando el sistema de paquetería se encontrará en<br>
<code>/etc/nginx/nginx.conf</code>. Sin embargo, si se ha compilado desde las fuentes y no se ha modificado la ruta del fichero de configuración, entonces lo más probable es que se encuentre en <code>/usr/local/nginx/conf/nginx.conf</code>. El contenido de este fichero es bastante similar en ambos casos, aunque por defecto, hay muchas lineas de ejemplo comentadas. Si eliminamos todos los comentarios, se puede apreciar que la configuración es bastante simple:</p>
<pre><code>root@debian:~# grep -v "#" /usr/local/nginx/conf/nginx.conf |uniq

worker_processes  1;

events {
    worker_connections  1024;
}

http {
    include       mime.types;
    default_type  application/octet-stream;

    sendfile        on;

    keepalive_timeout  65;

    server {
        listen       80;
        server_name  localhost;

        location / {
            root   html;
            index  index.html index.htm;
        }

        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   html;
        }

    }

}
</code></pre>
<p>Como se puede ver, la configuración se estructura en bloques delimitados por llaves {} (en inglés <em>curly braces</em>) haciéndola mucho más legible que un bloque de configuración de Apache2, por ejemplo. Como parámetros a destacar, me gustaría comentar los siguientes:</p>
<ul>
<li><code>worker_processess</code> : indica el número de workers/procesos de nginx que se van a arrancar simultaneamente. Si establecemos <code>worker_processes</code> con valor 2, se ejecutarán dos procesos worker de Nginx.</li>
<li><code>worker_connections</code> : hace referencia al número de conexiones por worker. Esto quiere decir que el número de conexiones que será capaz de servir nuestro servidor nginx corresponde a worker_processes x worker_connections. Según la configuración del ejemplo, solo aceptará 1024 conexiones simultaneas (1 (<em>worker_processes</em>) x 1024 (<em>worker_connections</em>)</li>
<li><code>http {}</code> : bloque donde se especifica la configuración de cada servidos. Es posible configurar varios bloques <code>server {}</code> en un mismo bloque <code>http {}</code>, utilizando diferentes puertos lógicamente.</li>
<li><code>server {}</code> : configuración para un servidor concreto, que normalmente se corresponderá con un número de puerto único.</li>
<li><code>listen 80;</code> : puerto de escucha de Nginx. Se corresponde con la directiva <code>Listen</code> de Apache2</li>
<li><code>server_name localhost;</code> : hostname o FQDN del servidor. Se corresponde con la directiva <code>ServerName</code> de Apache2.</li>
<li><code>location</code> : configuración de un <code>location</code> concreto. Se corresponde con la directiva <code>Location</code> en Apache2.</li>
<li><code>root</code> : directorio utilizado para buscar los ficheros estáticos. Se corresponde con la directiva <code>DocumentRoot</code> de Apache2.</li>
</ul>
<p>Bueno, eso es todo por hoy amigos, espero que os haya sido de utilidad para<br>
aquellos que no conocíais Nginx o aquellos que nunca lo habíais instalado. En próximos posts veremos diferentes tipos de configuración que podemos realizar con Nginx. Mientras tanto, podeis encontrar mucha más información en la wiki de Nginx en <a href="http://wiki.nginx.org/Main">http://wiki.nginx.org/Main</a></p>
<p>Un saludo a todos y no dudéis en comentar! ;-)</p>


            </section>

        </article>
    </main>
    <footer class="site-footer clearfix">
        <section class="copyright"><a href="../../../">Manuel Viera</a> © 2020</section>
        <section class="poweredby">Proudly published with <a href="https://ghost.org">Ghost</a></section>
    </footer>
</body>
