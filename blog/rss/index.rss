<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:media="http://search.yahoo.com/mrss/" version="2.0"><channel><title>Manuel Viera</title><description>I'm Manu and this is my personal lifelog. Here you'll find some tech posts, self-tracking metrics and other random thoughts.</description><link>http://manuelviera.com/</link><image><url>http://manuelviera.com/favicon.png</url><title>Manuel Viera</title><link>http://manuelviera.com/</link></image><generator>Ghost 3.19</generator><lastBuildDate>Sun, 13 Sep 2020 20:53:47 GMT</lastBuildDate><atom:link href="http://manuelviera.com/blog/rss/" rel="self" type="application/rss+xml"/><ttl>60</ttl><item><title>PostgreSQL and how to shield your databases well</title><description>Security matters, especially in databases. Let me show you how to secure your database in the right way.</description><link>http://manuelviera.com/blog/postgresql-and-how-to-shield-your-databases-well/</link><guid isPermaLink="false">5f5e101619f8b01255400608</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Sun, 13 Sep 2020 17:09:07 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1515974256630-babc85765b1d?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" medium="image"/><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;img src="https://images.unsplash.com/photo-1515974256630-babc85765b1d?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="PostgreSQL and how to shield your databases well"&gt;&lt;p&gt;The recipe:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;CREATE USER myuser with password 'secret_passwd' role postgres;
CREATE DATABASE mydatabase with owner myuser;
\connect mydatabase
REMOVE ALL ON DATABASE mydatabase FROM public;
REVOKE ALL ON SCHEMA public FROM public;    
ALTER SCHEMA public owner to myuser;
REVOKE myuser FROM postgres;
&lt;/code&gt;&lt;/pre&gt;
&lt;hr&gt;
&lt;h2 id="thedeepdive"&gt;The deep dive&lt;/h2&gt;
&lt;h3 id="firstthingsfirst"&gt;First things first&lt;/h3&gt;
&lt;p&gt;There are a few things you need to know to understand a bit about how PostgreSQL works.&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;CREATE USER&lt;/code&gt; and &lt;code&gt;CREATE GROUP&lt;/code&gt; are aliases for the &lt;code&gt;CREATE ROLE&lt;/code&gt; statement. A user is just a role with &lt;code&gt;LOGIN&lt;/code&gt; privileges.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; CREATE USER = CREATE ROLE + LOGIN privilege
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;PostgreSQL has a &lt;code&gt;public&lt;/code&gt; backend role, and every new user and role inherits permissions from it.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;When a new database is created, PostgreSQL creates a schema called &lt;code&gt;public&lt;/code&gt; and grants access on this schema to the &lt;code&gt;public&lt;/code&gt; backend role. Mmm... too many things called &lt;em&gt;public&lt;/em&gt; here, don't you think?&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Because of this default behavior, any user can connect to new databases and create objects in each database's &lt;code&gt;public&lt;/code&gt; schema.&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id="createtheuser"&gt;Create the user&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;CREATE USER myuser with password 'secret_passwd' role postgres;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This statement will create a new user, and it'll add &lt;code&gt;postgres&lt;/code&gt; role/user into &lt;code&gt;myuser&lt;/code&gt; role. I know, syntax may look confusing.&lt;/p&gt;
&lt;h3 id="createthedatabase"&gt;Create the database&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;CREATE DATABASE mydatabase with owner myuser;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;It creates a new database named &lt;code&gt;mydatabase&lt;/code&gt; and makes &lt;code&gt;myuser&lt;/code&gt; role the owner.&lt;/p&gt;
&lt;h3 id="securizesthedatabase"&gt;Securizes the database&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;\connect mydatabase
REMOVE ALL ON DATABASE mydatabase FROM public;
REVOKE ALL ON SCHEMA public FROM public;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Revokes all privileges on the new database and on the &lt;code&gt;public&lt;/code&gt; schema to the &lt;code&gt;public&lt;/code&gt; role. I mean, this revokes public access to the database.&lt;/p&gt;
&lt;h3 id="delegatesownershipofpublicschema"&gt;Delegates ownership of &lt;code&gt;public&lt;/code&gt; schema&lt;/h3&gt;
&lt;pre&gt;&lt;code&gt;ALTER SCHEMA public owner to myuser;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now the user is the real owner.&lt;/p&gt;
&lt;h3 id="thefinalpart"&gt;The final part&lt;/h3&gt;
&lt;p&gt;Execute this query if you want to revoke access to this database even to &lt;code&gt;postgres&lt;/code&gt; user. It's up to you.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;REVOKE myuser FROM postgres;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Remember. After this, even though &lt;code&gt;postgres&lt;/code&gt; user, which is the user with more RDS privileges, won't have access to that database. It'll only be accessible for &lt;code&gt;myuser&lt;/code&gt; user.&lt;/p&gt;
&lt;p&gt;In case you have to operate on it with &lt;code&gt;postgres&lt;/code&gt; user, you'll need to grant access for it.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;GRANT myuser TO postgres;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;If not, you'll get a &lt;code&gt;permission denied&lt;/code&gt; error.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;&lt;hr&gt;&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;If you have any question, doubt, or any improvement I could do, feel free to let me know in this &lt;a href="https://twitter.com/mviera/status/1305246434023870465"&gt;Twitter thread&lt;/a&gt; :)&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;&lt;!--kg-card-begin: html--&gt;If you found it useful, coffee is always appreciated. Thanks in advance!
&lt;script type="text/javascript" src="https://cdnjs.buymeacoffee.com/1.0.0/button.prod.min.js" data-name="bmc-button" data-slug="mviera" data-color="#eaa700" data-emoji data-font="Arial" data-text="Buy me a coffee" data-outline-color="#000" data-font-color="#000" data-coffee-color="#fff"&gt;&lt;/script&gt;&lt;!--kg-card-end: html--&gt;&lt;!--kg-card-begin: markdown--&gt;&lt;h3 id="moreinfoat"&gt;More info at&lt;/h3&gt;
&lt;p&gt;&lt;a href="https://aws.amazon.com/de/blogs/database/managing-postgresql-users-and-roles/"&gt;Managing PostgreSQL users and roles&lt;/a&gt;&lt;br&gt;
&lt;a href="https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/Appendix.PostgreSQL.CommonDBATasks.html#Appendix.PostgreSQL.CommonDBATasks.Access"&gt;Managing PostgreSQL Database Access&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.postgresql.org/docs/9.0/sql-grant.html"&gt;PostgreSQL GRANT Documentation&lt;/a&gt;&lt;br&gt;
&lt;a href="https://www.postgresql.org/docs/9.1/sql-revoke.html"&gt;PostgreSQL REVOKE Documentation&lt;/a&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Media consumption in August 2020</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 3 books &lt;output&gt;(14h 36 min)&lt;/output&gt; and 6 articles.&lt;/li&gt;
&lt;li&gt;Watched 3 movies &lt;output&gt;(9h 35 min)&lt;/output&gt;, 1 TV episodes &lt;output&gt;(51 min)&lt;/output&gt; and 1 talk &lt;output&gt;(19 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 3 video games &lt;output&gt;(30h 41 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Infrastructure-Code-Comprehensive-Managing-English-ebook/dp/B07WZ5SV99"&gt;Infrastructure as Code&lt;/a&gt; &lt;output&gt;(Austin Young)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 100%&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/libro-cerebro-quiere-Crecimiento-personal/dp/8416720622/"&gt;El libro que&lt;/a&gt;&lt;/p&gt;</description><link>http://manuelviera.com/blog/media-consumption-in-august-2020/</link><guid isPermaLink="false">5f29d2384501b8255139fd84</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 31 Aug 2020 21:40:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 3 books &lt;output&gt;(14h 36 min)&lt;/output&gt; and 6 articles.&lt;/li&gt;
&lt;li&gt;Watched 3 movies &lt;output&gt;(9h 35 min)&lt;/output&gt;, 1 TV episodes &lt;output&gt;(51 min)&lt;/output&gt; and 1 talk &lt;output&gt;(19 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 3 video games &lt;output&gt;(30h 41 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Infrastructure-Code-Comprehensive-Managing-English-ebook/dp/B07WZ5SV99"&gt;Infrastructure as Code&lt;/a&gt; &lt;output&gt;(Austin Young)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 100%&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/libro-cerebro-quiere-Crecimiento-personal/dp/8416720622/"&gt;El libro que tu cerebro no quiere leer&lt;/a&gt; &lt;output&gt;(David del Rosario)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 100%&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/gp/product/B01LXWQUFF/"&gt;Docker Deep Dive&lt;/a&gt; &lt;output&gt;(Nigel Poulton)&lt;/output&gt;&lt;br&gt;
▓▓▓░░░░░░░░░░░░ &lt;output&gt;Progress: 21%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="articles"&gt;Articles&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.sovereignman.com/trends/4-countries-welcoming-the-digital-nomads-during-covid-28499/"&gt;4 countries welcoming the digital nomads during Covid&lt;/a&gt; &lt;output&gt;(Simon Black)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.deprocrastination.co/blog/how-to-overcome-procrastination-by-understanding-the-fogg-behavior-model"&gt;How to stop procrastinating by using the Fogg Behavior Model&lt;/a&gt; &lt;output&gt;(deprocrastination.co)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.deprocrastination.co/blog/should-i-quit-video-games"&gt;Should I quit video games?&lt;/a&gt; &lt;output&gt;(deprocrastination.co)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.deprocrastination.co/blog/4-simple-ways-to-make-your-to-do-list-less-overwhelming"&gt;4 ways to make your to-do lists less overwhelming&lt;/a&gt; &lt;output&gt;(deprocrastination.co)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.defensecode.com/public/DefenseCode_Unix_WildCards_Gone_Wild.txt"&gt;Back To The Future: Unix Wildcards Gone Wild&lt;/a&gt; &lt;output&gt;(Leon Juranic)&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="talk"&gt;Talk&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=Rai3pwH3XrU"&gt;Guillaume Néry: The exhilarating peace of freediving&lt;/a&gt; &lt;output&gt;(TED)&lt;/output&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Find and the importance of parameters order</title><description>Parameter order matters. Especially in commands such as find. This post covers a common problem using find when deleting files and some tips to avoid it.</description><link>http://manuelviera.com/blog/find-and-the-importance-of-parameters-order/</link><guid isPermaLink="false">5f54f68bd6502f239e9073e6</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 10 Aug 2020 14:53:00 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1586769852836-bc069f19e1b6?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" medium="image"/><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;img src="https://images.unsplash.com/photo-1586769852836-bc069f19e1b6?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Find and the importance of parameters order"&gt;&lt;p&gt;Someone texted me with this tweet a few weeks ago. It made me remember how important the order of the parameters in some commands could be. Let's see the tweet.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;&lt;figure class="kg-card kg-embed-card"&gt;&lt;blockquote class="twitter-tweet" data-width="550"&gt;&lt;p lang="en" dir="ltr"&gt;I wanted to delete every file called &amp;quot;contents.html&amp;quot; so I ran:&lt;br&gt;&lt;br&gt;find -type f -delete -name contents.html&lt;br&gt;&lt;br&gt;It worked! But it also deleted every other file.&lt;br&gt;&lt;br&gt;find&amp;#39;s args are ordered. &amp;quot;delete&amp;quot; works on every match before it, ignoring anything after. &amp;quot;name&amp;quot; should have gone first.&lt;/p&gt;&amp;mdash; Tomas Sedovic (@TomasSedovic) &lt;a href="https://twitter.com/TomasSedovic/status/1226462687170875398?ref_src=twsrc%5Etfw"&gt;February 9, 2020&lt;/a&gt;&lt;/blockquote&gt;
&lt;script async src="https://platform.twitter.com/widgets.js" charset="utf-8"&gt;&lt;/script&gt;
&lt;/figure&gt;&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;As you may have noticed, some commands, such as find, take its parameters in order. So, this command:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;find -type f -delete -name contents.html
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;is completely different from this another one:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;find -type f -name contents.html -delete
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;mark&gt;The first one says find to look for every regular file and delete it. The second one says to look for every standard file that matches precisely with &lt;code&gt;contents.html&lt;/code&gt; and then delete it.&lt;/mark&gt;&lt;/p&gt;
&lt;p&gt;As Tomas says in his tweet, the first one worked, but unfortunately, deleted all files, which could be a mess in a production system.&lt;/p&gt;
&lt;h2 id="sohowtoavoidthiskindofsituation"&gt;So, how to avoid this kind of situation?&lt;/h2&gt;
&lt;p&gt;First of all, mainly when I'm in a production system, I prefer to start typing a «&lt;code&gt;#&lt;/code&gt;» as the first character. Why? Because I want to &lt;mark&gt;avoid executing an unfinished command by hitting the &lt;code&gt;Enter&lt;/code&gt; key by mistake&lt;/mark&gt;.&lt;/p&gt;
&lt;p&gt;Instead of this, I &lt;mark&gt;always print the find's output first to ensure that it finds what we need&lt;/mark&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;find -type f -name contents.html -exec echo {} \;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;This command will print the whole list of files which name matches precisely with «contents.html». Once we've ensured the output is ok, then we can delete them.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;find -type f -name contents.html -exec rm -f {} \;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Another alternative to this command could be passing the output through a pipe, and then use xargs and rm.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;find -type f -name contents.html | xargs rm -f
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Now you don't have excuses! Don't forget, parameter order matters. When in production systems, I always try not to be creative.&lt;/p&gt;
&lt;p&gt;So memorize the commands you usually use and write their parameters always the same order. Always. &lt;mark&gt;Being creative in production is not a good idea&lt;/mark&gt;. Don't deal with the devil ;-)&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Media consumption in July 2020</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 1 books &lt;output&gt;(458 min)&lt;/output&gt; and 13 articles.&lt;/li&gt;
&lt;li&gt;Watched 1 movies &lt;output&gt;(120 min)&lt;/output&gt;, 18 TV episodes &lt;output&gt;(819 min)&lt;/output&gt; and 2 talks &lt;output&gt;(123 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 2 video games &lt;output&gt;(2135 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/When-Scientific-Secrets-Perfect-Timing/dp/0525542787/"&gt;When. The Scientific Secrets Of Perfect Timing&lt;/a&gt; &lt;output&gt;(Daniel H Pink)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="games"&gt;Games&lt;/h4&gt;</description><link>http://manuelviera.com/blog/media-consumption-in-july-2020/</link><guid isPermaLink="false">5f29cb4a4501b8255139fd35</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Tue, 04 Aug 2020 21:09:58 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 1 books &lt;output&gt;(458 min)&lt;/output&gt; and 13 articles.&lt;/li&gt;
&lt;li&gt;Watched 1 movies &lt;output&gt;(120 min)&lt;/output&gt;, 18 TV episodes &lt;output&gt;(819 min)&lt;/output&gt; and 2 talks &lt;output&gt;(123 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 2 video games &lt;output&gt;(2135 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/When-Scientific-Secrets-Perfect-Timing/dp/0525542787/"&gt;When. The Scientific Secrets Of Perfect Timing&lt;/a&gt; &lt;output&gt;(Daniel H Pink)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="games"&gt;Games&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Ghost-Tsushima-Edici%C3%B3n-Est%C3%A1ndar-Exclusiva/dp/B085LYTVG1/"&gt;Ghost of Tsushima&lt;/a&gt; &lt;output&gt;(Sucker Punch)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/505-Games-Control/dp/B07K3GRFMS/"&gt;Control&lt;/a&gt; &lt;output&gt;(505 Games)&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedarticles"&gt;Recommended articles&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.inc.com/carmine-gallo/how-to-start-a-successful-negotiation-in-2-words.html"&gt;How to Start a Successful Negotiation in 2 Words&lt;/a&gt; &lt;output&gt;(Carmine Gallo)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="http://matthewrocklin.com/blog/work/2020/07/13/brevity"&gt;Write to a short attention span Brevity is the soul of wit&lt;/a&gt; &lt;output&gt;(Matthew Rocklin)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.davidfischer.name/2017/01/python-command-line-apps/"&gt;Python Command Line Apps&lt;/a&gt; &lt;output&gt;(David Fischer)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.inc.com/jeff-haden/5-words-that-make-your-emails-sound-indecisive-wishy-washy.html"&gt;5 Words That Make Your Emails Sound Indecisive and Wishy-Washy&lt;/a&gt; &lt;output&gt;(Jeff Haden)&lt;/output&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Mid-year review of my goals for 2020</title><description>Here's a review of how are going on my goals for 2020.</description><link>http://manuelviera.com/blog/mid-year-review-of-my-goals-for-2020/</link><guid isPermaLink="false">5f2566f9ba2e251b6d63a742</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Wed, 15 Jul 2020 17:00:00 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1544819667-9bfc1de23d4e?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" medium="image"/><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;img src="https://images.unsplash.com/photo-1544819667-9bfc1de23d4e?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Mid-year review of my goals for 2020"&gt;&lt;p&gt;At the beginning of 2020, I &lt;a href="https://manuelviera.com/blog/list-of-goals-for-2020/"&gt;released a list of my goals&lt;/a&gt; for the next 365 days. And now, here's a middle year review of &lt;a href="https://manuelviera.com/blog/list-of-goals-for-2020/"&gt;the 17 goals I set for this year&lt;/a&gt;.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;&lt;hr&gt;&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Improve my English skills&lt;/strong&gt;.&lt;br&gt;
On track: I started taking classes at a local English academy at the beginning of February. I also recovered my account at &lt;a href="https://www.babbel.com/"&gt;Babbel&lt;/a&gt; and started studying here too. At the end of April, I discovered &lt;a href="https://w.8belts.com/"&gt;8Belts&lt;/a&gt;. So I started an eight-month course to improve my speaking fluency with them too.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;s&gt;Travel more&lt;/s&gt;&lt;/strong&gt;.&lt;br&gt;
Failed: due to Covid-19, I'm not traveling this year.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Read at least 1 book a month&lt;/strong&gt;.&lt;br&gt;
On track: I've already read 10 books this year.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;s&gt;Swim more kms than 2019&lt;/s&gt;&lt;/strong&gt;.&lt;br&gt;
Failed: due to Covid-19, I stopped swimming. My last swim training was on the 9th of March, 2020.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Get back to bodyweight workouts&lt;/strong&gt;.&lt;br&gt;
Behind target: due to Covid-19, I'm doing outdoor sports since I finished my personal lockdown. I'm trying to add this kind of workouts but I'm not being consistent weekly.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;s&gt;Join some obstacle races&lt;/s&gt;&lt;/strong&gt;.&lt;br&gt;
Failed: due to Covid-19, all races were canceled. The one I joined was Spartan Virtual Race which was adapted to take part at home.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;s&gt;Learn French. Look for some classes&lt;/s&gt;&lt;/strong&gt;.&lt;br&gt;
Failed: Postponed at least till next year.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Have more fun time (playing videogames, etc)&lt;/strong&gt;.&lt;br&gt;
On track: I'm playing one video game a month.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Reduce procrastination&lt;/strong&gt;.&lt;br&gt;
On track: Working on it. I still procrastine but less than before. I'm tracking personal metrics to push myself do what I have to do.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Improve wellbeing &amp;amp; mental health&lt;/strong&gt;.&lt;br&gt;
Behind target: I started doing meditation since March, but I reduced the number of sessions in June and July. I want to get back to it as a daily routine.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Start doing yoga 2 or 3 times a week&lt;/strong&gt;.&lt;br&gt;
Behind target: I started practicing Yoga in March. I was motivated to do a Yoga session every day in the morning as part of my morning routine. But in June I decreased the number of sessions till zero in July. I want to recover it again as my morning or evening routine.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Help people&lt;/strong&gt;.&lt;br&gt;
Behing target: I was thinking about doing volunteering. Instead of this, I donated money during the pandemic.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;&lt;s&gt;TheRoot: make a website and publish there my photos&lt;/s&gt;&lt;/strong&gt;.&lt;br&gt;
Removed: I decided not put efforts on it.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Get back to blogging in this blog&lt;/strong&gt;.&lt;br&gt;
Behind target: I migrated this blog from Hugo to Ghost again. And I'm starting blogging again, but not as much as I'd like.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Media consumption in June 2020</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 1 books &lt;output&gt;(347 min)&lt;/output&gt; and 9 articles.&lt;/li&gt;
&lt;li&gt;Watched 1 movies &lt;output&gt;(115 min)&lt;/output&gt;, 15 TV episodes &lt;output&gt;(1155 min)&lt;/output&gt; and 0 talks &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 16 podcasts episodes &lt;output&gt;(617 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 2 video games &lt;output&gt;(149 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Do-Today-Procrastination-Productivity-Meaningful-ebook/dp/B07DRP1Q5W/"&gt;Do It Today&lt;/a&gt; &lt;output&gt;(Darius Foroux)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedarticles"&gt;Recommended articles&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://medium.com/@sawyerh/how-i-export-process-and-resurface-my-kindle-highlights-addc9de9af1a"&gt;How I export, analyze,&lt;/a&gt;&lt;/p&gt;</description><link>http://manuelviera.com/blog/media-consumption-in-june-2020/</link><guid isPermaLink="false">5f29c3a34501b8255139fcc1</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 06 Jul 2020 18:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 1 books &lt;output&gt;(347 min)&lt;/output&gt; and 9 articles.&lt;/li&gt;
&lt;li&gt;Watched 1 movies &lt;output&gt;(115 min)&lt;/output&gt;, 15 TV episodes &lt;output&gt;(1155 min)&lt;/output&gt; and 0 talks &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 16 podcasts episodes &lt;output&gt;(617 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 2 video games &lt;output&gt;(149 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Do-Today-Procrastination-Productivity-Meaningful-ebook/dp/B07DRP1Q5W/"&gt;Do It Today&lt;/a&gt; &lt;output&gt;(Darius Foroux)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedarticles"&gt;Recommended articles&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://medium.com/@sawyerh/how-i-export-process-and-resurface-my-kindle-highlights-addc9de9af1a"&gt;How I export, analyze, and resurface my Kindle highlights&lt;/a&gt; &lt;output&gt;(Sawyer Hollenshead)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.imore.com/how-i-use-shortcuts-automations-make-life-run-more-smoothly"&gt;How I use Shortcuts automations to make life run more smoothly&lt;/a&gt; &lt;output&gt;(Joseph Keller)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://blog.cloudflare.com/why-is-there-a-v-in-sigsegv-segmentation-fault/"&gt;Why is there a &amp;quot;V&amp;quot; in SIGSEGV Segmentation Fault?&lt;/a&gt; &lt;output&gt;(Marek Majkowski &amp;amp; David Wragg)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.inc.com/jessica-stillman/your-emails-are-36-percent-more-likely-to-get-a-reply-if-you-close-them-this-way.html"&gt;Your Emails Are 36 Percent More Likely to Get a Reply If You Close Them This Way&lt;/a&gt; &lt;output&gt;(Jessica Stillman / Inc.com)&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedvideogames"&gt;Recommended video games&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/The-Last-of-us-Hits/dp/B07FF8XJWT/"&gt;The Last of Us: Remastered&lt;/a&gt; &lt;output&gt;(Naughty Dog)&lt;/output&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Media consumption in May 2020</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 2 books &lt;output&gt;(222 min)&lt;/output&gt; and 7 articles.&lt;/li&gt;
&lt;li&gt;Watched 0 movies &lt;output&gt;(0 min)&lt;/output&gt;, 0 TV episodes &lt;output&gt;(0 min)&lt;/output&gt; and 6 talks &lt;output&gt;(1373 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 3 video games &lt;output&gt;(592 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/THINK-STRAIGHT-Change-Thoughts-English-ebook/dp/B077NJWFR3/"&gt;Think Straight&lt;/a&gt; &lt;output&gt;(Darius Foroux)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Mi-cuaderno-estoico-prosperar-control-ebook/dp/B07VN9SL4M/"&gt;Mi cuaderno estoico&lt;/a&gt; &lt;output&gt;(Massimo Pigliucci)&lt;/output&gt;&lt;br&gt;
▓░░░░░░░░░░░░░░ &lt;output&gt;Progress: 0-7%&lt;/output&gt;&lt;/p&gt;</description><link>http://manuelviera.com/blog/media-consumption-in-may/</link><guid isPermaLink="false">5f26defaba2e251b6d63a7a1</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Wed, 03 Jun 2020 22:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Read 2 books &lt;output&gt;(222 min)&lt;/output&gt; and 7 articles.&lt;/li&gt;
&lt;li&gt;Watched 0 movies &lt;output&gt;(0 min)&lt;/output&gt;, 0 TV episodes &lt;output&gt;(0 min)&lt;/output&gt; and 6 talks &lt;output&gt;(1373 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Listened to 0 podcasts episodes &lt;output&gt;(0 min)&lt;/output&gt;.&lt;/li&gt;
&lt;li&gt;Played 3 video games &lt;output&gt;(592 min)&lt;/output&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="books"&gt;Books&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/THINK-STRAIGHT-Change-Thoughts-English-ebook/dp/B077NJWFR3/"&gt;Think Straight&lt;/a&gt; &lt;output&gt;(Darius Foroux)&lt;/output&gt;&lt;br&gt;
▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓ &lt;output&gt;Progress: 0-100%&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.amazon.es/Mi-cuaderno-estoico-prosperar-control-ebook/dp/B07VN9SL4M/"&gt;Mi cuaderno estoico&lt;/a&gt; &lt;output&gt;(Massimo Pigliucci)&lt;/output&gt;&lt;br&gt;
▓░░░░░░░░░░░░░░ &lt;output&gt;Progress: 0-7%&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedarticles"&gt;Recommended articles&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://ohdear.app/blog/resolving-the-addtrust-external-ca-root-certificate-expiration"&gt;Resolving the AddTrust External CA Root certificate expiration&lt;/a&gt; &lt;output&gt;(Mattias Geniar)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.usenix.org/sites/default/files/conference/protected-files/lisa19_maheshwari.pdf"&gt;Linux Productivity Tools&lt;/a&gt; &lt;output&gt;(Ketan M.)&lt;/output&gt;&lt;/p&gt;
&lt;p&gt;&lt;a href="https://thenewstack.io/bare-metal-in-a-cloud-native-world/"&gt;Bare Metal in a Cloud Native World&lt;/a&gt; &lt;output&gt;(Alex Ellis/The New Stack)&lt;/output&gt;&lt;/p&gt;
&lt;h4 id="recommendedtalk"&gt;Recommended Talk&lt;/h4&gt;
&lt;p&gt;&lt;a href="https://www.youtube.com/watch?v=Avcligc5Cjo"&gt;The 8 Belts Method | TEDxCibeles&lt;/a&gt; &lt;output&gt;(Anxo Pérez)&lt;/output&gt;&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>List of goals for 2020</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Improve my English skills.&lt;br&gt;
This is &lt;mark&gt;my number one goal for this year&lt;/mark&gt;. I want to start taking English classes.&lt;/li&gt;
&lt;li&gt;Travel more.&lt;br&gt;
Make plans over calendar. Take WowTrips (or similar) into account for weekend trips.&lt;/li&gt;
&lt;li&gt;Read at least 1 book a month.&lt;/li&gt;
&lt;li&gt;Swim more kms than 2019.&lt;/li&gt;
&lt;li&gt;Get back to&lt;/li&gt;&lt;/ul&gt;</description><link>http://manuelviera.com/blog/list-of-goals-for-2020/</link><guid isPermaLink="false">5f251ec4ba2e251b6d63a6f4</guid><category>self-tracking</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 06 Jan 2020 23:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;ul&gt;
&lt;li&gt;Improve my English skills.&lt;br&gt;
This is &lt;mark&gt;my number one goal for this year&lt;/mark&gt;. I want to start taking English classes.&lt;/li&gt;
&lt;li&gt;Travel more.&lt;br&gt;
Make plans over calendar. Take WowTrips (or similar) into account for weekend trips.&lt;/li&gt;
&lt;li&gt;Read at least 1 book a month.&lt;/li&gt;
&lt;li&gt;Swim more kms than 2019.&lt;/li&gt;
&lt;li&gt;Get back to bodyweight workouts.&lt;/li&gt;
&lt;li&gt;Join some obstacle races.&lt;/li&gt;
&lt;li&gt;Learn French. Look for some classes.&lt;/li&gt;
&lt;li&gt;Improve wellbeing &amp;amp; mental health.&lt;/li&gt;
&lt;li&gt;Have more fun time (playing videogames, etc).&lt;/li&gt;
&lt;li&gt;Reduce procrastination.&lt;/li&gt;
&lt;li&gt;Read more tech articles every week.&lt;/li&gt;
&lt;li&gt;Start doing meditation.&lt;/li&gt;
&lt;li&gt;Start doing yoga 2 or 3 times a week.&lt;/li&gt;
&lt;li&gt;Help people.&lt;/li&gt;
&lt;li&gt;TheRoot: make a website and publish there my photos.&lt;/li&gt;
&lt;li&gt;Get back to blogging in this blog.&lt;/li&gt;
&lt;/ul&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Compartiendo ficheros con GlusterFS</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro servicio, en Internet; también aparecen nuevos problemas a resolver que antes incluso ni habíamos reparado en ellos. Uno de estos problemas es &lt;strong&gt;la compartición de ficheros&lt;/strong&gt; entre servidores.&lt;/p&gt;
&lt;p&gt;En mi opinión, a día de hoy éste sigue siendo&lt;/p&gt;</description><link>http://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/</link><guid isPermaLink="false">5ee79a5311a5bb564c241b61</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Tue, 02 Aug 2016 00:00:00 GMT</pubDate><media:content url="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" medium="image"/><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;img src="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib=rb-1.2.1&amp;q=80&amp;fm=jpg&amp;crop=entropy&amp;cs=tinysrgb&amp;w=2000&amp;fit=max&amp;ixid=eyJhcHBfaWQiOjExNzczfQ" alt="Compartiendo ficheros con GlusterFS"&gt;&lt;p&gt;Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro servicio, en Internet; también aparecen nuevos problemas a resolver que antes incluso ni habíamos reparado en ellos. Uno de estos problemas es &lt;strong&gt;la compartición de ficheros&lt;/strong&gt; entre servidores.&lt;/p&gt;
&lt;p&gt;En mi opinión, a día de hoy éste sigue siendo un dolor de cabeza para muchos Sysadmins o Systems Architects. Hay muchas formas de compartir ficheros entre servidores como NFS, S3FS, FileConveyor, un crontab con un rsync entre servidores. Hay muchas soluciones, algunas mejores y otras peores; pero hoy quería compartir la que hasta ahora creo que puede ser una buena solución para compartir ficheros, usando &lt;strong&gt;GlusterFS&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;a href="https://www.glusterfs.org"&gt;GlusterFS&lt;/a&gt; es un sistema de ficheros escalable en red, con el que poder crear soluciones de almacenamiento distribuidos por la red y de gran capacidad. Ni que decir tiene que &lt;strong&gt;GlusterFS&lt;/strong&gt; es software libre.&lt;/p&gt;
&lt;h2 id="antesdeempezar"&gt;Antes de empezar&lt;/h2&gt;
&lt;p&gt;Normalmente en los despliegues que hacemos en AWS en &lt;a href="http://crononauta.com"&gt;Crononauta&lt;/a&gt;, siempre utilizamos un mínimo de un par de instancias EC2 para el sistema de almacenamiento en red con &lt;strong&gt;GlusterFS&lt;/strong&gt;. Además, a cada una de estas dos instancias EC2, hacemos &lt;em&gt;attach&lt;/em&gt; de un disco EBS donde almacenaremos los ficheros en el clúster de ficheros en red. Esto nos permite tener &lt;strong&gt;redundancia&lt;/strong&gt; en los datos, &lt;strong&gt;alta disponibilidad&lt;/strong&gt; y &lt;strong&gt;escalabilidad horizontal&lt;/strong&gt; en el servicio. Con lo cual, tendremos un par de instancias que mantienen en clúster de almacenamiento actuando como GlusterFS Server y por otro lado, tendremos los clientes de GlusterFS que montarán este volumen compartido por la red.&lt;/p&gt;
&lt;p&gt;Como detalle, en &lt;strong&gt;Crononauta&lt;/strong&gt; siempre usamos Debian como distribución, en este caso contamos con una Debian 8 (Jessie), aunque es totalmente aplicable a cualquier distribución basada en Debian como Ubuntu y/o derivadas.&lt;/p&gt;
&lt;p&gt;Una vez tenemos esto, podemos empezar a trabajar... ;-)&lt;/p&gt;
&lt;h2 id="particionandolosdiscos"&gt;Particionando los discos&lt;/h2&gt;
&lt;p&gt;Utilizaremos &lt;strong&gt;XFS&lt;/strong&gt; como sistema de ficheros para el volumen compartido en red. Por lo que necesitaremos instalar las utilidades para trabajar con XFS, si no las tenemos ya instaladas.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt-get install xfsprogs
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El siguiente paso será crear una partición en el volumen, en mi caso es &lt;code&gt;/dev/xvdf&lt;/code&gt;. Usaremos &lt;code&gt;fdisk&lt;/code&gt; para ello:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;fdisk /dev/xvdf
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;y una vez en la shell interactiva de &lt;code&gt;fdisk&lt;/code&gt;, teclearemos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;&lt;code&gt;n&lt;/code&gt; para crear una nueva partición. No necesitamos especificar nada más, así que los siguientes datos que pide podemos usar los valores por defecto que ofrece &lt;code&gt;fdisk&lt;/code&gt;, asi que pulsaremos &lt;code&gt;Intro&lt;/code&gt; hasta finalizar. Una vez hecho esto, seguiremos dentro de la shell interactiva de &lt;code&gt;fdisk&lt;/code&gt;, y habremos creado una partición primaria que ocupa todo el espacio del volumen.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;w&lt;/code&gt; indicando que queremos escribir esta definición de partición en el disco y hacerla efectiva.&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Ya tenemos la partición en el volumen, así que ahora la formatearemos y la añadiremos a nuestro &lt;code&gt;/etc/fstab&lt;/code&gt; para montarla en cada arranque del sistema. Seguiremos los siguientes pasos:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mkfs.xfs -i size=512 /dev/xvdf1
mkdir -p /export/brick1
echo &amp;quot;/dev/xvdf1 /export/brick1 xfs defaults 1 2&amp;quot;  &amp;gt;&amp;gt; /etc/fstab
mount -a &amp;amp;&amp;amp; mount
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="instalandoglusterfs"&gt;Instalando GlusterFS&lt;/h2&gt;
&lt;p&gt;Ya tenemos el volumen preparado para GlusterFS, ahora instalaremos el servicio.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt-get update
apt-get install glusterfs-server glusterfs-client glusterfs-common
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Importante realizar este paso en aquellas instancias / servidores que vayan a actuar como un GlusterFS Server.&lt;/p&gt;
&lt;p&gt;Lo siguiente que haremos será configurar nuestro fichero &lt;code&gt;/etc/hosts&lt;/code&gt; para definir unos nombres DNS para nuestros GlusterFS Servers. También es posible hacerlo con un DNS interno. Si vuestros servidores, como en el caso de AWS EC2, contáis con IPs privadas, mejor usar esas. Si no, podéis usar las IPs pública.&lt;/p&gt;
&lt;p&gt;Definiremos algo como lo siguiente en &lt;code&gt;/etc/hosts&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;xxx.xxx.xxx.xxx    gfs01.example.com
xxx.xxx.xxx.xxx    gfs02.example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="unanilloparagobernarlosatodos"&gt;Un anillo para gobernarlos a todos&lt;/h2&gt;
&lt;p&gt;Ya tenemos GlusterFS preparado para ser configurado. Ahora tendremos que configurar el &lt;em&gt;anillo de confianza&lt;/em&gt; entre ambos servidores GlusterFS Server. Para ello serán necesarios los siguientes pasos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Desde &lt;code&gt;gfs01.example.com&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; gluster peer probe gfs02.example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Desde &lt;code&gt;gfs02.example.com&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt; gluster peer probe gfs01.example.com
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Es &lt;strong&gt;muy importante&lt;/strong&gt; que haya conectividad entre ambos servidores, en caso contrario, los comandos anteriores fallarán. Si estás en AWS, asegúrate de tener bien configurado el &lt;strong&gt;Security Group&lt;/strong&gt; para ambas instancias de storage.&lt;/p&gt;
&lt;p&gt;Si todo ha ido bien, tendremos el pool de confianza funcionando, así que lo siguiente será definir el volumen compartido. Usaremos la siguiente instrucción desde uno de los servidores GlusterFS:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gluster volume create gv0 replica 2 gfs01.example.com:/export/brick1/&amp;lt;volume-name&amp;gt; gfs02.example.com:/export/brick1/&amp;lt;volumen-name»
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Por último, iniciaremos el volumen que justo acabamos de crear:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gluster volume start gv0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como detalle, podemos ver información sobre el volumen con la siguiente instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;gluster volume info
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Llegados a este punto, el cluster de almacenamiento debe estar totalmente operativo. Si queremos hacer una prueba, es posible crear el punto de montaje hacia el volumen compartido y probar si se replican correctamente los ficheros. Crearemos el punto de montaje en &lt;code&gt;gfs01.example.com&lt;/code&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mount -t glusterfs localhost:/gv0 /mnt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ahora crearemos ficheros para comprobar si el funcionamiento de GlusterFS es correcto. Con la siguiente instrucción crearemos diez ficheros vacíos en el punto de montaje previamente creado:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;touch /mnt/test-file{1..10}.txt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si GlusterFS funciona correctamente, debemos poder ver estos mismos ficheros en &lt;code&gt;gfs02.example.com&lt;/code&gt; en el directorio &lt;code&gt;/export/brick1/&amp;lt;volume-name&amp;gt;&lt;/code&gt;.&lt;/p&gt;
&lt;h2 id="configurandolosclientes"&gt;Configurando los clientes&lt;/h2&gt;
&lt;p&gt;Nos falta muy poco para terminar, ya sólo nos falta configurar los clientes de GlusterFS. Necesitaremos tener instalado el cliente de GlusterFS &lt;code&gt;glusterfs-client&lt;/code&gt; si no lo tenemos instalado.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;apt-get install glusterfs-client
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Hecho esto, podremos probar a montar el volumen compartido por la red, y si todo va bien debemos ver los ficheros de prueba creados previamente.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mount -t glusterfs gfs01.example.com:/gv0 /mnt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Por último, necesitaremos un script &lt;code&gt;/etc/init.d/glusterfs-mount&lt;/code&gt; que se encargue de montar el volumen compartido. En mi caso suelo utilizar el siguiente script:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;#! /bin/bash
### BEGIN INIT INFO
# Provides:          glusterfs-mount
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5 
# Default-Stop:      0 1 6 
# Short-Description: Start daemon at boot time
# Description:       Enable service provided by daemon.
### END INIT INFO
#

MOUNTPOINT=&amp;quot;/var/www/shared&amp;quot;
GLUSTERFS_SERVER=&amp;quot;gfs01.example.com&amp;quot;
GLUSTERFS_VOLUME=&amp;quot;gv0&amp;quot;

# Some things that run always at boot
mount -t glusterfs $GLUSTERFS_SERVER:/$GLUSTERFS_VOLUME $MOUNTPOINT
#
# Uncomment this line if you need to start Apache after mount glusterFS volume
# service apache2 start
#
# Carry out specific functions when asked to by the system
case &amp;quot;$1&amp;quot; in
  start)
    echo &amp;quot;Mounting glusterfs volumes &amp;quot;
    mount -t glusterfs $GLUSTERFS_SERVER:/$GLUSTERFS_VOLUME $MOUNTPOINT
    ;;
  stop)
    echo &amp;quot;Unmount glusterfs volumes&amp;quot;
    umount $MOUNTPOINT
    ;;
  *)
    echo &amp;quot;Usage: /etc/init.d/glusterfs-mount {start|stop}&amp;quot;
    exit 1
    ;;
esac
exit 0
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Ya solo nos queda dar permisos de ejecución a nuestro script y configurarlo para que se ejecute durante el inicio del sistema:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;chmod +x /etc/init.d/glusterfs-mount
update-rc.d glusterfs-mount defaults
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="faq"&gt;FAQ&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Q:&lt;/strong&gt; No puedo crear el anillo de confianza. Los comandos &lt;code&gt;gluster peer probe&lt;/code&gt; terminan fallando con un timeout ¿Qué ocurre?&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A:&lt;/strong&gt; Es muy probable que sea un problema de conectividad entre ambos GlusterFS Servers. Revisa si hay algún firewall entre ellos que pueda estar bloqueando conexiones TCP y UDP&lt;br&gt;
entre ellos. Puedes ver los puertos abiertos con &lt;code&gt;netstat -ntlp&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Si estás en AWS, asegúrate que el &lt;strong&gt;Security Group&lt;/strong&gt; que usan ambas instancias tienen permitidos los accesos a puerto TCP y UDP entre ellos.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Q:&lt;/strong&gt; No puedo montar el volumen compartido desde las instancias que actuan como clientes. El comando &lt;code&gt;mount&lt;/code&gt; responde con &lt;code&gt;mount failed&lt;/code&gt;. ¿Qué puede estar ocurriendo?&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A:&lt;/strong&gt; Al igual que con los servidores GlusterFS, revisa que las instancias clientes tienen conectividad con los servidores. GlusterFS suele abrir un rango de puertos para cada volumen exportado (gv0, gv1, gv2, etc). Es recomendable permitir todo el tráfico TCP y UDP entre las instancias clientes y servidor. De otra forma es probable que alguna vez tengamos problemas al montar los volumenes.&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Q:&lt;/strong&gt; Sigo sin poder crear el punto de montaje desde las instancias clientes. El comando &lt;code&gt;mount&lt;/code&gt; indica que hubo un problema. La conectividad entre cliente y servidor de GlusterFS es correcta ¿Qué problema puede haber?&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A:&lt;/strong&gt; Es muy común que las versiones de las distribuciones entre cliente y servidor difieran. Si esto es así, es muy probable que la versión de &lt;code&gt;glusterfs-client&lt;/code&gt; difiera de la versión de &lt;code&gt;glusterfs-server&lt;/code&gt;. En este caso, es muy probable que no podamos montar el volumen compartido con el driver &lt;code&gt;glusterfs&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;GlusterFS permite montar los volumenes con el driver de NFS. En este tipo de situaciones es normal recurrir al driver de NFS para crear el punto de montaje. Para ello se necesita tener instalado &lt;code&gt;nfs-common&lt;/code&gt; y crear el punto de montaje con la siguiente instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mount -t nfs gfs01.example.com:/gv0 /var/www/shared
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;Q:&lt;/strong&gt; ¿Por qué crear un script en &lt;code&gt;/etc/init.d&lt;/code&gt; pudiendo configurar el montaje en el fichero &lt;code&gt;/etc/fstab&lt;/code&gt;?&lt;/li&gt;
&lt;/ul&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;A:&lt;/strong&gt; Sí, es posible configurar el punto de montaje en &lt;code&gt;/etc/fstab&lt;/code&gt;, pero a diferencia del resto de punto de montajes, en este caso se trata de un volumen compartido por la red. Es muy probable que cuando se monten los volumenes de &lt;code&gt;/etc/fstab&lt;/code&gt;, aún no esté disponible la red en el sistema, con lo cual el montaje no solo fallará, sino que además es posible que ralentize el arranque del sistema hasta que el intento de montar el volumen por la red de un Timeout. Por eso es más fiable hacerlo con un script en &lt;code&gt;init.d&lt;/code&gt;, una vez la red ya esté disponible.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Creo que esto es todo. ¿Encontráis algún otro problema? ¡Dejadlo en los comentarios!&lt;br&gt;
Saludos.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>AWS Summit Barcelona 2015</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;No suelo viajar mucho por trabajo pero, desde que trabajo en Crononauta, siempre subo a Barcelona varias veces al año. Y además de trabajar, esta vez hemos aprovechado para asistir al &lt;strong&gt;AWS Summit 2015 Barcelona&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;El evento de Amazon Web Services, tuvo lugar durante todo la jornada del Jueves 5&lt;/p&gt;</description><link>http://manuelviera.com/blog/aws-summit-barcelona-2015/</link><guid isPermaLink="false">5ee798b111a5bb564c241b3a</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Thu, 12 Nov 2015 00:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;No suelo viajar mucho por trabajo pero, desde que trabajo en Crononauta, siempre subo a Barcelona varias veces al año. Y además de trabajar, esta vez hemos aprovechado para asistir al &lt;strong&gt;AWS Summit 2015 Barcelona&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;El evento de Amazon Web Services, tuvo lugar durante todo la jornada del Jueves 5 de Noviembre en Fira de Barcelona, Montjuïc. Nunca había estado en Fira Barcelona, con lo cual me impresionó el edificio, el salon de actos principal y toda la organización del evento. Especialmente el catering, que me pareció muy bueno. La calidad de la comida era bastante buena, y en ningún momento faltó de nada. En todo momento había snacks, zumos, agua, café y bollería.&lt;/p&gt;
&lt;p&gt;En cuanto al evento, el AWS Summit Barcelona fue inaugurado por Guillem Veiga, Head of AWS en Iberia, con una breve introducción de todo lo que íbamos a poder ver durante la jornada.&lt;/p&gt;
&lt;h3 id="awsreinvent2015"&gt;AWS re:Invent 2015&lt;/h3&gt;
&lt;p&gt;Luego vino &lt;strong&gt;Jeff Barr&lt;/strong&gt;, el Chief Evangelist de AWS; que muchos lo conocemos ser quien administra y publica en el blog de AWS. Quién mejor que él, que lleva 13 años trabajando en AWS, para contarnos cómo ha ido evolucionando AWS a lo largo de estos años. Entre otras cosas nos contaba cómo en 2007 AWS sólo contaba con tres servicios (EC2, RDS y S3), y actualmente en 2015 cuentan con más de 50 servicios, operando en 11 regiones diferentes. Jeff fue dando paso a ponencias como la de &lt;strong&gt;Luis Bosque&lt;/strong&gt; de &lt;strong&gt;CartoDB&lt;/strong&gt;, que nos explicó cómo funciona CartoDB, el volumen de datos que manejan y por qué decidieron migrar a AWS; o los chicos de &lt;strong&gt;BEEVA&lt;/strong&gt; que nos enseñaron su proyecto de Big Data con algoritmos de Machine Learning para ofrecer información útil a sus clientes sobre ventas de artículos por zonas, o incluso ventas de productos relacionados con su sector.&lt;/p&gt;
&lt;h3 id="awssecurity"&gt;AWS Security&lt;/h3&gt;
&lt;p&gt;A continuación vino &lt;strong&gt;Bill Murray&lt;/strong&gt;, pero no el actor de cine, sino el director de AWS Security. Lo que más me llamó la atención de su ponencia fue la presentación de un nuevo producto llamado &lt;strong&gt;Amazon Inspector&lt;/strong&gt; que, de momento, está en &amp;quot;preview&amp;quot; y sólo está disponible en la región US West (Oregon).&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Amazon Inspector&lt;/strong&gt; te permite analizar el comportamiento de las aplicaciones que ejecutas en AWS y te ayuda a identificar fallos potenciales de seguridad.&lt;/p&gt;
&lt;p&gt;Básicamente te permite instalar un agente en las instancias EC2, para poder&lt;br&gt;
ejecutar una serie de checks que te ayudarán a comprobar la seguridad de tu&lt;br&gt;
plataforma. Bill nos enseñó algunos checks básicos como el login SSH con root.&lt;/p&gt;
&lt;p&gt;Una vez se ejecutan estos checks, te permite realizar un análisis general de la seguridad de la plataforma.&lt;/p&gt;
&lt;p&gt;De momento este servicio está algo limitado, porque&lt;br&gt;
los agentes sólo pueden ser instalados en Amazon Linux AMI 2015.03 (o&lt;br&gt;
posteriores) o Ubuntu Server 14.04 LTS, de momento.&lt;/p&gt;
&lt;h3 id="todoloquenecesitassabersobreautoscaling"&gt;Todo lo que necesitas saber sobre Autoscaling&lt;/h3&gt;
&lt;p&gt;Seguro que si has trabajado ya sobre AWS, esto ya te suene de algo, o al menos ese era mi caso. Realmente el tema de Autoscaling es un servicio, sin coste adicional, que ofrece AWS dentro de EC2; y que permite que tu infraestructura escale horizontalmente, siempre y cuando esté preparada para ello, claro está.&lt;/p&gt;
&lt;p&gt;Realmente, que una plataforma pueda escalar horizontalmente, no sólo depende de que configuremos o no el Autoscaling en EC2. Para que una plataforma pueda escalar horizontalmente debe estar bien diseñada, tanto a nivel de sistemas, separando los servicios / stack de software de forma inteligente; como a nivel de código, porque la aplicación también debe estar preparada para escalar.&lt;/p&gt;
&lt;p&gt;Si tenemos bien resuelta esta parte, AWS nos proporciona los componentes&lt;br&gt;
necesarios para escalar nuestra aplicación de forma más o menos sencilla,&lt;br&gt;
configurando los siguientes componentes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Launch Configuration&lt;/strong&gt;: permite definir la &amp;quot;template&amp;quot; de instancia EC2 que vamos a arrancar, en caso de que necesitemos auto escalar. Podremos definir qué AMI queremos usar, almacenamiento,&lt;br&gt;
security group, etc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;Auto Scaling Group&lt;/strong&gt;: permite crear un grupo de Autoscaling basado en un Launch Configuration.&lt;br&gt;
Básicamente podemos definir el número mínimo de instancias en el grupo de auto escalado, número máximo de instancias, zonas de disponibilidad sobre la que vamos a operar, si queremos añadir las instancias bajo un balanceador o ELB (Elastic Load Balancer), etc.&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;CloudWatch Alarms&lt;/strong&gt;: &lt;strong&gt;CloudWatch&lt;/strong&gt; es el servicio de monitorización de AWS. Es un servicio que no supone coste adicional, siempre que no activemos el &lt;em&gt;Detailed Monitoring&lt;/em&gt;. Nos permitirá monitorizar nuestro Autoscaling Group, y en base a las alertas que configuremos, nuestra plataforma será capaz de lanzar nuevas instancias cuando sea necesario. Por ejemplo, podremos arrancar un par de instancias más en el caso de que el uso de CPU del grupo de Autoscaling supere el 80% durante 10 minutos, y volver a eliminarlas cuando la CPU del Autoscaling group baje del&lt;br&gt;
40% durante 15 minutos.&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Últimamente he trabajado mucho con esto, así que seguramente le dedique un post donde pueda entrar más en detalle.&lt;/p&gt;
&lt;h3 id="gestionandocontainersaescala"&gt;Gestionando Containers a Escala&lt;/h3&gt;
&lt;p&gt;En esta Live Demo se presentaba el servicio &lt;strong&gt;EC2 Container Service&lt;/strong&gt;, que&lt;br&gt;
permite desplegar, gestionar y escalar contenedores &lt;strong&gt;Docker&lt;/strong&gt; donde ejecutar aplicaciones, servicios o simplemente scripts para realizar cálculos.&lt;/p&gt;
&lt;p&gt;En mi caso aún no tengo muchos conocimientos sobre Docker, pero si has trabajado con él, te facilitará la gestión de clusters de contenedores en varias instancias EC2. Aunque si esto no te gusta siempre puedes montar Docker desde cero en una instancia EC2.&lt;/p&gt;
&lt;p&gt;La demo que hizo el ponente era desplegar una página web sencilla dentro de un cluster Docker. Podéis desplegar esta aplicación de ejemplo desde el Dashboard de ECS.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;ECS&lt;/strong&gt; básicamente te abstrae de todo lo referente a la administración de Docker, y te permite definir un cluster en unos cuantos pasos sencillos. Durante estos pasos puedes elegir la memoria asignada a cada contenedor, mapeo de puertos que se suele hacer en Docker, usar un ELB (balanceador) para el cluster, e incluso definir la cantidad y tipo de instancias EC2 en las que queremos alojar el cluster.&lt;/p&gt;
&lt;p&gt;En mi caso me apunto estudiar este servicio, porque la verdad es que los&lt;br&gt;
conocimientos que tengo de él son bastante básicos.&lt;/p&gt;
&lt;h3 id="desplieguecontinuoenaws"&gt;Despliegue Continuo en AWS&lt;/h3&gt;
&lt;p&gt;En esta Live Demo se presentaban tres servicios: &lt;strong&gt;AWS CodeCommit&lt;/strong&gt;, &lt;strong&gt;AWS&lt;br&gt;
CodePipeline&lt;/strong&gt; y &lt;strong&gt;AWS CodeDeploy&lt;/strong&gt;. Estos tres servicios están dentro de la categoría de &lt;em&gt;Developers Tools&lt;/em&gt; y permiten alojar código fuente, Integración Continua y deploy de código, respectivamente. A decir verdad me perdí la demo de los dos primeros, pero pude asistir a la de &lt;strong&gt;AWS CodeDeploy&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CodeDeploy&lt;/strong&gt; permite desplegar código fuente de forma relativamente sencilla. En muy resumidas cuentas, este servicio se basa en tener&lt;br&gt;
un agente ejecutándose en cada una de las instancias y, una vez configurado un &lt;em&gt;Deployment Group&lt;/em&gt;, es posible especificar una URL hacía un fichero zip alojado en un Bucket de S3 o repositorio Github. Mediante un fichero de configuración, que debe ir dentro del repositorio de código, podremos indicar al agente dónde desplegar el código, o incluso ejecutar comandos tras realizar el deploy, en un &lt;em&gt;post-hook&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;CodeDeploy&lt;/strong&gt; permite configurar cuándo un deployment se considera &amp;quot;ok&amp;quot; o &amp;quot;fallido&amp;quot;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;One at a Time&lt;/strong&gt;: se considera un deployment fallido si falla en al menos una de las instancias del &lt;em&gt;Deployment Group&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;Half at a Time&lt;/strong&gt;: se considera fallido si falla en la mitad de las instancias del &lt;em&gt;Deployment Group&lt;/em&gt;.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;All at Once&lt;/strong&gt;: se considera deployment fallido si falla en todas las instancias del &lt;em&gt;Deployment Group&lt;/em&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Quizás una de las cosas que no me convencen de CodeDeploy es que se necesita tener un agente con un puerto abierto en cada instancia, lo cual puede añadir un punto de fallo en cuanto a seguridad; y que, si no estoy equivocado, no tiene opción de rollback. Si algo va mal, la única opción es volver a desplegar una versión del código que sepamos que funciona bien.&lt;/p&gt;
&lt;h3 id="utilizandospotinstancesdeamazonec2"&gt;Utilizando Spot Instances de Amazon EC2&lt;/h3&gt;
&lt;p&gt;Las spot instances han avanzado mucho desde que fueron introducidas por primera vez. Normalmente el precio las instancias EC2, al margen del tipo de instancia que se elija con más o menos recursos; varia en función del &lt;em&gt;modelo de compra&lt;/em&gt; de la instancia. Puede ser &lt;em&gt;On Demand&lt;/em&gt;, &lt;em&gt;Reserved&lt;/em&gt;, o &lt;em&gt;Spot Instances&lt;/em&gt;&lt;/p&gt;
&lt;p&gt;Las instancias &lt;em&gt;On Demand&lt;/em&gt; son las de uso más común. Simplemente cada tipo de instancia en la modalidad de &lt;em&gt;On Demand&lt;/em&gt; tienen un precio fijo. Si arrancas una instancia &lt;em&gt;On Demand&lt;/em&gt; sabes que el precio que AWS te cobra es el especificado en la documentación, y el coste total dependerá del tiempo que esté esa instancia en modo &lt;em&gt;Running&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Pero también existe la modalidad de &lt;em&gt;Spot Instances&lt;/em&gt;. Para no hacer muy pesada la explicación, básicamente consiste en fijar el precio que te gustaría pagar por un tipo de instancia, y en el momento en que el precio de mercado esté por debajo del precio que hayas establecido, podrás arrancar instancias de ese tipo a ese precio. Es como jugar a bolsa, cuando las acciones caigan por debajo de un umbral de dinero, compro acciones.&lt;/p&gt;
&lt;p&gt;La modalidad &lt;em&gt;Spot Instances&lt;/em&gt; es muy llamativa a la hora de aplicarla con un Autoscaling Group, pues podríamos conseguir ahorros bastante significativos, arrancando &lt;em&gt;Spot Instances&lt;/em&gt; cuando el precio caiga, y mientras tanto seguir usando &lt;em&gt;On Demand&lt;/em&gt;.&lt;/p&gt;
&lt;h3 id="amazonelasticfilesystem"&gt;Amazon Elastic Filesystem&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Amazon Elastic Filesystem&lt;/strong&gt; es uno de los servicios que llevo esperando mucho tiempo. De momento, no está disponible en Ireland pero espero que lo estrenen en Europa de aquí a unos meses.&lt;/p&gt;
&lt;p&gt;Uno de los principales problemas a resolver cuando trabajas en una&lt;br&gt;
infraestructura con escalabilidad horizontal, es la compartición de ficheros entre instancias. Hasta ahora mucha gente se ha configurado su propio cluster NFS, GlusterFS, e incluso he llegado a ver soluciones que usan un Bucket S3 junto con &lt;em&gt;s3fs&lt;/em&gt;, lo cual me parece muy arriesgado, porque se ha demostrado que no funciona muy bien. Precisamente esto es lo que viene a resolver &lt;strong&gt;EFS&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Al igual que con el resto de servicios, podremos abstraernos de la creación del cluster de ficheros y del storage de éste. En pocos minutos podemos contar con un punto de montaje con varios Terabytes y con una SLA muy alta. Este servicio realmente se basa en &lt;em&gt;NSFv4&lt;/em&gt;. Estoy deseando poder probar este servicio en algún proyecto, hacer pruebas de carga y ver si realmente funciona tan bien como se espera, o si tendré que seguir usando mi propio cluster de GlusterFS para compartir ficheros entre instancias.&lt;/p&gt;
&lt;p&gt;Y creo que esto es todo, la verdad es que mola mucho asistir a este tipo de&lt;br&gt;
eventos, porque no todo es resolver tickets, leer documentación, gestionar&lt;br&gt;
alertas y atender clientes. En este tipo de charlas siempre se abre un poco la mente, sobre todo escuchando las experiencias de los demás, en este caso con AWS.&lt;/p&gt;
&lt;p&gt;En breve escribiré posts relacionados con Amazon Web Services, y espero poder entrar mucho más en detalle.&lt;/p&gt;
&lt;p&gt;Un saludo!&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Y pasaron dos años ...</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Y pasaron dos años. Que se dice pronto. Realmente aún no me creo que hayan&lt;br&gt;
pasado dos años sin escribir nada en el blog. Supongo que es algo que vas&lt;br&gt;
dejando por aquello de que trabajas mucho tiempo al día, y luego te faltan las ganas de sentarte enfrente del&lt;/p&gt;</description><link>http://manuelviera.com/blog/y-pasaron-dos-anos/</link><guid isPermaLink="false">5ee648ca46e19912dcb41670</guid><category>offtopic</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 02 Nov 2015 00:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Y pasaron dos años. Que se dice pronto. Realmente aún no me creo que hayan&lt;br&gt;
pasado dos años sin escribir nada en el blog. Supongo que es algo que vas&lt;br&gt;
dejando por aquello de que trabajas mucho tiempo al día, y luego te faltan las ganas de sentarte enfrente del portatil, otra vez, a seguir hablando de lo mismo.&lt;/p&gt;
&lt;p&gt;No obstante, aunque no haya escrito en todo este tiempo, tengo que decir que no he estado &amp;quot;ausente&amp;quot;, al menos no del todo, sino que he estado en &amp;quot;la sombra&amp;quot;, apuntando ideas, probando y migrando a otros frameworks para bloguear, trabajando, y sobre todo aprendiendo. Siempre que entro aquí, me siento orgulloso, porque aunque no le he dedicado mucho tiempo últimamente, las visitas diarias no decaen. Y lo más importante, sigo recibiendo comentarios y preguntas en algunos posts. Con lo cual, esto me empuja a seguir con este proyecto. ¡Gracias!&lt;/p&gt;
&lt;p&gt;Durante estos dos años he estado trabajando en Crononauta. La empresa donde&lt;br&gt;
trabajo actualmente, y en la que pretendo seguir durante más tiempo. Así quiero que sea de momento. Si recapacito un poco en todo este tiempo, creo que he crecido mucho, tanto como persona, como profesionalmente hablando.&lt;/p&gt;
&lt;p&gt;Estoy satisfecho en este aspecto, porque creo que ahora soy capaz de proponer y de aplicar mejores soluciones y, sobre todo, más profesionales. Por este motivo, igual incorporo algunos posts que hablen sobre la toma de decisiones a la hora de aplicar soluciones a problemas.&lt;/p&gt;
&lt;p&gt;Además he aprendido mucho, y sigo aprendiendo, sobre monitorización. O ¿cómo saber qué pasa dentro de cada servidor y cómo adelantarnos a posibles problemas? Seguramente también incorpore posts sobre este campo. Me parece muy interesante poder adelantarte a problemas, o cómo definir una estrategia de monitorización que te permita detectar o monitorizar problemas a tan bajo nivel como necesites.&lt;/p&gt;
&lt;p&gt;También, de un año hacia acá, he aprendido muchisimo sobre Cloud, y en concreto estamos especializándonos en AWS (Amazon Web Services). Espero no volver a abandonar este blog durante un tiempo de nuevo, porque me gustaría compartir mis conocimientos de AWS. ¡Hay muchas cosas interesantes!&lt;/p&gt;
&lt;p&gt;No me enrrollo más. Este post es un poco para &amp;quot;romper el hielo&amp;quot; y convencerme a mí mismo, de que tengo que dedicar parte de mi tiempo a exportar conocimiento aquí. Espero escribir pronto de nuevo.&lt;/p&gt;
&lt;p&gt;¡Nos leemos!&lt;br&gt;
Manu.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Instalar Solr en Jetty</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Hace ya más de un mes que no pasaba por aquí más que para ver las estadísticas del blog; así que ya es hora de que me siente a escribir algo y compartir con el resto de internet.&lt;/p&gt;
&lt;p&gt;Hoy vengo hablando, o escribiendo, sobre cómo instalar / montar una instancia de&lt;/p&gt;</description><link>http://manuelviera.com/blog/instalar-solr-en-jetty/</link><guid isPermaLink="false">5ee647a546e19912dcb41657</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Mon, 29 Apr 2013 00:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Hace ya más de un mes que no pasaba por aquí más que para ver las estadísticas del blog; así que ya es hora de que me siente a escribir algo y compartir con el resto de internet.&lt;/p&gt;
&lt;p&gt;Hoy vengo hablando, o escribiendo, sobre cómo instalar / montar una instancia de Solr sobre Jetty, porque esta semana pasada me surgió la necesidad de montar una instancia y hemos tenido que pelear un poco para hacerlo, así que he decidido crear una receta muy simple para tenerlo funcionando rápidamente y siguiendo unos pasos muy sencillos. Pero empecemos por el principio...&lt;/p&gt;
&lt;!--more--&gt;
&lt;h2 id="quessolr"&gt;¿Qué es Solr?&lt;/h2&gt;
&lt;p&gt;&lt;a href="http://lucene.apache.org/solr/"&gt;Solr&lt;/a&gt; es la plataforma de búsqueda de código abierto del proyecto Apache Lucene. Es una plataforma de búsqueda muy popular y rápida; está escrita en Java y se ejecuta de forma independiente dentro de un servidor de aplicaciones como pueder ser &lt;a href="http://tomcat.apache.org/"&gt;Tomcat&lt;/a&gt; o &lt;a href="http://www.eclipse.org/jetty/"&gt;Jetty&lt;/a&gt;. Podéis encontrar mucha más información&lt;br&gt;
de Sorl en su &lt;a href="http://lucene.apache.org/solr/"&gt;página oficial&lt;/a&gt;.&lt;/p&gt;
&lt;h2 id="preparativos"&gt;Preparativos&lt;/h2&gt;
&lt;p&gt;Antes de empezar con la instalación de Solr necesitamos tener instalados varios paquetes en nuestro sistema. En mi caso, y a la hora de escribir este post, estoy utilizando una distribución Ubuntu; y muchos pensaréis que es tan fácil como hacer un &lt;code&gt;apt-get install solr-jetty solr-common&lt;/code&gt; pero mi necesidad surgió en una distribución Debian Squeeze, y no contaba con Solr en mi sistema de paquetería. De todas formas, este post tiene como fin poder instalar un Solr sin necesidad de utilizar el sistema de paquetería de nuestra distribución y poder utilizar una versión más nueva de Solr que la empaquetada en esta. Así que necesitaremos:&lt;/p&gt;
&lt;h3 id="java"&gt;Java&lt;/h3&gt;
&lt;p&gt;Necesitaremos la máquina virtual de Java para poder ejecutar Solr dentro de&lt;br&gt;
nuestro contenedor de aplicaciones Jetty. Podemos buscar el paquete referente a &lt;strong&gt;openjdk&lt;/strong&gt; en nuestra distribución. En mi caso, tengo instalado varios paquetes referentes a &lt;strong&gt;openjdk-7&lt;/strong&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dpkg -l |grep openjdk |awk '{print $2}'
openjdk-7-jre:amd64
openjdk-7-jre-headless:amd64
openjdk-7-jre-lib
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Para comprobar que tenemos &lt;strong&gt;java&lt;/strong&gt; correctamente instalado y&lt;br&gt;
conocer la versión que vamos a utilizar podemos ejecutar la siguiente&lt;br&gt;
instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ java -version
java version &amp;quot;1.7.0_21&amp;quot;
Java(TM) SE Runtime Environment (build 1.7.0_21-b11)
Java HotSpot(TM) 64-Bit Server VM (build 23.21-b01, mixed mode)
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="jetty"&gt;Jetty&lt;/h3&gt;
&lt;p&gt;Instalaremos el servidor de aplicaciones Jetty utilizando nuestro sistema de paquetería igual que hemos hecho con Java. Así que en distribuciones basadas en Debian utilizaremos la siguiente instrucción para su instalación:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo apt-get install jetty libjetty-extra
&lt;/code&gt;&lt;/pre&gt;
&lt;h3 id="solr"&gt;Solr&lt;/h3&gt;
&lt;p&gt;Como he comentado antes, en este caso no vamos a instalar Solr desde el sistema de paquetería, pues yo no tuve esa posibilidad y mi intención es compartir la forma de hacerlo de que exista un paquete en los repositorios, como era mi caso.&lt;/p&gt;
&lt;h4 id="descargarydescomprimirsolr"&gt;Descargar y descomprimir Solr&lt;/h4&gt;
&lt;p&gt;Descargaremos y descomprimiremos la última versión disponible de Solr en este momento, la versión 4.2.1:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ cd /opt
$ sudo wget http://apache.rediris.es/lucene/solr/4.2.1/solr-4.2.1.tgz
$ tar xzf solr-4.2.1.tgz &amp;amp;amp;&amp;amp;amp; mv solr-4.2.1 solr
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Crearemos el directorio &lt;code&gt;/usr/share/solr&lt;/code&gt; y descomprimiremos dentro de él el contenido de &lt;code&gt;dist/solr-4.2.1.war&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo mkdir /usr/share/solr
$ cd /usr/share/solr
$ sudo unzip /opt/solr/dist/solr-4.2.1.war
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esta última instrucción descomprime los ficheros web de Solr en el directorio &lt;code&gt;/usr/share/solr&lt;/code&gt; teniendo este el siguiente contenido:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ ls
admin.html  css  favicon.ico  img  js  META-INF  mgc  solr.xml  tpl  WEB-INF
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id="aadiendosolrajetty"&gt;Añadiendo Solr a Jetty&lt;/h4&gt;
&lt;p&gt;Para instalar Solr como aplicación dentro de Jetty, crearemos un enlace&lt;br&gt;
simbólico de &lt;code&gt;/usr/share/solr&lt;/code&gt; en &lt;code&gt;/usr/share/jetty/webapps&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo ln -s /usr/share/solr /usr/share/jetty/webbaps/solr
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;NOTA:&lt;/strong&gt; &lt;code&gt;/usr/share/jetty&lt;/code&gt; es el directorio donde se encuentra instalado&lt;br&gt;
Jetty en nuestra distribución. Puedes consultarlo ejecutando: &lt;code&gt;dpkg -L jetty&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;Esto quiere decir que nuestra instancia de Solr va a ser accesible en&lt;br&gt;
&lt;a href="http://localhost:8080/solr"&gt;http://localhost:8080/solr&lt;/a&gt;&lt;/p&gt;
&lt;h4 id="configurandojetty"&gt;Configurando Jetty&lt;/h4&gt;
&lt;p&gt;Editaremos el fichero &lt;code&gt;/etc/default/jetty&lt;/code&gt; a través del cual podremos modificar el comportamiento de éste sin necesidad de modificar sus ficheros de configuración XML.&lt;/p&gt;
&lt;p&gt;En mi caso he incluido las siguientes lineas:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;NO_START=0
VERBOSE=yes
JETTY_PORT=8080
JETTY_HOST=0.0.0.0
JAVA_OPTIONS=&amp;quot;-Dsolr.solr.home=/usr/share/solr $JAVA_OPTIONS&amp;quot;
JAVA_HOME=/usr/lib/jvm/java-7-openjdk-amd64
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;NO_START=0&lt;/strong&gt;: permite que Jetty se ejecute. Si el valor es 1, Jetty no podrá ejecutarse.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;VERBOSE=yes&lt;/strong&gt;: indica a Jetty que queremos que nos muestra mucha más información durante su ejecución. Muy recomendable sobre todo cuando se intenta depurar un error.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JETTY_PORT=8080&lt;/strong&gt;: puerto en el que escuchará Jetty. En este caso se utiliza el puerto por defecto, pero se puede establecer cualquier otro siempre y cuand o no se encuentra ya en uso en el sistema.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JETTY_HOST=0.0.0.0&lt;/strong&gt;: indica a Jetty que escuche en todas las interfaces de red y no solo en localhost. Aunque es recomendable que escuche solo en localhost, sobre todo si se encuentra instalada en el mismo servidor donde se encuentra la aplicación.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JAVA_OPTIONS&lt;/strong&gt;: opciones y parámetros que se pueden pasar a la máquina virtual de Java.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;JAVA_HOME&lt;/strong&gt;: indica el directorio HOME de la máquina virtual de Java. Es posible descubrirlo ejecutando &lt;code&gt;dpkg -L openjdk-7-jre&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id="aadiendocoresasolr"&gt;Añadiendo Cores a Solr&lt;/h4&gt;
&lt;p&gt;Es necesario configurar al menos un &lt;strong&gt;Core&lt;/strong&gt; en Solr para que podamos hacer uso de él, así que editaremos el fichero &lt;code&gt;/usr/share/solr/solr.xml&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo vim /usr/share/solr/solr.xml
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;y añadiremos algo como lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;lt;solr persistent=&amp;quot;true&amp;quot;&amp;gt;
    &amp;lt;cores adminPath=&amp;quot;/admin/cores&amp;quot;&amp;gt;
    &amp;lt;core name=&amp;quot;mysitename&amp;quot; instanceDir=&amp;quot;mysitename&amp;quot; dataDir=&amp;quot;/var/lib/solr/mysitename/data&amp;quot; /&amp;gt;
    &amp;lt;/cores&amp;gt;
&amp;lt;/solr&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esto añade un &lt;strong&gt;Core&lt;/strong&gt; llamado &lt;strong&gt;mysitename&lt;/strong&gt;. Ahora crearemos el directorio del &lt;strong&gt;Core&lt;/strong&gt; que acabamos de configurar:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo mkdir -p /var/lib/solr/mysitename/data
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Y establecemos &lt;strong&gt;jetty&lt;/strong&gt; como propietario y grupo a los directorios&lt;br&gt;
&lt;code&gt;/var/lib/solr&lt;/code&gt; &lt;code&gt;/usr/share/solr&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo chown -R jetty:jetty /var/lib/solr/
$ sudo chown -R jetty:jetty /usr/share/solr
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id="configurandoelcore"&gt;Configurando el Core&lt;/h4&gt;
&lt;p&gt;Tal y como hemos hecho antes, tenemos que crear el directorio que alojará la configuración para el Core &lt;strong&gt;mysitename&lt;/strong&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo mkdir -p /usr/share/solr/mysitename
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Y si aún no tenemos una configuración disponible, podemos copiar la&lt;br&gt;
configuración de ejemplo que viene incluida con Solr y que se encuentra en el directorio &lt;code&gt;example&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo cp -r /opt/solr/example/solr/collection1/conf/ /usr/share/solr/mysitename/
&lt;/code&gt;&lt;/pre&gt;
&lt;h4 id="reiniciarjetty"&gt;Reiniciar Jetty&lt;/h4&gt;
&lt;p&gt;Por último y para terminar solo nos quedaría reiniciar el servido Jetty:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ sudo service jetty restart
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si todo va bien, Solr debería estar accesible en &lt;a href="http://localhost:8080/solr"&gt;http://localhost:8080/solr&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;Y esto es todo! Espero que os sirva de ayuda, a mi seguro que me va a ser muy útil cuando tenga que montar un Solr de nuevo.&lt;/p&gt;
&lt;p&gt;Un saludo,&lt;br&gt;
Manu.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Empezando con MongoDB Part.II</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;En mi &lt;a href="http://manuelviera.com/blog/empezando-con-mongodb/"&gt;anterior post&lt;/a&gt; hablaba sobre &lt;a href="http://manuelviera.com/blog/empezando-con-mongodb/"&gt;cómo empezar con MongoDB&lt;/a&gt;, una base de datos NoSQL orientada a documentos; y como sigo estudiándola y me parece interesante, me gustaría seguir compartiendo y profundizando sobre el uso de MongoDB, así que he decidido escribir una segunda parte de este anterior post.&lt;/p&gt;
&lt;p&gt;El&lt;/p&gt;</description><link>http://manuelviera.com/blog/empezando-con-mongodb-part-ii/</link><guid isPermaLink="false">5ee645fa46e19912dcb4161f</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Sat, 02 Mar 2013 00:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;En mi &lt;a href="http://manuelviera.com/blog/empezando-con-mongodb/"&gt;anterior post&lt;/a&gt; hablaba sobre &lt;a href="http://manuelviera.com/blog/empezando-con-mongodb/"&gt;cómo empezar con MongoDB&lt;/a&gt;, una base de datos NoSQL orientada a documentos; y como sigo estudiándola y me parece interesante, me gustaría seguir compartiendo y profundizando sobre el uso de MongoDB, así que he decidido escribir una segunda parte de este anterior post.&lt;/p&gt;
&lt;p&gt;El objetivo de este post es bien sencillo. Cubrirá las operaciones principales básicas de MongoDB, también conocidas como operaciones &lt;strong&gt;CRUD&lt;/strong&gt;, que significa &lt;strong&gt;C&lt;/strong&gt; reate, &lt;strong&gt;R&lt;/strong&gt; ead, &lt;strong&gt;U&lt;/strong&gt; pdate y &lt;strong&gt;D&lt;/strong&gt; elete. ¡Así que empecemos con ello!&lt;/p&gt;
&lt;!--more--&gt;
&lt;p&gt;Antes de nada empezaremos recordando cómo iniciar nuestra base de datos&lt;br&gt;
utilizando el comando &lt;code&gt;mongod&lt;/code&gt;. Recordad que debemos especificar la ruta donde se almacenará la base de datos utilizando el parámetro &lt;code&gt;--dbpath&lt;/code&gt;. Dicho esto, podremos ejecutar una instrucción como la siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ mongod --dbpath test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En este caso he utilizado un directorio llamado &lt;em&gt;test&lt;/em&gt; donde alojaré esta base de datos de pruebas. Apuntar que al no especificar un puerto con el parámetro &lt;code&gt;--port&lt;/code&gt;, la instancia de &lt;code&gt;mongod&lt;/code&gt; utilizará el puerto &lt;code&gt;27017&lt;/code&gt; por defecto.&lt;/p&gt;
&lt;p&gt;Esta instrucción tiene un &amp;quot;inconveniente&amp;quot; y es que no podremos seguir&lt;br&gt;
utilizando nuestra consola actual, pues la ejecución de &lt;code&gt;mongod&lt;/code&gt; se realiza en primer plano, o &lt;em&gt;foreground&lt;/em&gt;. Para evitar esto podemos hacer uso del parámetro &lt;code&gt;--fork&lt;/code&gt; que creará un &lt;em&gt;fork&lt;/em&gt; del proceso del servidor permitiendo poder seguir utilizando nuestra consola. La opción &lt;code&gt;--fork&lt;/code&gt; requiere que se especifique además un fichero de log utilizando el parámetro &lt;code&gt;--logpath&lt;/code&gt; o &lt;code&gt;--syslog&lt;/code&gt;, así que la instrucción quedaría de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ mongod --dbpath test --logappend --logpath test.log --fork
forked process: 10017
all output going to: /home/mviera/Downloads/mongodb/test.log
child process started successfully, parent exiting
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Además he utilizado la opción &lt;code&gt;--logappend&lt;/code&gt; para evitar que&lt;br&gt;
sobrescriba el contenido del fichero de log. En este caso seguirá concatenando datos al contenido actual del fichero.&lt;/p&gt;
&lt;p&gt;Una vez funcionando nuestra instancia de &lt;code&gt;mongod&lt;/code&gt;, podemos conectarnos a la&lt;br&gt;
consola utilizando el comando &lt;code&gt;mongo&lt;/code&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ mongo
MongoDB shell version: 2.2.3
connecting to: test
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; No es necesario especificar el puerto porque se está utilizando  el puerto por defecto (&lt;code&gt;27017&lt;/code&gt;).&lt;/p&gt;
&lt;p&gt;Todo listo, así que ¡empecemos a crear documentos!&lt;/p&gt;
&lt;h2 id="introduciendocontenido"&gt;Introduciendo contenido&lt;/h2&gt;
&lt;p&gt;Seguro que muchos ya os imagináis cómo se realiza este tipo de operación básica en una base de datos SQL como MySQL, PosgreSQL, SQLite, etc; pero en MongoDB se realiza de una forma muy diferente, por lo menos referente a cómo se realiza en una base de datos SQL.&lt;/p&gt;
&lt;p&gt;Una inserción de datos sencilla en SQL podría ser de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;INSERT INTO users (firstName, lastName, username, age, city)
VALUES ('Manuel', 'Viera', 'mviera', 26, 'Sevilla');
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En MongoDB es completamente diferente. En mi anterior post ya traté rápidamente las inserciones y si recordáis, comentaba que MongoDB está orientado a documentos y que estos documentos siguen el estilo JSON (JavaScript Object Notation).&lt;/p&gt;
&lt;p&gt;Para realizar una inserción en MongoDB utilizaremos el método &lt;code&gt;insert()&lt;/code&gt; al que llamaremos pasándole como parámetro el documento a introducir, el cual,&lt;br&gt;
siguiendo el ejemplo anterior, sería representado en formato JSON de la&lt;br&gt;
siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{
  &amp;quot;firstName&amp;quot; : &amp;quot;Manuel&amp;quot;,
  &amp;quot;lastName&amp;quot; : &amp;quot;Viera&amp;quot;,
  &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;,
  &amp;quot;age&amp;quot; : 26,
  &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Recordad también que en MongoDB los documentos se almacenan en colecciones (o &lt;em&gt;collections&lt;/em&gt; en inglés), así que para seguir con el ejemplo introduciremos este documento en una colección llamada &lt;code&gt;users&lt;/code&gt;.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.insert({
 firstName: &amp;quot;Manuel&amp;quot;,
 lastName: &amp;quot;Viera&amp;quot;,
 username: &amp;quot;mviera&amp;quot;,
 age: 26,
 city: &amp;quot;Sevilla&amp;quot;
 })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Bien. ¿Qué tenemos hasta ahora? Por defecto cuando nos conectamos a una&lt;br&gt;
instancia MongoDB sin especificar una base de datos, se utilizará por defecto &lt;code&gt;test&lt;/code&gt;. Así que hemos creado un documento dentro de la colección &lt;code&gt;users&lt;/code&gt; en la base de datos &lt;code&gt;test&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; A modo de recordatorio, no es necesario crear previamente la&lt;br&gt;
colección antes de introducir documentos. MongoDB lo hará por nosotros&lt;br&gt;
automáticamente si la colección no existe.&lt;/p&gt;
&lt;p&gt;¿Pero cómo recuperamos los datos introducidos?&lt;/p&gt;
&lt;h2 id="recuperandolosdocumentos"&gt;Recuperando los documentos&lt;/h2&gt;
&lt;p&gt;Para seleccionar, buscar, encontrar documentos dentro de nuestra colección&lt;br&gt;
utilizaremos uno de los siguientes métodos:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;find()&lt;/code&gt; : que devolverá un cursor con todos los documentos recuperados de la base de datos.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;findOne()&lt;/code&gt; : que devuelve solamente un documento.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;El uso de &lt;code&gt;find()&lt;/code&gt; es muy sencillo, como podéis ver a continuación:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find()
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131f87b350e650534c68d8e&amp;quot;), &amp;quot;firstName&amp;quot; : &amp;quot;Manuel&amp;quot;, &amp;quot;lastName&amp;quot; : &amp;quot;Viera&amp;quot;, &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26, &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot; }
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En este caso tanto &lt;code&gt;find()&lt;/code&gt; como &lt;code&gt;findOne()&lt;/code&gt; devolverán resultados idénticos, pues ahora mismo sólo contamos con un documento en nuestra colección &lt;code&gt;users&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.findOne()
{
        &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131f87b350e650534c68d8e&amp;quot;),
        &amp;quot;firstName&amp;quot; : &amp;quot;Manuel&amp;quot;,
        &amp;quot;lastName&amp;quot; : &amp;quot;Viera&amp;quot;,
        &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;,
        &amp;quot;age&amp;quot; : 26,
        &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot;
}
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si os fijáis en un detalle, &lt;code&gt;findOne()&lt;/code&gt; devuelve el contenido de una forma&lt;br&gt;
mucho más legible al ojo humano que &lt;code&gt;find()&lt;/code&gt;. Esto también podemos conseguirlo con &lt;code&gt;find()&lt;/code&gt; si utilizamos además el método &lt;code&gt;pretty()&lt;/code&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find().pretty()
{
        &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131f87b350e650534c68d8e&amp;quot;),
        &amp;quot;firstName&amp;quot; : &amp;quot;Manuel&amp;quot;,
        &amp;quot;lastName&amp;quot; : &amp;quot;Viera&amp;quot;,
        &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;,
        &amp;quot;age&amp;quot; : 26,
        &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot;
}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Al igual que &lt;code&gt;pretty()&lt;/code&gt; también podemos utilizar otros métodos como &lt;code&gt;count()&lt;/code&gt; que nos devuelve la cantidad total de documentos devueltos:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find().count()
1
&amp;gt;

O directamente sobre la colección `users` para saber el total de documentos de dicha colección:

&amp;gt; db.users.count()
5
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si introducimos más documentos de prueba, se aprecia que el contador total de documentos cambia:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.insert({firstName:&amp;quot;Paco&amp;quot;, lastName:&amp;quot;Laverdaque&amp;quot;, username: &amp;quot;laverdaque&amp;quot;, age: 40, city: &amp;quot;Madrid&amp;quot;})
&amp;gt; db.users.insert({firstName:&amp;quot;Raul&amp;quot;, lastName:&amp;quot;Martin&amp;quot;, username: &amp;quot;rmartin&amp;quot;, age: 39, city: &amp;quot;Malaga&amp;quot;})
&amp;gt; db.users.insert({firstName:&amp;quot;Jose&amp;quot;, lastName:&amp;quot;Castillo&amp;quot;, username: &amp;quot;lolo&amp;quot;, age: 25, city: &amp;quot;Cadiz&amp;quot;})
&amp;gt; db.users.insert({firstName:&amp;quot;Jose Luis&amp;quot;, lastName:&amp;quot;Romero&amp;quot;, username: &amp;quot;selu&amp;quot;, age: 27, city: &amp;quot;Barcelona&amp;quot;})
&amp;gt; 
&amp;gt; db.users.count()
5
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pero no siempre vamos a querer recuperar todos los documentos de nuestra colección...&lt;/p&gt;
&lt;h3 id="cmofiltrardocumentos"&gt;¿Cómo filtrar documentos?&lt;/h3&gt;
&lt;p&gt;Seguro que muchos ya estáis pensando en la cláusula &lt;code&gt;WHERE&lt;/code&gt; de las sentencias SQL. Por ejemplo, si quisiéramos recuperar aquellos usuarios cuya ciudad es Sevilla, con una sentencia SQL sería:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; SELECT * FROM users WHERE city=&amp;quot;Sevilla&amp;quot;;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sin embargo, en MongoDB es de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find({ city: &amp;quot;Sevilla&amp;quot; })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De esta forma, pasamos como parámetro un documento JSON con la cláusula a&lt;br&gt;
cumplir, en este caso que la clave &lt;strong&gt;city&lt;/strong&gt; tenga como valor &lt;em&gt;Sevilla&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;¿Y cómo podemos concatenar cláusulas? Es decir, cómo sería si quisiéramos&lt;br&gt;
recuperar aquellos usuarios cuya ciudad es Sevilla &lt;strong&gt;y&lt;/strong&gt; además su edad sea 26:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find({ city: &amp;quot;Sevilla&amp;quot;, age: 26 })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como se puede observar, solamente se necesita agregar una segunda clave o campo al documento JSON que se le pasa al método &lt;code&gt;find()&lt;/code&gt;.&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; MongoDB aplica por defecto un &lt;strong&gt;AND&lt;/strong&gt; entre cláusulas, es decir,&lt;br&gt;
imaginaos que la coma (&lt;strong&gt;,&lt;/strong&gt;) es un operador &lt;strong&gt;AND&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Para utilizar un operador &lt;strong&gt;OR&lt;/strong&gt; deberemos usar el operador &lt;code&gt;$or&lt;/code&gt; de MongoDB, de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find({ $or: [ {city:&amp;quot;Sevilla&amp;quot;}, {city:&amp;quot;Malaga&amp;quot;} ] })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En este caso hemos recuperado aquellos usuarios cuya ciudad es Sevilla &lt;strong&gt;o&lt;/strong&gt; Málaga.&lt;/p&gt;
&lt;p&gt;Podéis aprender más sobre operadores en &lt;a href="http://docs.mongodb.org/manual/reference/operators/"&gt;http://docs.mongodb.org/manual/reference/operators/&lt;/a&gt;.&lt;br&gt;
Algunos de ellos son:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;$gt&lt;/code&gt;: mayor que (o &lt;em&gt;greater than&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;`$lt: menor que (o &lt;em&gt;lower than&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$gte&lt;/code&gt;: mayor o igual que (o &lt;em&gt;greather or equal than&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$lte&lt;/code&gt;: menor o igual que (o &lt;em&gt;lower or equal than&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$not&lt;/code&gt;: no (negación o &lt;em&gt;not&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$in&lt;/code&gt;: en, para buscar dentro de un array.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$nin&lt;/code&gt;: no en, para buscar algo que no se encuentre en un determinado array (o &lt;em&gt;not in&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;&lt;code&gt;$ne&lt;/code&gt;: no es igual a (o &lt;em&gt;not equal to&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Pero, no siempre vamos a querer recuperar todos los campos de un documento,&lt;br&gt;
quizás solo necesitemos un algunos de ellos...&lt;/p&gt;
&lt;h2 id="cmoseleccionarciertoscampos"&gt;¿Cómo seleccionar ciertos campos?&lt;/h2&gt;
&lt;p&gt;Al igual que en una sentencia &lt;code&gt;SELECT&lt;/code&gt;, en una base de datos SQL, podemos&lt;br&gt;
especificar qué determinados campos queremos obtener tras seleccionar los&lt;br&gt;
documentos, en MongoDB también podemos hacerlo.&lt;/p&gt;
&lt;p&gt;Hasta ahora hemos estado utilizando &lt;code&gt;find()&lt;/code&gt; como una sentencia SQL &lt;code&gt;SELECT *&lt;/code&gt;, es decir:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;es equivalente a&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; SELECT * FROM users;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pero ¿y si lo que queremos es solamente recuperar los campos &lt;em&gt;username&lt;/em&gt; y&lt;br&gt;
&lt;em&gt;age&lt;/em&gt;? En una sentencia SQL sería de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; SELECT username, age, city FROM users;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En cambio, en MongoDB sería de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find({}, {username:1, age:1})
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131f87b350e650534c68d8e&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26 }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131fdc8350e650534c68d8f&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;laverdaque&amp;quot;, &amp;quot;age&amp;quot; : 40 }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131fe00350e650534c68d90&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;rmartin&amp;quot;, &amp;quot;age&amp;quot; : 39 }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131fe20350e650534c68d91&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;lolo&amp;quot;, &amp;quot;age&amp;quot; : 25 }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131fe80350e650534c68d92&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;selu&amp;quot;, &amp;quot;age&amp;quot; : 27 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sin embargo, como podéis observar, aunque no hemos especificado el campo &lt;code&gt;_id&lt;/code&gt; sigue apareciendo en la salida. Como ya comenté en el anterior post, MongoDB siempre muestra el campo &lt;code&gt;_id&lt;/code&gt; a menos que especifiquemos explicitamente que no queramos que lo haga. Y sería de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find( {}, { username:1, age:1, _id:0 })
{ &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26 }
{ &amp;quot;username&amp;quot; : &amp;quot;laverdaque&amp;quot;, &amp;quot;age&amp;quot; : 40 }
{ &amp;quot;username&amp;quot; : &amp;quot;rmartin&amp;quot;, &amp;quot;age&amp;quot; : 39 }
{ &amp;quot;username&amp;quot; : &amp;quot;lolo&amp;quot;, &amp;quot;age&amp;quot; : 25 }
{ &amp;quot;username&amp;quot; : &amp;quot;selu&amp;quot;, &amp;quot;age&amp;quot; : 27 }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;En resumen, si analizamos la sintaxis del método &lt;code&gt;find()&lt;/code&gt;, primero se&lt;br&gt;
especifica un documento JSON con las cláusulas del filtro que queremos aplicar y a continuación, si lo preferimos, podemos activar o desactivar cierto campos de la salida:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;1&lt;/strong&gt; : indica que queremos que muestre el campo especificado.&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;0&lt;/strong&gt; : indica que no queremos que dicho campo se muestre en la salida.&lt;/li&gt;
&lt;/ul&gt;
&lt;h1 id="actualizandodatosdelosdocumentos"&gt;Actualizando datos de los documentos&lt;/h1&gt;
&lt;p&gt;Una vez que somos capaces de introducir documentos en nuestra colección,&lt;br&gt;
recuperarlos todos o aquellos que nos interesan utilizando una &lt;em&gt;query&lt;/em&gt; es hora de conocer cómo podemos actualizar los datos de nuestros documentos.&lt;/p&gt;
&lt;p&gt;Para ello utilizaremos el método &lt;code&gt;update()&lt;/code&gt; cuya sintaxis es la siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.collection.update( &amp;lt;query&amp;gt;, &amp;lt;update&amp;gt;, options )
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;ul&gt;
&lt;li&gt;El parámetro &lt;code&gt;&amp;lt;query&amp;gt;&lt;/code&gt; hace referencia a una query como las que usabamos con el comando &lt;code&gt;find()&lt;/code&gt;, la cual nos permitirá seleccionar aquellos documentos los cuales queremos modificar. De otra forma, si no se especifica una query se estarían seleccionando todos los documentos de una colección.&lt;/li&gt;
&lt;li&gt;El parámetro &lt;code&gt;&amp;lt;update&amp;gt;&lt;/code&gt; en el que podemos especificar un documento completo, que actualizará cada uno de los campos del documento seleccionado; o también podemos especificar solamente el campo del documento que queremos especificar, lo cual es más eficiente comparado con actualizar todos los campos del documento.&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Y con respecto a las opciones podemos citar:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;upsert&lt;/code&gt;: si se establece este parámetro a &lt;strong&gt;true&lt;/strong&gt; y no hay documento que coincida con la &lt;code&gt;&amp;lt;query&amp;gt;&lt;/code&gt; especificada, el método &lt;code&gt;update()&lt;/code&gt; insertará un nuevo documento en la colección con los valores especificados en el parámetro &lt;code&gt;&amp;lt;update&amp;gt;&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;multi&lt;/code&gt; : por defecto MongoDB solo actualiza un documento al mismo tiempo, si necesitamos actualizar más de un documento al mismo tiempo debemos establecer este parámetro a &lt;strong&gt;true&lt;/strong&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="actualizarundocumentocompleto"&gt;Actualizar un documento completo&lt;/h2&gt;
&lt;p&gt;Esta no es la forma más eficiente de actualizar el contenido de un documento, como comenté anteriormente, pues es necesario que se especifique el contenido completo del documento, y en caso de ser un documento muy grande puede llegar a ser bastante ineficiente, ya que tendra que actualizarse el valor de cada campo aunque no hay cambiado.&lt;/p&gt;
&lt;p&gt;Imaginemos que queremos modificar un documento para cambiar solamente el valor del campo &lt;strong&gt;age&lt;/strong&gt; (edad). Tendríamos que realizar lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.update({ username: &amp;quot;rmartin&amp;quot; }, { &amp;quot;firstName&amp;quot; : &amp;quot;Raul&amp;quot;, &amp;quot;lastName&amp;quot; : &amp;quot;Martin&amp;quot;, &amp;quot;username&amp;quot; : &amp;quot;rmartin&amp;quot;, &amp;quot;age&amp;quot; : 40, &amp;quot;city&amp;quot; : &amp;quot;Malaga&amp;quot; } })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Con esta instrucción hemos cambiado el valor del campo &lt;strong&gt;age&lt;/strong&gt; de 39 a 40, incluyendo los demás campos que serán actualizados con los mismos datos.&lt;/p&gt;
&lt;p&gt;También es posible hacerlo de la siguiente forma para nuestra comodidad:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; user = db.users.findOne({ username:&amp;quot;rmartin&amp;quot; })
{
        &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131fe00350e650534c68d90&amp;quot;),
        &amp;quot;firstName&amp;quot; : &amp;quot;Raul&amp;quot;,
        &amp;quot;lastName&amp;quot; : &amp;quot;Martin&amp;quot;,
        &amp;quot;username&amp;quot; : &amp;quot;rmartin&amp;quot;,
        &amp;quot;age&amp;quot; : 39,
        &amp;quot;city&amp;quot; : &amp;quot;Malaga&amp;quot;
}
&amp;gt; user.age 
39
&amp;gt; 
&amp;gt; user.age = 40
40
&amp;gt; 
&amp;gt; db.users.update({ username:&amp;quot;rmartin&amp;quot; }, user )
&lt;/code&gt;&lt;/pre&gt;
&lt;ol&gt;
&lt;li&gt;Recupero el documento completo referente al usuario cuyo &lt;em&gt;username&lt;/em&gt; es &lt;em&gt;rmartin&lt;/em&gt; y lo almaceno en la variable &lt;code&gt;user&lt;/code&gt;.&lt;/li&gt;
&lt;li&gt;Compruebo el valor actual del campo &lt;em&gt;age&lt;/em&gt; accediendo al objeto &lt;code&gt;user&lt;/code&gt; haciendo uso del &lt;em&gt;dot notation&lt;/em&gt; (notación por punto: user.campo)&lt;/li&gt;
&lt;li&gt;Modifico el valor del campo &lt;em&gt;age&lt;/em&gt; estableciéndolo a 40.&lt;/li&gt;
&lt;li&gt;Utilizo el método &lt;code&gt;update()&lt;/code&gt; seleccionando de nuevo el mismo objeto que al principio (usando la misma query) e indico el nuevo documento a continuación, en este caso, almacenado en la variable &lt;code&gt;user&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="actualizandouncampoconcretodeundocumento"&gt;Actualizando un campo concreto de un documento&lt;/h2&gt;
&lt;p&gt;Sin embargo, existe una alternativa mucho más eficiente para actualizar el&lt;br&gt;
valor de ciertos campos en un documento. Para ello será necesario volver a&lt;br&gt;
hacer uso de los operadores como los anteriormente citados. Algunos de estos son:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$set&lt;/code&gt;: que permite establecer un nuevo valor a un campo del documento. Si el campo no existe actualmente en el documento, será creado automáticamente. Por ejemplo:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  &amp;gt; db.users.update({ age: 26, city: &amp;quot;Sevilla&amp;quot; }, { $set: { weight: 68.9 } })
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;En este caso se ha seleccionado un usuario cuya edad sea 26 y su ciudad&lt;br&gt;
Sevilla, y se ha añadido el campo &lt;strong&gt;weight&lt;/strong&gt;.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$addToSet&lt;/code&gt;: para añadir elementos un array. Por ejemplo, si quisieramos añadir un nuevo campo llamado &lt;em&gt;likes&lt;/em&gt; con los gustos de un usuario:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.update({ username:&amp;quot;mviera&amp;quot; }, {$addToSet: { likes: &amp;quot;photography&amp;quot; }})
&amp;gt; db.users.update({ username:&amp;quot;mviera&amp;quot; }, {$addToSet: { likes: &amp;quot;music&amp;quot; }})
&amp;gt;
&amp;gt; db.users.findOne({ username: &amp;quot;mviera&amp;quot; })
{
    &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;5131f87b350e650534c68d8e&amp;quot;),
    &amp;quot;age&amp;quot; : 26,
    &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot;,
    &amp;quot;firstName&amp;quot; : &amp;quot;Manuel&amp;quot;,
    &amp;quot;lastName&amp;quot; : &amp;quot;Viera&amp;quot;,
    &amp;quot;likes&amp;quot; : [
            &amp;quot;photography&amp;quot;,
            &amp;quot;music&amp;quot;
    ],
    &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;,
    &amp;quot;weight&amp;quot; : 68.9
}
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code&gt;$inc&lt;/code&gt;: permite incrementar el valor numérico de uno de los campos del documento. Por ejemplo, si quisieramos incrementar en 5 la edad del usuario &lt;em&gt;mviera&lt;/em&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;  &amp;gt; db.users.update({ username:&amp;quot;mviera&amp;quot; }, {$inc: {age: 5}})
  &amp;gt; db.users.find({ username: &amp;quot;mviera&amp;quot; }, {username: 1, age: 1, _id:0})
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;{ &amp;quot;age&amp;quot; : 31, &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot; }&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Para más información acerca de los operadores utilzados en el método &lt;code&gt;update()&lt;/code&gt; podéis consultar&lt;br&gt;
&lt;a href="http://docs.mongodb.org/manual/applications/update/#update-operators"&gt;http://docs.mongodb.org/manual/applications/update/#update-operators&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="eliminandodocumentos"&gt;Eliminando documentos&lt;/h2&gt;
&lt;p&gt;Para eliminar documentos de nuestra colección utilizaremos el método &lt;code&gt;remove()&lt;/code&gt; en la shell de MongoDB. Si ya sabes cómo utilizar el método &lt;code&gt;find()&lt;/code&gt; no supondrá ningún problema porque solamente requiere que se le especifique el filtro o búsqueda de los documentos que se quieren eliminar. Su sintaxis es la siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;db.collection.remove( &amp;lt;query&amp;gt;, &amp;lt;justOne&amp;gt; )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;De forma que si queremos eliminar de la colección todos los usuarios cuya edad sea mayor a 30 utilizaríamos la siguiente instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.remove({ age: { $gt: 30 } })
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El parámetro &lt;code&gt;justOne&lt;/code&gt; permite indicar al método &lt;code&gt;remove()&lt;/code&gt; si queremos&lt;br&gt;
eliminar solamente un documento de todos los coincidentes. En ese caso, se debe pasar el valor &lt;em&gt;true&lt;/em&gt; o &lt;em&gt;1&lt;/em&gt;, de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.remove({ age: { $gt: 30 } }, true )
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Es posible utilizar el método &lt;code&gt;remove()&lt;/code&gt; para eliminar todos los documentos de una colección si no se especifica una query o si ésta está vacía, es decir, &lt;code&gt;db.users.remove({})&lt;/code&gt;. Pero en este caso, si queremos eliminar todos los documentos de una colección, es recomendable utilizar el método &lt;code&gt;drop()&lt;/code&gt;, que &lt;strong&gt;elimina la colección completa&lt;/strong&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.drop()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¡Y eso es todo! Espero que os haya sido útil y por lo menos hayáis aprendido algo nuevo. Intentaré seguir escribiendo sobre MongoDB, ahora que ya conocemos lo básico.&lt;/p&gt;
&lt;p&gt;Un saludo,&lt;br&gt;
Manu.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Empezando con MongoDB</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Normalmente muchos de los que nos dedicamos a la informática, cuando escuchamos el término &lt;em&gt;base de datos&lt;/em&gt; o &lt;em&gt;database&lt;/em&gt; (en inglés) pensamos directamente en un tipo de base de datos, las bases de datos relacionales, como MySQL, PostgreSQL, etc; quizás porque son las más comunes y utilizadas durante mucho tiempo.&lt;/p&gt;</description><link>http://manuelviera.com/blog/empezando-con-mongodb/</link><guid isPermaLink="false">5ee61de146e19912dcb415eb</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Wed, 06 Feb 2013 00:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Normalmente muchos de los que nos dedicamos a la informática, cuando escuchamos el término &lt;em&gt;base de datos&lt;/em&gt; o &lt;em&gt;database&lt;/em&gt; (en inglés) pensamos directamente en un tipo de base de datos, las bases de datos relacionales, como MySQL, PostgreSQL, etc; quizás porque son las más comunes y utilizadas durante mucho tiempo. Pero esto está cambiando.&lt;/p&gt;
&lt;p&gt;Desde hace un tiempo hasta ahora han ido proliferando otro tipo de base de&lt;br&gt;
datos conocidas como &lt;em&gt;NoSQL&lt;/em&gt; y seguro que conocéis algunas como: &lt;strong&gt;Memcached&lt;/strong&gt;, una caché tipo clave-valor en RAM, su variante &lt;strong&gt;MemcacheDB&lt;/strong&gt; que almacena datos clave-valor en disco usando &lt;strong&gt;BerkeleyDB&lt;/strong&gt;; &lt;strong&gt;Redis&lt;/strong&gt;, otra base de datos de tipo clave-valor; o &lt;strong&gt;MongoDB&lt;/strong&gt; que a diferencia de las anteriores, está &lt;strong&gt;orientada a documentos&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id="quesmongodb"&gt;¿Qué es MongoDB?&lt;/h2&gt;
&lt;p&gt;Primero, ¿Qué significa &lt;em&gt;NoSQL&lt;/em&gt;? El término &lt;em&gt;NoSQL&lt;/em&gt; se utiliza para indicar que dicha base de datos no utiliza el sistema relacional tan ampliamente utilizado. Las bases de datos &lt;em&gt;NoSQL&lt;/em&gt; no se construyen sobre &lt;em&gt;tablas&lt;/em&gt; y normalmente tampoco utilizan el lenguaje &lt;em&gt;SQL&lt;/em&gt; para realizar consultas.&lt;/p&gt;
&lt;p&gt;Muchos sistemas &lt;em&gt;NoSQL&lt;/em&gt; utilizan una arquitectura distribuida y tolerante a&lt;br&gt;
fallos, lo que permite mantener los datos en varios servidores de forma&lt;br&gt;
redundante. De esta forma es bastante fácil escalar el sistema añadiendo más servidores. Normalmente este tipo de base de datos escala horizontalmente permitiendo administrar grandes cantidades de datos.&lt;/p&gt;
&lt;p&gt;El nombre de &lt;strong&gt;MongoDB&lt;/strong&gt; proviene de &amp;quot;hu&lt;strong&gt;mongo&lt;/strong&gt;us&amp;quot;, que significa enorme en inglés, y es una base de datos &lt;em&gt;NoSQL&lt;/em&gt; software libre, escalable y de alto rendimiento escrita en C++.&lt;/p&gt;
&lt;p&gt;Algunas de las características más importantes de MongoDB son:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;Almacenamiento orientado a documentos (&lt;em&gt;document-oriented&lt;/em&gt; en inglés).&lt;/li&gt;
&lt;li&gt;Replicación y Alta Disponibilidad.&lt;/li&gt;
&lt;li&gt;Soporte de índices.&lt;/li&gt;
&lt;li&gt;Consultas, también basadas en documentos.&lt;/li&gt;
&lt;li&gt;Auto-Sharding, permitiendo escalar horizontalmente.&lt;/li&gt;
&lt;li&gt;GridFS, que permite almacenar ficheros de cualquier tamaño sin necesidad de complicar el entorno.&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id="orientadoadocumentos"&gt;¿Orientado a documentos?&lt;/h2&gt;
&lt;p&gt;Si hubiera que destacar una de las características anteriormente citadas, en mi opinión, la más importante ahora mismo sería la de &lt;em&gt;orientado a documentos&lt;/em&gt; o &lt;em&gt;document-oriented&lt;/em&gt;, ya que se trata de un concepto fundamental para entender cómo funciona y cómo trabajar con MongoDB.&lt;/p&gt;
&lt;p&gt;El almacenamiento de los datos en MongoDB utiliza documentos &lt;strong&gt;JSON&lt;/strong&gt;&lt;br&gt;
(JavaScript Object Notation), contando con un esquema dinámico y totalmente&lt;br&gt;
flexible. De hecho se dice que MongoDB es &lt;em&gt;schemaless&lt;/em&gt; (sin esquema).&lt;/p&gt;
&lt;h4 id="peroquesundocumentojson"&gt;¿Pero qué es un documento JSON?&lt;/h4&gt;
&lt;p&gt;De forma rápida y sencilla, un documento JSON no es más que descripción de un objecto en formato JSON, un formato muy rápido para el intercambio de datos y  muy legible para el humano (&lt;em&gt;human-readable&lt;/em&gt; en inglés).&lt;/p&gt;
&lt;p&gt;Un documento JSON podria tener la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;{&amp;quot;username&amp;quot;:&amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot;: 26, &amp;quot;city&amp;quot;: &amp;quot;Sevilla&amp;quot;}
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Este documento describe un usuario cuyo &amp;quot;&lt;em&gt;username&lt;/em&gt;&amp;quot; es &amp;quot;mviera&amp;quot;, con una edad de 26 años y cuya ciudad es &amp;quot;Sevilla&amp;quot;.&lt;/p&gt;
&lt;p&gt;En JSON hay 6 tipos de datos diferentes:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Number&lt;/li&gt;
&lt;li&gt;String&lt;/li&gt;
&lt;li&gt;Boolean (true o false)&lt;/li&gt;
&lt;li&gt;Array&lt;/li&gt;
&lt;li&gt;Object&lt;/li&gt;
&lt;li&gt;null&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Podéis aprender más sobre JSON en &lt;a href="http://json.org/json-es.html"&gt;http://json.org/json-es.html&lt;/a&gt;&lt;/p&gt;
&lt;h2 id="cmoseinstala"&gt;¿Cómo se instala?&lt;/h2&gt;
&lt;p&gt;La instalación de MongoDB es bastante sencilla. La versión actual de MongoDB es &lt;strong&gt;2.2.3&lt;/strong&gt;, en el momento en que escribo este artículo.&lt;/p&gt;
&lt;p&gt;Su instalación se puede llevar a cabo a través del sistema de paquetería de&lt;br&gt;
nuestra distribución, APT, Aptitude, Yum... En Debian el nombre del paquete que contiene el servidor de MongoDB se llaman &lt;strong&gt;mongodb-server&lt;/strong&gt; y el paquete que contiene el cliente y otras utilidades de MongoDB se llama &lt;strong&gt;mongodb-clients&lt;/strong&gt;.&lt;/p&gt;
&lt;p&gt;Así que si estamos en un sistema Debian o derivado, podemos instalarlo de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~$ sudo apt-get update
mviera@mongodb:~$ sudo apt-get install mongodb-server mongodb-clients
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;También podemos descargar los binarios desde la propia web oficial de MongoDB &lt;a href="http://www.mongodb.org/downloads"&gt;www.mongodb.org&lt;/a&gt; o el código fuente si lo que queremos es compilar nuestro propio MongoDB. Hay binarios disponibles para OS X, Linux, Windows para plataformas de 32 y 64bits; y Solaris 64 bits.&lt;/p&gt;
&lt;p&gt;Si lo que queremos es realizar un despliegue en producción, recomendaría&lt;br&gt;
instalar utilizando el sistema de paquetería del sistema con el que contaremos con futuras actualizaciones de seguridad, etc. Si el objetivo es aprender MongoDB, podemos instalarlo tanto a través del sistema de paquetería, como descargando los binarios desde la web de MongoDB.&lt;/p&gt;
&lt;p&gt;En este caso voy a descargar los binarios de MongoDB desde la sección de&lt;br&gt;
descargas de la web oficial, ya que lo utilizaré para aprender y enseñaros&lt;br&gt;
MongoDB. Son binarios precompilados, así que no será necesario instalar ningún paquete adicional en nuestro sistema.&lt;/p&gt;
&lt;p&gt;Para ello, descargamos el tarball que se ajuste a nuestro sistema, en este&lt;br&gt;
caso, Linux x86-64:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~$ wget http://fastdl.mongodb.org/linux/mongodb-linux-x86_64-2.2.3.tgz
mviera@mongodb:~$ tar xzf mongodb-linux-x86_64-2.2.3.tgz                                         
mviera@mongodb:~$ ln -s mongodb-linux-x86_64-2.2.3 mongodb                   
mviera@mongodb:~$ cd mongodb
mviera@mongodb:~/mongodb$ 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; he creado un enlace simbólico llamado &lt;em&gt;mongodb&lt;/em&gt; para evitar tener&lt;br&gt;
acceder a un directorio con un nombre tan largo y complejo.&lt;/p&gt;
&lt;p&gt;Si listamos el contenido del directorio recién descomprimido, deberíamos tener algo similar a los siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ tree 
.
|-- GNU-AGPL-3.0
|-- README
|-- THIRD-PARTY-NOTICES
`-- bin
    |-- bsondump
    |-- mongo
    |-- mongod
    |-- mongodump
    |-- mongoexport
    |-- mongofiles
    |-- mongoimport
    |-- mongooplog
    |-- mongoperf
    |-- mongorestore
    |-- mongos
    |-- mongosniff
    |-- mongostat
    `-- mongotop

1 directory, 17 files
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Entre ellos se encuentran el fichero de licencia &lt;em&gt;GNU-AGPL-3.0&lt;/em&gt;, el&lt;br&gt;
fichero_README_ y &lt;em&gt;THIRD-PARTY-NOTICES&lt;/em&gt;; y el directorio &lt;em&gt;bin/&lt;/em&gt; que contiene todos los binarios y utilidades necesarios para empezar con MongoDB. Aunque hay una buena selección de utilidades, de momento sólo vamos a utilizar &lt;strong&gt;mongod&lt;/strong&gt; y &lt;strong&gt;mongo&lt;/strong&gt; para familiarizarnos con MongoDB.&lt;/p&gt;
&lt;p&gt;Si la instalación de MongoDB se ha realizado utilizando el sistema de&lt;br&gt;
paquetería del sistema, estas utilidades y herramientas se encontrarán en los directorios habituales como &lt;em&gt;/usr/bin&lt;/em&gt;. En caso de Debian, es posible consultar los ficheros instalados con la siguiente instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~$ dpkg -L mongodb-server mongodb-clients
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="primeratomadecontacto"&gt;Primera toma de contacto&lt;/h2&gt;
&lt;p&gt;Una vez tenemos MongoDB instalado en nuestro sistema, lo primero que debemos hacer es iniciar la base de datos. Para ello utilizaremos &lt;em&gt;mongod&lt;/em&gt;. Si se ha instalado utilizando paquetería, es posible que se haya iniciado la base de datos automáticamente, especialmente en distribuciones basadas en Debian.&lt;/p&gt;
&lt;p&gt;Antes de ejecutarlo se necesita especificar el directorio donde se alojará la base de datos. Por defecto, MongoDB buscará el directorio &lt;em&gt;/data/db&lt;/em&gt; y si no lo encuentra, se producirá un error como el siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;*********************************************************************
 ERROR: dbpath (/data/db/) does not exist.
 Create this directory or give existing directory in --dbpath.
 See http://dochub.mongodb.org/core/startingandstoppingmongo
*********************************************************************
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Así que para evitar dicho error, crearemos un directorio local llamado &lt;em&gt;data&lt;/em&gt; en la ruta actual y especificaremos dicho directorio con el parámetro &lt;em&gt;--dbpath&lt;/em&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ mkdir data 
mviera@mongodb:~/mongodb$ ./bin/mongod --dbpath data
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si todo ha ido bien, deberíamos ver algo similar a la siguiente salida:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ ./bin/mongod --dbpath data/
Wed Feb  6 01:36:44 [initandlisten] MongoDB starting : pid=1082 port=27017 dbpath=data/ 64-bit host=mongodb
Wed Feb  6 01:36:44 [initandlisten] db version v2.2.3, pdfile version 4.5
Wed Feb  6 01:36:44 [initandlisten] git version: f570771a5d8a3846eb7586eaffcf4c2f4a96bf08
Wed Feb  6 01:36:44 [initandlisten] build info: Linux ip-10-2-29-40 2.6.21.7-2.ec2.v1.2.fc8xen ...
Wed Feb  6 01:36:44 [initandlisten] options: { dbpath: &amp;quot;data/&amp;quot; }
Wed Feb  6 01:36:44 [initandlisten] journal dir=data/journal
Wed Feb  6 01:36:44 [initandlisten] recover : no journal files present, no recovery needed
Wed Feb  6 01:36:44 [websvr] admin web console waiting for connections on port 28017
Wed Feb  6 01:36:44 [initandlisten] waiting for connections on port 27017
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como se puede observar, MongoDB se encuentra funcionando en el puerto &lt;strong&gt;27017&lt;/strong&gt; por defecto, su directorio de almacenamiento de la base de datos se encuentra en &lt;strong&gt;dbpath=data/&lt;/strong&gt; y además ofrece una consola de administración en el puerto &lt;strong&gt;28017&lt;/strong&gt;, a través de la cual podemos visualizar el log, listar bases de datos, etc.&lt;/p&gt;
&lt;p&gt;Si echamos un vistazo al directorio &lt;em&gt;data/&lt;/em&gt; deberíamos ver algo similar a lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ ls -l data/
total 8
drwxrwxr-x 2 mviera mviera 4096 Feb  6 01:36 journal
-rwxrwxr-x 1 mviera mviera    5 Feb  6 01:36 mongod.lock
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Actualmente, sólo tendremos un directorio &lt;em&gt;journal/&lt;/em&gt; para recuperaciones de&lt;br&gt;
datos en caso de desastre y el fichero &lt;em&gt;mongod.lock&lt;/em&gt; que almacena el PID del proceso &lt;em&gt;mongod&lt;/em&gt;.&lt;/p&gt;
&lt;h2 id="interactuandoconmongodb"&gt;Interactuando con MongoDB&lt;/h2&gt;
&lt;p&gt;Una vez tenemos nuestra base de datos MongoDB iniciada, el siguiente paso será conectar a ella utilizando la consola o &lt;em&gt;shell&lt;/em&gt;, en inglés, de Mongo. Para ello utilizaremos &lt;em&gt;mongo&lt;/em&gt; ejecutando la siguiente instrucción:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ ./bin/mongo
MongoDB shell version: 2.2.3
connecting to: test
Welcome to the MongoDB shell.
For interactive help, type &amp;quot;help&amp;quot;.
For more comprehensive documentation, see
    http://docs.mongodb.org/
Questions? Try the support group
    http://groups.google.com/group/mongodb-user
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si todo va bien, espero que sí, deberíamos ver el prompt de MongoDB. Por&lt;br&gt;
defecto Mongo, si no se le especifica lo contrario, siempre conectará a una&lt;br&gt;
base de datos &lt;strong&gt;test&lt;/strong&gt; en la que podremos realizar todas las pruebas que&lt;br&gt;
queramos.&lt;/p&gt;
&lt;p&gt;La &lt;em&gt;shell&lt;/em&gt; de Mongo es una shell interactiva de JavaScript, por lo que podremos hacer uso de código JavaScript en caso de que nos sea necesario. Es decir, podemos realizar operaciones básicas de JavaScript como las siguientes en la shell de Mongo:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; 2 + 3
5
&amp;gt; 
&amp;gt; 10 * 2
20
&amp;gt; 
&amp;gt; var double = function (n1) { return n1 * n1 }
&amp;gt; double(2)
4
&amp;gt; double
function (n1) {
    return n1 * n1;
}
&amp;gt; stuff = [1, 2, 3, 4]
[ 1, 2, 3, 4 ]
&amp;gt; for (n in stuff) { print( parseInt(n) * 2 ) }
0
2
4
6
&amp;gt; var x = {name: &amp;quot;mviera&amp;quot;, age: 26}
&amp;gt; x.age
26
&amp;gt; x.city = &amp;quot;Sevilla&amp;quot;
Sevilla
&amp;gt; x
{ &amp;quot;name&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26, &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot; }
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;IMPORTANTE:&lt;/strong&gt; Estas instrucciones &lt;strong&gt;NO&lt;/strong&gt; son de MongoDB, es puro JavaScript. &lt;strong&gt;La consola de MongoDB es una shell interactiva de JavaScript&lt;/strong&gt;.&lt;/p&gt;
&lt;h2 id="familiarizacinconelentorno"&gt;Familiarización con el entorno...&lt;/h2&gt;
&lt;p&gt;Bien. Estamos conectados a la consola de Mongo, así que nuestro siguiente paso será crear una base de datos. Podemos comprobar cuál es la base de datos que estamos usando actualmente llamando al objeto &lt;strong&gt;db&lt;/strong&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db
test
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Crear una base de datos es tan fácil como ejecutar lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; use mydb
switched to db mydb
&amp;gt; db
mydb
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos observar que el valor del objeto &lt;em&gt;db&lt;/em&gt; ha cambiado a &lt;strong&gt;mydb&lt;/strong&gt;. Lo&lt;br&gt;
siguiente será crear una colección, llamado &lt;em&gt;collection&lt;/em&gt; en inglés. Las&lt;br&gt;
colecciones son los contenedores de los documentos en MongoDB. Serían las&lt;br&gt;
conocidas tablas que contienen los datos en las bases de datos relacionales.&lt;/p&gt;
&lt;p&gt;Podemos crear una colección de prueba de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.createCollection(&amp;quot;test&amp;quot;)
{ &amp;quot;ok&amp;quot; : 1 }
&amp;gt; 
&amp;gt; show collections
system.indexes
test
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pero en MongoDB no es necesario crear una colección antes de introducir datos por primera vez, ya que Mongo comprobará previamente si existe la colección y si no, la creará automáticamente por nosotros.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.test2.insert({username:&amp;quot;mviera&amp;quot;})
&amp;gt; 
&amp;gt; show collections
system.indexes
test
test2
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como se puede observar, la colección &lt;strong&gt;test2&lt;/strong&gt; se ha creado automáticamente al crear el documento &lt;code&gt;{username:&amp;quot;mviera&amp;quot;}&lt;/code&gt; dentro de él. Con esto ya he&lt;br&gt;
introducido rápidamente la forma de introducir datos en una colección de&lt;br&gt;
MongoDB. De todas formas, la sintaxis de uso es la siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;db.&amp;lt;nombre_coleccion&amp;gt;.verbo()
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Donde &lt;code&gt;verbo()&lt;/code&gt; puede ser:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;insert&lt;/code&gt;: para insertar documentos en la colección.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;find&lt;/code&gt;: para buscar o seleccionar documentos dentro de la colección.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;count&lt;/code&gt;: para contar el total de documentos dentro de una colección.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;update&lt;/code&gt;: para actualizar uno o varios documentos dentro de una colección.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;remove&lt;/code&gt;: para eliminar documentos de la colección.&lt;/li&gt;
&lt;li&gt;&lt;code&gt;drop&lt;/code&gt;: para eliminar una colección.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id="hagamosunosejercicios"&gt;Hagamos unos ejercicios&lt;/h2&gt;
&lt;p&gt;Nuestra base de datos actual se llama &lt;code&gt;mydb&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db
mydb
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;y actualmente nuestra base de datos sólo contiene tres colecciones:&lt;br&gt;
&lt;code&gt;system.indexes&lt;/code&gt; (creada por MongoDB automáticamente), &lt;code&gt;test&lt;/code&gt; y &lt;code&gt;test2&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; show collections
system.indexes
test
test2
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Crearemos tres documentos que describirán usuarios dentro de una colección que se llamará &lt;code&gt;users&lt;/code&gt;. Los datos a almacenar en los documentos serán: username, age (edad), y ciudad. Para ello utilizaremos el método &lt;code&gt;insert&lt;/code&gt; y podemos hacerlo de varias formas:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Directamente especificando el documento JSON en el método &lt;code&gt;insert()&lt;/code&gt;:&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;db.users.insert({username:&amp;quot;mviera&amp;quot;,age:26,city:&amp;quot;Sevilla&amp;quot;})&lt;br&gt;
db.users.insert({username:&amp;quot;robot&amp;quot;, age:32, city:&amp;quot;Cadiz&amp;quot;})&lt;br&gt;
db.users.insert({username:&amp;quot;testuser&amp;quot;, age:20, city:&amp;quot;Malaga&amp;quot;})&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Almacenar los documentos en variables JavaScript y posteriormente utilizar dicha variable en &lt;code&gt;insert()&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   &amp;gt; user1 = {username:&amp;quot;mviera&amp;quot;,age:26,city:&amp;quot;Sevilla&amp;quot;}
   { &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26, &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot; }
   &amp;gt; user2 = {username:&amp;quot;robot&amp;quot;, age:32, city:&amp;quot;Cadiz&amp;quot;}
   { &amp;quot;username&amp;quot; : &amp;quot;robot&amp;quot;, &amp;quot;age&amp;quot; : 32, &amp;quot;city&amp;quot; : &amp;quot;Cadiz&amp;quot; }
   &amp;gt; user3 = {username:&amp;quot;testuser&amp;quot;, age:20, city:&amp;quot;Malaga&amp;quot;}
   { &amp;quot;username&amp;quot; : &amp;quot;testuser&amp;quot;, &amp;quot;age&amp;quot; : 20, &amp;quot;city&amp;quot; : &amp;quot;Malaga&amp;quot; }
   &amp;gt; 
   &amp;gt; 
   &amp;gt; db.users.insert(user1)
   &amp;gt; db.users.insert(user2)
   &amp;gt; db.users.insert(user3)
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Utilizando un for loop de JavaScript en la shell de Mongo para automatizar la tarea:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   &amp;gt; users = [user1, user2, user3]
   &amp;gt; for (i = 0; i &amp;lt; users.length; i++) { db.users.insert(users[i]) }
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Realmente en los tres casos hemos hecho lo mismo, pero solamente&lt;br&gt;
quería mostrar la potencia que ofrece la shell de Mongo, una shell de&lt;br&gt;
JavaScript.&lt;/p&gt;
&lt;p&gt;Si consultamos de nuevo las colecciones disponibles en nuestra base de datos &lt;code&gt;mydb&lt;/code&gt;, podremos observar que MongoDB ha creado la colección &lt;code&gt;users&lt;/code&gt; por nosotros, y de forma automática:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; show collections
system.indexes
test
test2
users
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Después de esto, deberíamos ser capaces de saber cuántos documentos hay en lacolección &lt;code&gt;users&lt;/code&gt;, pero podemos cerciorarnos utilizando el método &lt;code&gt;count&lt;/code&gt; en nuestra colección:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.count()
3
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¡Perfecto! Eso quiere decir que hasta ahora ha ido todo de maravilla. Ya solo nos falta poder seleccionar dichos documentos, es decir, poder recuperar dicha información de la base de datos. Esto lo conseguiremos con el método &lt;code&gt;find&lt;/code&gt;, ejecutando lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find()
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89517&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26, &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot; }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89518&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;robot&amp;quot;, &amp;quot;age&amp;quot; : 32, &amp;quot;city&amp;quot; : &amp;quot;Cadiz&amp;quot; }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89519&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;testuser&amp;quot;, &amp;quot;age&amp;quot; : 20, &amp;quot;city&amp;quot; : &amp;quot;Malaga&amp;quot; }
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¡Bien! Pero... seguro que os estáis preguntando por ese campo llamado &lt;code&gt;_id&lt;/code&gt;... ¿Qué significa?¿Por qué está ahí?&lt;/p&gt;
&lt;p&gt;En MongoDB todo documento tiene que tener un &lt;strong&gt;identificador único dentro de la colección&lt;/strong&gt; que puede ser especificado explicitamente con el campo &lt;code&gt;_id&lt;/code&gt; dentro del documento, y si no se especifica ninguno, Mongo creará uno automáticamente por nosotros sin que tengamos que preocuparnos de ello.&lt;/p&gt;
&lt;p&gt;De esta forma, podemos introducir un nuevo documento que sí tenga especificado un &lt;code&gt;_id&lt;/code&gt; por nosotros:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.insert({_id: 101, username:&amp;quot;iloveyou&amp;quot;, age: 12, likes: &amp;quot;destroy your computer&amp;quot;})
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Y si ahora volvemos a recuperar todos los documentos de la colección &lt;code&gt;users&lt;/code&gt;, debería aparecer el nuevo documento en la lista:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.users.find()
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89517&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;mviera&amp;quot;, &amp;quot;age&amp;quot; : 26, &amp;quot;city&amp;quot; : &amp;quot;Sevilla&amp;quot; }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89518&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;robot&amp;quot;, &amp;quot;age&amp;quot; : 32, &amp;quot;city&amp;quot; : &amp;quot;Cadiz&amp;quot; }
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;51118e261caf692fdfc89519&amp;quot;), &amp;quot;username&amp;quot; : &amp;quot;testuser&amp;quot;, &amp;quot;age&amp;quot; : 20, &amp;quot;city&amp;quot; : &amp;quot;Malaga&amp;quot; }
{ &amp;quot;_id&amp;quot; : 101, &amp;quot;username&amp;quot; : &amp;quot;iloveyou&amp;quot;, &amp;quot;age&amp;quot; : 12, &amp;quot;likes&amp;quot; : &amp;quot;destroy your computer&amp;quot; }
&amp;gt;
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¿Recordáis lo que comentaba al principio sobre &lt;em&gt;schemaless&lt;/em&gt;? Si se observa ellistado de documentos anterior, se puede ver que los campos de los tres&lt;br&gt;
primeros documentos son &lt;em&gt;username&lt;/em&gt;, &lt;em&gt;age&lt;/em&gt; y &lt;em&gt;city&lt;/em&gt;. Pero sin embargo, el nuevo documento introducido no solo no utiliza el campo &lt;em&gt;city&lt;/em&gt; sino que además incluye uno nuevo llamado &lt;em&gt;likes&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Esto es debido a la flexibilidad que ofrece MongoDB en sus esquemas, es decir, no todos los documentos tienen que tener los mismo campos, sino que pueden incluirse o no ciertos campos según convenga. De hecho, podría haberse incluido el campo &lt;code&gt;city&lt;/code&gt; con un valor &lt;code&gt;null&lt;/code&gt; pero si no lo incluimos, en el futuro ahorraremos espacio en la base de datos.&lt;/p&gt;
&lt;h2 id="retrospectiva"&gt;Retrospectiva&lt;/h2&gt;
&lt;p&gt;Después de todo esto, algo habrá ocurrido en nuestro directorio &lt;em&gt;data/&lt;/em&gt; donde se alojan las bases de datos. Si listamos el contenido del directorio, deberíamos ver algo como lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;mviera@mongodb:~/mongodb$ ls -lh data/
total 209M
drwxrwxr-x 2 mviera mviera 4.0K Feb  6 02:40 _tmp
drwxrwxr-x 2 mviera mviera 4.0K Feb  6 03:22 journal
-rwxrwxr-x 1 mviera mviera    0 Feb  6 03:22 mongod.lock
-rw------- 1 mviera mviera  64M Feb  6 03:08 mydb.0
-rw------- 1 mviera mviera 128M Feb  6 02:12 mydb.1
-rw------- 1 mviera mviera  16M Feb  6 03:08 mydb.ns
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Podemos observar que se han creado dos ficheros &lt;code&gt;mydb.0&lt;/code&gt; y &lt;code&gt;mydb.1&lt;/code&gt; que&lt;br&gt;
contienen los datos; y otro fichero llamado &lt;code&gt;mydb.ns&lt;/code&gt; que contiene el&lt;br&gt;
namespace. Si no estoy equivocado, y si lo estoy, por favor corregidme, MongoDB creará nuevos ficheros cuando los actuales ocupen un tamaño de 2G, con el fin de facilitar el traslado de estos fichero a través de la red, etc.&lt;/p&gt;
&lt;h2 id="apagayvmonos"&gt;Apaga y vámonos&lt;/h2&gt;
&lt;p&gt;Por último y para terminar el post, os comentaré cómo podemos para el servidor Mongo de forma correcta. Es muy sencillo, solamente tenemos que cambiar a la base de datos llamada &lt;code&gt;admin&lt;/code&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; use admin
switched to db admin
&amp;gt; db
admin
&amp;gt; 
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;y ejecutar el método &lt;code&gt;shutdownServer&lt;/code&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;&amp;gt; db.shutdownServer()
Wed Feb  6 03:29:30 DBClientCursor::init call() failed
Wed Feb  6 03:29:30 query failed : admin.$cmd { shutdown: 1.0 } to: 127.0.0.1:27017
server should be down...
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;¡Y esto es todo por ahora! Espero que el post haya sido de vuestro agrado y&lt;br&gt;
agradeceros a aquellos que hayáis llegado leyendo hasta esta linea. ¡Gracias!&lt;/p&gt;
&lt;p&gt;Con respecto a MongoDB es tipo de base de datos nueva para mi y que me está&lt;br&gt;
gustando bastante. Estoy estudiándola y aprendiendo a través de un curso de&lt;br&gt;
10gen, la empresa que la desarrolla. El curso es totalmente gratuito, no se si es posible apuntarse a estas alturas, ya que lleva tres semanas, pero os&lt;br&gt;
recomiendo que lo tengáis en cuenta para próximas ediciones. Podeis encontrarlo en &lt;a href="https://education.10gen.com"&gt;https://education.10gen.com&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;¡No olvideis comentar vuestras dudas o sugerencias!&lt;/p&gt;
&lt;p&gt;Un saludo, Manu.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item><item><title>Qué es un sparse file</title><description>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Hoy me he encontrado con el término &lt;em&gt;sparse file&lt;/em&gt; y realmente no lo conocía, aunque puede que os pase como a mi, que después de que os diga qué es, muchos de vosotros ya sabíais de su existencia e incluso es muy probable que hayáis trabajado con este tipo de&lt;/p&gt;</description><link>http://manuelviera.com/blog/que-es-un-sparse-file/</link><guid isPermaLink="false">5ee61b9846e19912dcb415b5</guid><category>tech</category><dc:creator>Manuel Viera</dc:creator><pubDate>Thu, 17 Jan 2013 10:00:00 GMT</pubDate><content:encoded>&lt;!--kg-card-begin: markdown--&gt;&lt;p&gt;Hoy me he encontrado con el término &lt;em&gt;sparse file&lt;/em&gt; y realmente no lo conocía, aunque puede que os pase como a mi, que después de que os diga qué es, muchos de vosotros ya sabíais de su existencia e incluso es muy probable que hayáis trabajado con este tipo de ficheros. Pero...&lt;/p&gt;
&lt;h2 id="quesunsparsefile"&gt;¿Qué es un &lt;em&gt;sparse file&lt;/em&gt;?&lt;/h2&gt;
&lt;p&gt;Un &lt;em&gt;sparse file&lt;/em&gt; es un tipo de fichero el cual se crea con un tamaño específico pero no se reserva dicho espacio en el sistema de ficheros inicialmente. Su tamaño irá creciendo a medida que vaya siendo necesario. Por ejemplo, podríamos crear un fichero cuyo tamaño máximo sea 2G pero que inicialmente en nuestro sistema de ficheros ocupe 0 bytes.&lt;/p&gt;
&lt;p&gt;Es muy probable que ya es sea más familiar este tipo de ficheros, sobre todo aquellos que hayáis trabajado con virtualización, por ejemplo con KVM&lt;br&gt;
utilizando virt-manager, cuando al crear un volumen de almacenamiento para una máquina virtual ofrece la opción de alojar la totalidad del volumen en el pool de almacenamiento, o que el tamaño del volumen vaya creciendo dinámicamente.&lt;/p&gt;
&lt;p&gt;Para temas de virtualización &lt;strong&gt;no&lt;/strong&gt; es aconsejable utilizar este tipo de&lt;br&gt;
ficheros porque pueden generar problemas de rendimiento e integridad de los&lt;br&gt;
datos. De todas formas, son bastante útiles para realizar pruebas.&lt;/p&gt;
&lt;h2 id="quventajasmeaporta"&gt;¿Qué ventajas me aporta?&lt;/h2&gt;
&lt;p&gt;Como ventajas puntualizaría la rapidez con la que son creados, que como he&lt;br&gt;
comentado anteriormente, para realizar pruebas son perfectos, ya que&lt;br&gt;
inicialmente &amp;quot;no ocupan&amp;quot; espacio en el sistema.&lt;/p&gt;
&lt;p&gt;Además utilizar un &lt;em&gt;sparse file&lt;/em&gt; nos permitirá crear un fichero de gran tamaño aunque en ese momento no dispongamos de tal espacio en nuestro sistema de ficheros.&lt;/p&gt;
&lt;h2 id="peronoesorotodoloquereluce"&gt;Pero no es oro todo lo que reluce...&lt;/h2&gt;
&lt;p&gt;Este tipo de fichero es soportado en la mayoría de los sistemas de ficheros&lt;br&gt;
modernos en Unix, incluso en NTFS; pero al parecer no es posible, y lo he&lt;br&gt;
comprobado, en HFS+ de Apple.&lt;/p&gt;
&lt;p&gt;A parte de los problemas de rendimiento e integridad con los datos comentados anteriormente, es posible que obtengamos resultados inesperados cuando tratemos de copiar este tipo de ficheros, pues si la utilidad que hemos usado para copiarlo no soporta este tipo de ficheros, será copiado con el tamaño completo.&lt;/p&gt;
&lt;p&gt;Afortunadamente &lt;em&gt;cp&lt;/em&gt;, por defecto, y &lt;em&gt;rsync&lt;/em&gt; con la opción &lt;strong&gt;-S&lt;/strong&gt; /&lt;br&gt;
&lt;strong&gt;--sparse&lt;/strong&gt;, soportan este tipo de ficheros.&lt;/p&gt;
&lt;h2 id="ycmocreounsparsefile"&gt;¿Y cómo creo un &lt;em&gt;sparse file&lt;/em&gt;?&lt;/h2&gt;
&lt;p&gt;La creación de un &lt;em&gt;sparse file&lt;/em&gt; es muy sencillo, es posible hacerlo con el&lt;br&gt;
comando &lt;em&gt;dd&lt;/em&gt; que muchos ya conoceréis al haber creado ficheros llenos de ceros de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dd if=/dev/zero of=file.img bs=1M count=1G
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Esta instrucción creará un fichero lleno de ceros ocupando 1G de espacio en&lt;br&gt;
vuestro sistema de ficheros.&lt;/p&gt;
&lt;p&gt;Pero para crear un &lt;em&gt;sparse file&lt;/em&gt; será necesario ejecutar la siguiente&lt;br&gt;
instrucción, similar a la anterior:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dd if=/dev/zero of=file.img bs=1M count=0 seek=1024
0+0 registros leídos
0+0 registros escritos
0 bytes (0 B) copiados, 1,802e-05 s, 0,0 kB/s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;El truco se encuentra en el operador &lt;strong&gt;seek&lt;/strong&gt;. En este caso tendremos un&lt;br&gt;
fichero que inicialmente ocupa 0 bytes pero con un tamaño de 1G en potencia.&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ du -hs file.img 
0   file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Sin embargo, podemos ver su tamaño real con la opción &lt;strong&gt;--apparent-size&lt;/strong&gt; de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ du -h --apparent-size file.img
1,0G    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="perocmocomprueboquesutamaocrecedinmicamente"&gt;¿Pero cómo compruebo que su tamaño crece dinámicamente?&lt;/h2&gt;
&lt;p&gt;Es muy sencillo, crearemos ficheros dentro de este y veremos cómo aumenta de tamaño dinámicamente hasta un total de 1G. Para ello seguiremos los siguiente pasos:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;Crearemos un sistema de ficheros en &lt;em&gt;file.img&lt;/em&gt;, lo cual nos va a permitir alojar ficheros dentro de él convirtiéndolo en un volumen de almacenamiento:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   $ mkfs.ext4 -q file.img  
   file.img no es un dispositivo especial de bloques.
   ¿Continuar de todas formas? (s,n) s
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Montamos el fichero como si de un dispositivo de almacenamiento se&lt;br&gt;
tratase, utilizando el comando &lt;em&gt;mount&lt;/em&gt;, de la siguiente forma:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   $ mkdir mnt
   $ sudo mount -t auto file.img mnt
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Si listamos los puntos de montaje actuales en nuestro sistema, deberíamos ver el fichero &lt;em&gt;file.img&lt;/em&gt; montado en el directorio local &lt;em&gt;mnt&lt;/em&gt;:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;    $ mount |grep file.img
    /tmp/file.img on /tmp/mnt type ext4 (rw)
&lt;/code&gt;&lt;/pre&gt;
&lt;ol start="3"&gt;
&lt;li&gt;
&lt;p&gt;Creamos varios ficheros temporales dentro del punto de montaje:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   $ for i in {1..10};do mktemp --tmpdir=mnt; done
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; aprovecho para enseñar el comando &lt;em&gt;mktemp&lt;/em&gt; crea un fichero temporal del tipo &lt;em&gt;tmp.XXXXXXXX&lt;/em&gt; en el directorio actual. Con la opción &lt;em&gt;--tmpdir&lt;/em&gt; es posible indicar el directorio destino donde se creará el fichero temporal.&lt;/p&gt;
&lt;ol start="4"&gt;
&lt;li&gt;
&lt;p&gt;Comprobamos que el tamaño del fichero ha crecido con respecto al estado anterior:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;   $ du -h file.img 
   49M    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;Y obviamente el tamaño total sigue siendo 1G:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;    $ du -h --apparent-size file.img 
    1,0G    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="dndeestellmite"&gt;Dónde está el límite&lt;/h2&gt;
&lt;p&gt;Lo único que nos falta comprobar es dónde está el limite. En el ejemplo&lt;br&gt;
utilizado es 1G, así que intentaremos crear un fichero de un tamaño mayor que el total del &lt;em&gt;sparse file&lt;/em&gt;.&lt;/p&gt;
&lt;p&gt;Teniendo montado el fichero en el directorio &lt;em&gt;mnt&lt;/em&gt;, crearemos un fichero de 2G dentro de este, ejecutando lo siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dd if=/dev/zero of=file bs=1M count=2048
dd: escribiendo «file»: No queda espacio en el dispositivo
924+0 registros leídos
923+0 registros escritos
968290304 bytes (968 MB) copiados, 4,71871 s, 205 MB/s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Como podemos observar, nos ha avisado de que no queda espacio libre en el&lt;br&gt;
dispositivo y si comprobamos el tamaño actual del fichero obtendremos lo&lt;br&gt;
siguiente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ du -h file.img 
973M    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;&lt;strong&gt;Nota:&lt;/strong&gt; Hay un resto de espacio de 27M que es posible que sea debido a la&lt;br&gt;
reserva del 5% de espacio para el usuario root. Siempre hay una reserva de&lt;br&gt;
espacio para el usuario root, por defecto del 5%, de forma que este pueda&lt;br&gt;
acceder al dispositivo cuando haya alcanzado su límite de espacio. Si&lt;br&gt;
eliminamos dicha reserva, &lt;strong&gt;para nada recomendable en producción&lt;/strong&gt; pero en este caso estamos probando en un fichero local, podremos comprobar que si volvemos a crear el fichero de 2G dentro del &lt;em&gt;sparse file&lt;/em&gt;, el espacio llega a ocuparse completamente:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ tune2fs -m 0 file.img 
tune2fs 1.41.14 (22-Dec-2010)
Setting reserved blocks percentage to 0% (0 blocks)

$ dd if=/dev/zero of=file bs=1M count=2048
dd: escribiendo «file»: No queda espacio en el dispositivo
965+0 registros leídos
964+0 registros escritos
1011208192 bytes (1,0 GB) copiados, 3,27181 s, 309 MB/s

$ du -h file.img  
1,0G    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;h2 id="actualizacinysiqueremosaumentarellmite"&gt;Actualización: ¿Y si queremos aumentar el límite?&lt;/h2&gt;
&lt;p&gt;Ayer se me debió pasar esta cuestión mientras me centraba en escribir, pero sí, es posible aumentar el tamaño del &lt;em&gt;sparse file&lt;/em&gt;, ¿pero cómo?&lt;/p&gt;
&lt;p&gt;Pues muy sencillo, solo tenemos que volver a utilizar el comando &lt;em&gt;dd&lt;/em&gt; indicando un tamaño mayor en el parámetro &lt;em&gt;seek&lt;/em&gt;, como indico a continuación:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ dd if=/dev/zero of=file.img bs=1M count=0 seek=2048
0+0 registros leídos
0+0 registros escritos
0 bytes (0 B) copiados, 1,6064e-05 s, 0,0 kB/s
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Si comprobamos ahora el tamaño del fichero, podremos observar que su tamaño&lt;br&gt;
total a aumentado en 1G:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ du -h --apparent-size file.img 
2,0G    file.img
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Pero aun no hemos terminado, sólo nos falta &lt;strong&gt;redimensionar&lt;/strong&gt; el sistema de&lt;br&gt;
ficheros incluido en él, y esto lo haremos haciendo uso del comando &lt;em&gt;resize2fs&lt;/em&gt;, pero primero realizaremos un chequeo del sistema de ficheros:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;e2fsck -f file.img 
e2fsck 1.41.14 (22-Dec-2010)
Paso 1: Verificando nodos-i, bloques y tamaños
Paso 2: Verificando la estructura de directorios
Paso 3: Revisando la conectividad de directorios
Paso 4: Revisando las cuentas de referencia
Paso 5: Revisando el resumen de información de grupos
file.img: 22/65536 ficheros (0.0% no contiguos), 259513/262144 bloques

$ resize2fs file.img 
resize2fs 1.41.14 (22-Dec-2010)
Resizing the filesystem on file.img to 524288 (4k) blocks.
El sistema de ficheros en file.img tiene ahora 524288 bloques.
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Por último, si comprobamos el total de espacio disponible dentro del &lt;em&gt;sparse file&lt;/em&gt; podremos observar que a aumentado a 2G:&lt;/p&gt;
&lt;pre&gt;&lt;code&gt;$ df -h mnt 
S.ficheros     Tamaño Usado  Disp Uso% Montado en
/dev/loop0       2,0G  998M  998M  51% /tmp/mnt
&lt;/code&gt;&lt;/pre&gt;
&lt;p&gt;Espero que os haya parecido interesante! No dudéis en comentar!&lt;/p&gt;
&lt;p&gt;Un saludo, Manu.&lt;/p&gt;
&lt;!--kg-card-end: markdown--&gt;</content:encoded></item></channel></rss>