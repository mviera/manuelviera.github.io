<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Qué es un sparse file</title>
  <link rel="stylesheet" href="/assets/css/screen.css?v=67116d8245">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i,800">

  <script>
    var siteUrl = 'https://manuelviera.com';
  </script>
  <script>
  var themeOptions = {
    disqus_shortname: '',
    search_key: '',
    search_migration: 'v1',
    white_logo: '',
    white_icon: '',
  };
</script>
  <script>
    var localTheme = localStorage.getItem('dawn_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://manuelviera.com/blog/que-es-un-sparse-file/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://manuelviera.com/blog/que-es-un-sparse-file/amp/" />
    
    <meta property="og:site_name" content="Manuel Viera" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Qué es un sparse file" />
    <meta property="og:description" content="Hoy me he encontrado con el término sparse file y realmente no lo conocía, aunque puede que os pase como a mi, que después de que os diga qué es, muchos de vosotros ya sabíais de su existencia e incluso es muy probable que hayáis trabajado con este tipo de" />
    <meta property="og:url" content="https://manuelviera.com/blog/que-es-un-sparse-file/" />
    <meta property="article:published_time" content="2013-01-17T10:00:00.000Z" />
    <meta property="article:modified_time" content="2020-06-14T12:48:47.000Z" />
    <meta property="article:tag" content="tech" />
    
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:title" content="Qué es un sparse file" />
    <meta name="twitter:description" content="Hoy me he encontrado con el término sparse file y realmente no lo conocía, aunque puede que os pase como a mi, que después de que os diga qué es, muchos de vosotros ya sabíais de su existencia e incluso es muy probable que hayáis trabajado con este tipo de" />
    <meta name="twitter:url" content="https://manuelviera.com/blog/que-es-un-sparse-file/" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Manuel Viera" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="tech" />
    <meta name="twitter:site" content="@mviera" />
    <meta name="twitter:creator" content="@mviera" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Manuel Viera",
        "url": "https://manuelviera.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://manuelviera.com/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Manuel Viera",
        "image": {
            "@type": "ImageObject",
            "url": "https://manuelviera.com/content/images/2020/06/2020-06-22-161222_428x430_scrot.png",
            "width": 428,
            "height": 430
        },
        "url": "https://manuelviera.com/author/mviera/",
        "sameAs": [
            "https://manuelviera.com",
            "https://twitter.com/mviera"
        ]
    },
    "headline": "Qué es un sparse file",
    "url": "https://manuelviera.com/blog/que-es-un-sparse-file/",
    "datePublished": "2013-01-17T10:00:00.000Z",
    "dateModified": "2020-06-14T12:48:47.000Z",
    "keywords": "tech",
    "description": "Hoy me he encontrado con el término sparse file y realmente no lo conocía,\naunque puede que os pase como a mi, que después de que os diga qué es, muchos de\nvosotros ya sabíais de su existencia e incluso es muy probable que hayáis\ntrabajado con este tipo de ficheros. Pero...\n\n¿Qué es un sparse file?\nUn sparse file es un tipo de fichero el cual se crea con un tamaño específico\npero no se reserva dicho espacio en el sistema de ficheros inicialmente. Su\ntamaño irá creciendo a medida que vaya siendo ",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://manuelviera.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.19" />
    <link rel="alternate" type="application/rss+xml" title="Manuel Viera" href="https://manuelviera.com/blog/rss/" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;0,900;1,400;1,700&display=swap">
</head>
<body class="post-template tag-tech">
  <svg width="0" height="0" style="display: none;">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="arrow-left">
    <title>arrow-left</title>
    <path d="M26.667 14.667v2.667h-16L18 24.667l-1.893 1.893L5.547 16l10.56-10.56L18 7.333l-7.333 7.333h16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="arrow-right">
    <title>arrow-right</title>
    <path d="M5.333 14.667v2.667h16L14 24.667l1.893 1.893L26.453 16 15.893 5.44 14 7.333l7.333 7.333h-16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="brightness-2">
    <title>brightness-2</title>
    <path d="M13.333 2.667c-2.427 0-4.707.667-6.667 1.8 4 2.307 6.667 6.6 6.667 11.533s-2.667 9.227-6.667 11.533c1.96 1.133 4.24 1.8 6.667 1.8 7.36 0 13.333-5.973 13.333-13.333S20.693 2.667 13.333 2.667z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="chevron-left">
    <title>chevron-left</title>
    <path d="M20.547 22.107L14.44 16l6.107-6.12L18.667 8l-8 8 8 8 1.88-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="chevron-right">
    <title>chevron-right</title>
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="circle-half-full">
    <title>circle-half-full</title>
    <path d="M16 2.667c-7.36 0-13.333 5.973-13.333 13.333s5.973 13.333 13.333 13.333c7.36 0 13.333-5.973 13.333-13.333s-5.973-13.333-13.333-13.333zM16 5.333c5.893 0 10.667 4.773 10.667 10.667s-4.773 10.667-10.667 10.667v-21.333z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="dots-horizontal">
    <title>dots-horizontal</title>
    <path d="M21.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM13.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM5.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="facebook-box">
    <title>facebook-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zM24 6.667h-3.333A4.672 4.672 0 0 0 16 11.334v3.333h-2.667v4H16V28h4v-9.333h4v-4h-4V12c0-.733.6-1.333 1.333-1.333H24v-4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="facebook">
    <title>facebook</title>
    <path d="M22.667 2.667V8H20c-.92 0-1.333 1.08-1.333 2v3.333h4v5.333h-4v10.667h-5.333V18.666h-4v-5.333h4V8a5.332 5.332 0 0 1 5.333-5.333h4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" id="loader">
    <title>loader</title>
    <path opacity="0.3" fill="currentColor" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z" />
    <path fill="currentColor" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z">
      <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.5s" repeatCount="indefinite" />
    </path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="magnify">
    <title>magnify</title>
    <path d="M12.667 4a8.667 8.667 0 0 1 8.667 8.667c0 2.147-.787 4.12-2.08 5.64l.36.36h1.053l6.667 6.667-2 2-6.667-6.667v-1.053l-.36-.36a8.689 8.689 0 0 1-5.64 2.08C7.88 21.334 4 17.454 4 12.667S7.88 4 12.667 4zm0 2.667c-3.333 0-6 2.667-6 6s2.667 6 6 6 6-2.667 6-6-2.667-6-6-6z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="menu-down">
    <title>menu-down</title>
    <path d="M9.333 13.333L16 20l6.667-6.667H9.334z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="rss-box">
    <title>rss-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zM10 20c-1.107 0-2 .893-2 2s.893 2 2 2 2-.893 2-2-.893-2-2-2zm-2-6.667V16c4.413 0 8 3.587 8 8h2.667c0-5.893-4.773-10.667-10.667-10.667zM8 8v2.667c7.36 0 13.333 5.973 13.333 13.333H24c0-8.84-7.16-16-16-16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="star">
    <title>star</title>
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="table-of-contents">
    <path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="twitter-box">
    <title>twitter-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zm16.946 8.44c.64-.533 1.387-1.173 1.72-1.88-.547.28-1.2.453-1.92.547.667-.48 1.213-1.107 1.493-1.96-.693.373-1.4.693-2.28.853-2.067-2.493-7.013-.467-6.133 3.267-3.48-.213-5.6-1.787-7.36-3.72-1 1.627-.133 4.093 1.053 4.773-.613-.04-1.08-.227-1.52-.44.053 2.053 1.187 3.04 2.773 3.573a4.47 4.47 0 0 1-1.52.04c.493 1.427 1.52 2.32 3.28 2.507-1.2 1.013-3.413 1.72-5.2 1.44 1.533.973 3.28 1.747 5.707 1.64 5.88-.267 9.813-4.48 9.907-10.64z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="twitter">
    <title>twitter</title>
    <path d="M29.947 8a11.423 11.423 0 0 1-3.28.92 5.738 5.738 0 0 0 2.507-3.173 11.52 11.52 0 0 1-3.627 1.4C24.494 6 23.014 5.334 21.334 5.334c-3.133 0-5.693 2.56-5.693 5.72 0 .453.053.893.147 1.307A16.261 16.261 0 0 1 4.001 6.388a5.663 5.663 0 0 0-.773 2.867c0 1.987 1 3.747 2.547 4.747-.947 0-1.827-.267-2.6-.667v.04a5.724 5.724 0 0 0 4.587 5.613 5.644 5.644 0 0 1-2.574.093c.72 2.253 2.813 3.933 5.333 3.973-1.947 1.547-4.413 2.453-7.107 2.453-.453 0-.907-.027-1.36-.08A16.19 16.19 0 0 0 10.827 28c10.507 0 16.28-8.72 16.28-16.28 0-.253 0-.493-.013-.747A11.42 11.42 0 0 0 29.947 8z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="white-balance-sunny">
    <title>white-balance-sunny</title>
    <path d="M4.733 24.72l1.88 1.88 2.4-2.387L7.12 22.32zm9.934 5.213h2.667V26h-2.667zM16 7.333c-4.413 0-8 3.587-8 8s3.587 8 8 8 8-3.587 8-8c0-4.427-3.587-8-8-8zm10.667 9.334h4V14h-4zm-3.68 7.546l2.4 2.387 1.88-1.88-2.387-2.4zm4.28-18.266l-1.88-1.88-2.4 2.387 1.893 1.893zM17.333.733h-2.667v3.933h2.667zM5.333 14h-4v2.667h4zm3.68-7.547l-2.4-2.387-1.88 1.88 2.387 2.4 1.893-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="window-close">
    <title>window-close</title>
    <path d="M17.947 16l7.387 7.387v1.947h-1.947L16 17.947l-7.387 7.387H6.666v-1.947L14.053 16 6.666 8.613V6.666h1.947L16 14.053l7.387-7.387h1.947v1.947L17.947 16z"></path>
  </symbol>
</svg>  <div class="container">
    <div class="site">
      <header class="site-header">
  <div class="header-left">
    <a class="logo" href="https://manuelviera.com">
        <span class="logo-text">Manuel Viera</span>
    </a>
  </div>
    <nav class="main-nav hidden-xs hidden-sm hidden-md">
        <a class="menu-item menu-item-about" href="https://manuelviera.com/about/">about</a>
  <a class="menu-item menu-item-tech" href="https://manuelviera.com/tag/tech/">tech</a>
  <a class="menu-item menu-item-self-tracking" href="https://manuelviera.com/tag/self-tracking/">self-tracking</a>
  <a class="menu-item menu-item-author" href="https://manuelviera.com/author/mviera/">author</a>

    </nav>
    
    <button class="button-icon hidden-lg hidden-xl js-modal" data-modal="search">
      <svg class="icon"><use xlink:href="#magnify"></use></svg>
    </button>
    <div class="burger hidden-lg hidden-xl">
      <div class="burger-bar"></div>
      <div class="burger-bar"></div>
    </div>

    <div class="mobile-menu hidden-lg hidden-xl">
      <div class="container">
        <nav class="mobile-nav">
            <a class="menu-item menu-item-about" href="https://manuelviera.com/about/">about</a>
  <a class="menu-item menu-item-tech" href="https://manuelviera.com/tag/tech/">tech</a>
  <a class="menu-item menu-item-self-tracking" href="https://manuelviera.com/tag/self-tracking/">self-tracking</a>
  <a class="menu-item menu-item-author" href="https://manuelviera.com/author/mviera/">author</a>

        </nav>
      </div>
    </div>
  <div class="header-right hidden-xs hidden-sm hidden-md">
      <button class="button-icon js-modal" data-modal="search">
        <svg class="icon"><use xlink:href="#magnify"></use></svg>
      </button>
  </div>
</header>

    <header class="sticky kg-width-full">
      <div class="sticky-title">Qué es un sparse file</div>
      <button class="button-icon sticky-toc-button">
        <svg class="icon"><use xlink:href="#table-of-contents"></use></svg>
        <div class="sticky-toc"></div>
      </button>
      <div class="sticky-track">
        <div class="sticky-progress"></div>
      </div>
    </header>
      <div class="site-content">
        
<div class="content-area">
  <main class="site-main">
      <article class="single post tag-tech no-image kg-width-narrow">
  <header class="single-header">
      <div class="single-meta">
        <span class="single-meta-item single-meta-date">
          <time datetime="2013-01-17">
            Jan 17, 2013
          </time>
        </span>
        <span class="single-meta-item single-meta-length">
          5 min read
        </span>
          <span class="single-meta-item single-meta-tag">
            <a class="post-tag post-tag-tech" href="/tag/tech/">
              #tech
            </a>
          </span>
      </div>
    <h1 class="single-title">Qué es un sparse file</h1>
  </header>
  <div class="single-content u-text-format">
      <!--kg-card-begin: markdown--><p>Hoy me he encontrado con el término <em>sparse file</em> y realmente no lo conocía, aunque puede que os pase como a mi, que después de que os diga qué es, muchos de vosotros ya sabíais de su existencia e incluso es muy probable que hayáis trabajado con este tipo de ficheros. Pero...</p>
<h2 id="quesunsparsefile">¿Qué es un <em>sparse file</em>?</h2>
<p>Un <em>sparse file</em> es un tipo de fichero el cual se crea con un tamaño específico pero no se reserva dicho espacio en el sistema de ficheros inicialmente. Su tamaño irá creciendo a medida que vaya siendo necesario. Por ejemplo, podríamos crear un fichero cuyo tamaño máximo sea 2G pero que inicialmente en nuestro sistema de ficheros ocupe 0 bytes.</p>
<p>Es muy probable que ya es sea más familiar este tipo de ficheros, sobre todo aquellos que hayáis trabajado con virtualización, por ejemplo con KVM<br>
utilizando virt-manager, cuando al crear un volumen de almacenamiento para una máquina virtual ofrece la opción de alojar la totalidad del volumen en el pool de almacenamiento, o que el tamaño del volumen vaya creciendo dinámicamente.</p>
<p>Para temas de virtualización <strong>no</strong> es aconsejable utilizar este tipo de<br>
ficheros porque pueden generar problemas de rendimiento e integridad de los<br>
datos. De todas formas, son bastante útiles para realizar pruebas.</p>
<h2 id="quventajasmeaporta">¿Qué ventajas me aporta?</h2>
<p>Como ventajas puntualizaría la rapidez con la que son creados, que como he<br>
comentado anteriormente, para realizar pruebas son perfectos, ya que<br>
inicialmente &quot;no ocupan&quot; espacio en el sistema.</p>
<p>Además utilizar un <em>sparse file</em> nos permitirá crear un fichero de gran tamaño aunque en ese momento no dispongamos de tal espacio en nuestro sistema de ficheros.</p>
<h2 id="peronoesorotodoloquereluce">Pero no es oro todo lo que reluce...</h2>
<p>Este tipo de fichero es soportado en la mayoría de los sistemas de ficheros<br>
modernos en Unix, incluso en NTFS; pero al parecer no es posible, y lo he<br>
comprobado, en HFS+ de Apple.</p>
<p>A parte de los problemas de rendimiento e integridad con los datos comentados anteriormente, es posible que obtengamos resultados inesperados cuando tratemos de copiar este tipo de ficheros, pues si la utilidad que hemos usado para copiarlo no soporta este tipo de ficheros, será copiado con el tamaño completo.</p>
<p>Afortunadamente <em>cp</em>, por defecto, y <em>rsync</em> con la opción <strong>-S</strong> /<br>
<strong>--sparse</strong>, soportan este tipo de ficheros.</p>
<h2 id="ycmocreounsparsefile">¿Y cómo creo un <em>sparse file</em>?</h2>
<p>La creación de un <em>sparse file</em> es muy sencillo, es posible hacerlo con el<br>
comando <em>dd</em> que muchos ya conoceréis al haber creado ficheros llenos de ceros de la siguiente forma:</p>
<pre><code>$ dd if=/dev/zero of=file.img bs=1M count=1G
</code></pre>
<p>Esta instrucción creará un fichero lleno de ceros ocupando 1G de espacio en<br>
vuestro sistema de ficheros.</p>
<p>Pero para crear un <em>sparse file</em> será necesario ejecutar la siguiente<br>
instrucción, similar a la anterior:</p>
<pre><code>$ dd if=/dev/zero of=file.img bs=1M count=0 seek=1024
0+0 registros leídos
0+0 registros escritos
0 bytes (0 B) copiados, 1,802e-05 s, 0,0 kB/s
</code></pre>
<p>El truco se encuentra en el operador <strong>seek</strong>. En este caso tendremos un<br>
fichero que inicialmente ocupa 0 bytes pero con un tamaño de 1G en potencia.</p>
<pre><code>$ du -hs file.img 
0   file.img
</code></pre>
<p>Sin embargo, podemos ver su tamaño real con la opción <strong>--apparent-size</strong> de la siguiente forma:</p>
<pre><code>$ du -h --apparent-size file.img
1,0G    file.img
</code></pre>
<h2 id="perocmocomprueboquesutamaocrecedinmicamente">¿Pero cómo compruebo que su tamaño crece dinámicamente?</h2>
<p>Es muy sencillo, crearemos ficheros dentro de este y veremos cómo aumenta de tamaño dinámicamente hasta un total de 1G. Para ello seguiremos los siguiente pasos:</p>
<ol>
<li>
<p>Crearemos un sistema de ficheros en <em>file.img</em>, lo cual nos va a permitir alojar ficheros dentro de él convirtiéndolo en un volumen de almacenamiento:</p>
<pre><code>   $ mkfs.ext4 -q file.img  
   file.img no es un dispositivo especial de bloques.
   ¿Continuar de todas formas? (s,n) s
</code></pre>
</li>
<li>
<p>Montamos el fichero como si de un dispositivo de almacenamiento se<br>
tratase, utilizando el comando <em>mount</em>, de la siguiente forma:</p>
<pre><code>   $ mkdir mnt
   $ sudo mount -t auto file.img mnt
</code></pre>
</li>
</ol>
<p>Si listamos los puntos de montaje actuales en nuestro sistema, deberíamos ver el fichero <em>file.img</em> montado en el directorio local <em>mnt</em>:</p>
<pre><code>    $ mount |grep file.img
    /tmp/file.img on /tmp/mnt type ext4 (rw)
</code></pre>
<ol start="3">
<li>
<p>Creamos varios ficheros temporales dentro del punto de montaje:</p>
<pre><code>   $ for i in {1..10};do mktemp --tmpdir=mnt; done
</code></pre>
</li>
</ol>
<p><strong>Nota:</strong> aprovecho para enseñar el comando <em>mktemp</em> crea un fichero temporal del tipo <em>tmp.XXXXXXXX</em> en el directorio actual. Con la opción <em>--tmpdir</em> es posible indicar el directorio destino donde se creará el fichero temporal.</p>
<ol start="4">
<li>
<p>Comprobamos que el tamaño del fichero ha crecido con respecto al estado anterior:</p>
<pre><code>   $ du -h file.img 
   49M    file.img
</code></pre>
</li>
</ol>
<p>Y obviamente el tamaño total sigue siendo 1G:</p>
<pre><code>    $ du -h --apparent-size file.img 
    1,0G    file.img
</code></pre>
<h2 id="dndeestellmite">Dónde está el límite</h2>
<p>Lo único que nos falta comprobar es dónde está el limite. En el ejemplo<br>
utilizado es 1G, así que intentaremos crear un fichero de un tamaño mayor que el total del <em>sparse file</em>.</p>
<p>Teniendo montado el fichero en el directorio <em>mnt</em>, crearemos un fichero de 2G dentro de este, ejecutando lo siguiente:</p>
<pre><code>$ dd if=/dev/zero of=file bs=1M count=2048
dd: escribiendo «file»: No queda espacio en el dispositivo
924+0 registros leídos
923+0 registros escritos
968290304 bytes (968 MB) copiados, 4,71871 s, 205 MB/s
</code></pre>
<p>Como podemos observar, nos ha avisado de que no queda espacio libre en el<br>
dispositivo y si comprobamos el tamaño actual del fichero obtendremos lo<br>
siguiente:</p>
<pre><code>$ du -h file.img 
973M    file.img
</code></pre>
<p><strong>Nota:</strong> Hay un resto de espacio de 27M que es posible que sea debido a la<br>
reserva del 5% de espacio para el usuario root. Siempre hay una reserva de<br>
espacio para el usuario root, por defecto del 5%, de forma que este pueda<br>
acceder al dispositivo cuando haya alcanzado su límite de espacio. Si<br>
eliminamos dicha reserva, <strong>para nada recomendable en producción</strong> pero en este caso estamos probando en un fichero local, podremos comprobar que si volvemos a crear el fichero de 2G dentro del <em>sparse file</em>, el espacio llega a ocuparse completamente:</p>
<pre><code>$ tune2fs -m 0 file.img 
tune2fs 1.41.14 (22-Dec-2010)
Setting reserved blocks percentage to 0% (0 blocks)

$ dd if=/dev/zero of=file bs=1M count=2048
dd: escribiendo «file»: No queda espacio en el dispositivo
965+0 registros leídos
964+0 registros escritos
1011208192 bytes (1,0 GB) copiados, 3,27181 s, 309 MB/s

$ du -h file.img  
1,0G    file.img
</code></pre>
<h2 id="actualizacinysiqueremosaumentarellmite">Actualización: ¿Y si queremos aumentar el límite?</h2>
<p>Ayer se me debió pasar esta cuestión mientras me centraba en escribir, pero sí, es posible aumentar el tamaño del <em>sparse file</em>, ¿pero cómo?</p>
<p>Pues muy sencillo, solo tenemos que volver a utilizar el comando <em>dd</em> indicando un tamaño mayor en el parámetro <em>seek</em>, como indico a continuación:</p>
<pre><code>$ dd if=/dev/zero of=file.img bs=1M count=0 seek=2048
0+0 registros leídos
0+0 registros escritos
0 bytes (0 B) copiados, 1,6064e-05 s, 0,0 kB/s
</code></pre>
<p>Si comprobamos ahora el tamaño del fichero, podremos observar que su tamaño<br>
total a aumentado en 1G:</p>
<pre><code>$ du -h --apparent-size file.img 
2,0G    file.img
</code></pre>
<p>Pero aun no hemos terminado, sólo nos falta <strong>redimensionar</strong> el sistema de<br>
ficheros incluido en él, y esto lo haremos haciendo uso del comando <em>resize2fs</em>, pero primero realizaremos un chequeo del sistema de ficheros:</p>
<pre><code>e2fsck -f file.img 
e2fsck 1.41.14 (22-Dec-2010)
Paso 1: Verificando nodos-i, bloques y tamaños
Paso 2: Verificando la estructura de directorios
Paso 3: Revisando la conectividad de directorios
Paso 4: Revisando las cuentas de referencia
Paso 5: Revisando el resumen de información de grupos
file.img: 22/65536 ficheros (0.0% no contiguos), 259513/262144 bloques

$ resize2fs file.img 
resize2fs 1.41.14 (22-Dec-2010)
Resizing the filesystem on file.img to 524288 (4k) blocks.
El sistema de ficheros en file.img tiene ahora 524288 bloques.
</code></pre>
<p>Por último, si comprobamos el total de espacio disponible dentro del <em>sparse file</em> podremos observar que a aumentado a 2G:</p>
<pre><code>$ df -h mnt 
S.ficheros     Tamaño Usado  Disp Uso% Montado en
/dev/loop0       2,0G  998M  998M  51% /tmp/mnt
</code></pre>
<p>Espero que os haya parecido interesante! No dudéis en comentar!</p>
<p>Un saludo, Manu.</p>
<!--kg-card-end: markdown-->
  </div>
    <footer class="single-footer kg-width-normal">
      <div class="single-footer-left">
          <div class="navigation navigation-previous">
            <a class="navigation-link" href="/blog/nginx-como-proxy-http/">
              <svg class="icon navigation-icon"><use xlink:href="#arrow-left"></use></svg>
            </a>
          </div>
      </div>
      <div class="single-footer-middle">
        <div class="single-footer-top">
          <h3 class="single-footer-title">Published by:</h3>
          <div class="author-list">
              <div class="author-image-placeholder u-placeholder square">
                <a href="/author/mviera/" title="Manuel Viera">
                  <img class="author-image lazyload u-object-fit" data-src="/content/images/size/w150/2020/06/2020-06-22-161222_428x430_scrot.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Manuel Viera">
                </a>
              </div>
          </div>
        </div>
        <div class="single-footer-bottom">
          <div class="share">
            <a class="share-link share-link-facebook" href="https://www.facebook.com/sharer.php?u=https://manuelviera.com/blog/que-es-un-sparse-file/" target="_blank" rel="noopener noreferrer">
              <svg class="icon icon-facebook"><use xlink:href="#facebook"></use></svg>
              Share
            </a>
            <a class="share-link share-link-twitter" href="https://twitter.com/intent/tweet?url=https://manuelviera.com/blog/que-es-un-sparse-file/&text=Qu%C3%A9%20es%20un%20sparse%20file" target="_blank" rel="noopener noreferrer">
              <svg class="icon icon-twitter"><use xlink:href="#twitter"></use></svg>
              Tweet
            </a>
          </div>
        </div>
      </div>
      <div class="single-footer-right">
          <div class="navigation navigation-next">
            <a class="navigation-link" href="/blog/empezando-con-mongodb/">
              <svg class="icon navigation-icon"><use xlink:href="#arrow-right"></use></svg>
            </a>
          </div>
      </div>
    </footer>
</article>          <section class="related-wrapper kg-width-full">
      <div class="container">
        <div class="kg-width-normal">
          <h3 class="related-title">You might also like...</h3>
          <div class="related-feed">
              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Sep
    </div>
    <div class="feed-calendar-day">
      20
    </div>
  </div>
  <h2 class="feed-title">PostgreSQL and read-only users - the easiest way</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      1 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/postgresql-and-read-only-users-the-easiest-way/"></a>
</article>              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Sep
    </div>
    <div class="feed-calendar-day">
      13
    </div>
  </div>
  <h2 class="feed-title">PostgreSQL and how to shield your databases well</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      2 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/postgresql-and-how-to-shield-your-databases-well/"></a>
</article>              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Aug
    </div>
    <div class="feed-calendar-day">
      10
    </div>
  </div>
  <h2 class="feed-title">Find and the importance of parameters order</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      2 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/find-and-the-importance-of-parameters-order/"></a>
</article>              <article class="feed post">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Aug
    </div>
    <div class="feed-calendar-day">
      02
    </div>
  </div>
  <h2 class="feed-title">Compartiendo ficheros con GlusterFS</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      6 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/compartiendo-ficheros-con-glusterfs-2/"></a>
</article>              <article class="feed post no-image">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Nov
    </div>
    <div class="feed-calendar-day">
      12
    </div>
  </div>
  <h2 class="feed-title">AWS Summit Barcelona 2015</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      7 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/aws-summit-barcelona-2015/"></a>
</article>          </div>
        </div>
      </div>
    </section>
        <div class="comment kg-width-narrow">
  <div id="disqus_thread">
    <button class="button button-secondary" onclick="loadDisqus();">Load comments</button>
  </div>
</div>

<script>
  // DON'T EDIT BELOW THIS LINE
  if (themeOptions.disqus_shortname == '') {
    document.querySelector('.comment').remove();
  }
  
  var disqus_config = function () {
    this.page.url = 'https://manuelviera.com/blog/que-es-un-sparse-file/';
    this.page.identifier = 'ghost-5ee61b9846e19912dcb415b5';
  };

  function loadDisqus() {
    var d = document, s = d.createElement('script');
    s.src = 'https://' + themeOptions.disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  };
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>  </main>
</div>
      </div>
      <footer class="site-footer">
  <div class="social">
      <a class="social-item social-item-twitter" href="https://twitter.com/mviera" target="_blank" rel="noopener noreferrer">
        <svg class="icon"><use xlink:href="#twitter-box"></use></svg>
      </a>
    <a class="social-item social-item-rss" href="https://feedly.com/i/subscription/feed/https://manuelviera.com/rss.xml" target="_blank" rel="noopener noreferrer">
      <svg class="icon"><use xlink:href="#rss-box"></use></svg>
    </a>
  </div>

  <div class="copyright">
  Powered by <a href="https://ghost.org/" target="_blank">Ghost</a>
</div>
  <nav class="footer-nav">
    
    <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme">
      <svg class="icon theme-icon theme-icon-system"><use xlink:href="#circle-half-full"></use></svg>
      <svg class="icon theme-icon theme-icon-dark"><use xlink:href="#brightness-2"></use></svg>
      <svg class="icon theme-icon theme-icon-light"><use xlink:href="#white-balance-sunny"></use></svg>
      <span class="theme-text">System theme</span>
    </a>
  </nav>
</footer>      <div class="modal-overlay">
  <div class="modal modal-search">
    <div class="form-wrapper">
      <input class="modal-input search-input" type="search" placeholder="Enter keyword...">
      <button class="form-button search-button">
        <svg class="icon icon-search"><use xlink:href="#magnify"></use></svg>
        <svg class="icon icon-close"><use xlink:href="#window-close"></use></svg>
      </button>
    </div>
        <div class="popular-wrapper">
          <h4 class="popular-title">Popular tags</h4>
          <div class="popular-feed">
              <a class="popular" href="/tag/tech/">tech</a>
              <a class="popular" href="/tag/self-tracking/">self-tracking</a>
              <a class="popular" href="/tag/offtopic/">offtopic</a>
          </div>
        </div>
    <div class="search-result"></div>
  </div>
  <button class="button-icon modal-close">
    <svg class="icon icon-close"><use xlink:href="#window-close"></use></svg>
  </button>
</div>      <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
      <!-- Container that holds slides. 
          PhotoSwipe keeps only 3 of them in the DOM to save memory.
          Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter"></div>

        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--share" title="Share"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

        <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div> 
      </div>

      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>    </div>
  </div>

  <script>
    var body = document.querySelector('body');
    if (window.innerWidth > body.clientWidth + 5) {
      document.documentElement.style.setProperty('--scrollbar', (window.innerWidth - body.clientWidth) + 'px');
    }
  </script>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
  </script>
  <script src="/assets/js/main.min.js?v=67116d8245"></script>


  
</body>
</html>
