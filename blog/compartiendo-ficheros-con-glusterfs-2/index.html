<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Compartiendo ficheros con GlusterFS</title>
  <link rel="stylesheet" href="/assets/css/screen.css?v=67116d8245">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Muli:400,400i,700,700i,800">

  <script>
    var siteUrl = 'https://manuelviera.com';
  </script>
  <script>
  var themeOptions = {
    disqus_shortname: '',
    search_key: '',
    search_migration: 'v1',
    white_logo: '',
    white_icon: '',
  };
</script>
  <script>
    var localTheme = localStorage.getItem('dawn_theme');
    switch (localTheme) {
      case 'dark':
        document.documentElement.classList.add('theme-dark');
        break;
      case 'light':
        document.documentElement.classList.add('theme-light');
        break;
      default:
        break;
    }
  </script>

  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />
    <link rel="canonical" href="https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/amp/" />
    
    <meta property="og:site_name" content="Manuel Viera" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Compartiendo ficheros con GlusterFS" />
    <meta property="og:description" content="Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro servicio, en Internet; también aparecen nuevos problemas a resolver que antes incluso ni habíamos reparado en ellos. Uno de estos problemas es la compartición de ficheros entre servidores.  En mi opinión, a día de hoy éste sigue siendo" />
    <meta property="og:url" content="https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/" />
    <meta property="og:image" content="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ" />
    <meta property="article:published_time" content="2016-08-02T00:00:00.000Z" />
    <meta property="article:modified_time" content="2020-09-13T17:14:58.000Z" />
    <meta property="article:tag" content="tech" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Compartiendo ficheros con GlusterFS" />
    <meta name="twitter:description" content="Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro servicio, en Internet; también aparecen nuevos problemas a resolver que antes incluso ni habíamos reparado en ellos. Uno de estos problemas es la compartición de ficheros entre servidores.  En mi opinión, a día de hoy éste sigue siendo" />
    <meta name="twitter:url" content="https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/" />
    <meta name="twitter:image" content="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Manuel Viera" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="tech" />
    <meta name="twitter:site" content="@mviera" />
    <meta name="twitter:creator" content="@mviera" />
    <meta property="og:image:width" content="2000" />
    <meta property="og:image:height" content="1331" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Manuel Viera",
        "url": "https://manuelviera.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://manuelviera.com/favicon.ico",
            "width": 48,
            "height": 48
        }
    },
    "author": {
        "@type": "Person",
        "name": "Manuel Viera",
        "image": {
            "@type": "ImageObject",
            "url": "https://manuelviera.com/content/images/2020/06/2020-06-22-161222_428x430_scrot.png",
            "width": 428,
            "height": 430
        },
        "url": "https://manuelviera.com/author/mviera/",
        "sameAs": [
            "https://manuelviera.com",
            "https://twitter.com/mviera"
        ]
    },
    "headline": "Compartiendo ficheros con GlusterFS",
    "url": "https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/",
    "datePublished": "2016-08-02T00:00:00.000Z",
    "dateModified": "2020-09-13T17:14:58.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib=rb-1.2.1&q=80&fm=jpg&crop=entropy&cs=tinysrgb&w=2000&fit=max&ixid=eyJhcHBfaWQiOjExNzczfQ",
        "width": 2000,
        "height": 1331
    },
    "keywords": "tech",
    "description": "Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro\nservicio, en Internet; también aparecen nuevos problemas a resolver que antes\nincluso ni habíamos reparado en ellos. Uno de estos problemas es la compartición\nde ficheros entre servidores.\n\nEn mi opinión, a día de hoy éste sigue siendo un dolor de cabeza para muchos\nSysadmins o Systems Architects. Hay muchas formas de compartir ficheros entre\nservidores como NFS, S3FS, FileConveyor, un crontab con un rsync entre\nservidor",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://manuelviera.com/"
    }
}
    </script>

    <meta name="generator" content="Ghost 3.19" />
    <link rel="alternate" type="application/rss+xml" title="Manuel Viera" href="https://manuelviera.com/blog/rss/" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,400;0,700;0,900;1,400;1,700&display=swap">
</head>
<body class="post-template tag-tech">
  <svg width="0" height="0" style="display: none;">
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="arrow-left">
    <title>arrow-left</title>
    <path d="M26.667 14.667v2.667h-16L18 24.667l-1.893 1.893L5.547 16l10.56-10.56L18 7.333l-7.333 7.333h16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="arrow-right">
    <title>arrow-right</title>
    <path d="M5.333 14.667v2.667h16L14 24.667l1.893 1.893L26.453 16 15.893 5.44 14 7.333l7.333 7.333h-16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="brightness-2">
    <title>brightness-2</title>
    <path d="M13.333 2.667c-2.427 0-4.707.667-6.667 1.8 4 2.307 6.667 6.6 6.667 11.533s-2.667 9.227-6.667 11.533c1.96 1.133 4.24 1.8 6.667 1.8 7.36 0 13.333-5.973 13.333-13.333S20.693 2.667 13.333 2.667z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="chevron-left">
    <title>chevron-left</title>
    <path d="M20.547 22.107L14.44 16l6.107-6.12L18.667 8l-8 8 8 8 1.88-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="chevron-right">
    <title>chevron-right</title>
    <path d="M11.453 22.107L17.56 16l-6.107-6.12L13.333 8l8 8-8 8-1.88-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="circle-half-full">
    <title>circle-half-full</title>
    <path d="M16 2.667c-7.36 0-13.333 5.973-13.333 13.333s5.973 13.333 13.333 13.333c7.36 0 13.333-5.973 13.333-13.333s-5.973-13.333-13.333-13.333zM16 5.333c5.893 0 10.667 4.773 10.667 10.667s-4.773 10.667-10.667 10.667v-21.333z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="dots-horizontal">
    <title>dots-horizontal</title>
    <path d="M21.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM13.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0zM5.333 16c0-1.473 1.194-2.667 2.667-2.667v0c1.473 0 2.667 1.194 2.667 2.667v0c0 1.473-1.194 2.667-2.667 2.667v0c-1.473 0-2.667-1.194-2.667-2.667v0z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="facebook-box">
    <title>facebook-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zM24 6.667h-3.333A4.672 4.672 0 0 0 16 11.334v3.333h-2.667v4H16V28h4v-9.333h4v-4h-4V12c0-.733.6-1.333 1.333-1.333H24v-4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="facebook">
    <title>facebook</title>
    <path d="M22.667 2.667V8H20c-.92 0-1.333 1.08-1.333 2v3.333h4v5.333h-4v10.667h-5.333V18.666h-4v-5.333h4V8a5.332 5.332 0 0 1 5.333-5.333h4z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" id="loader">
    <title>loader</title>
    <path opacity="0.3" fill="currentColor" d="M20.201,5.169c-8.254,0-14.946,6.692-14.946,14.946c0,8.255,6.692,14.946,14.946,14.946 s14.946-6.691,14.946-14.946C35.146,11.861,28.455,5.169,20.201,5.169z M20.201,31.749c-6.425,0-11.634-5.208-11.634-11.634 c0-6.425,5.209-11.634,11.634-11.634c6.425,0,11.633,5.209,11.633,11.634C31.834,26.541,26.626,31.749,20.201,31.749z" />
    <path fill="currentColor" d="M26.013,10.047l1.654-2.866c-2.198-1.272-4.743-2.012-7.466-2.012h0v3.312h0 C22.32,8.481,24.301,9.057,26.013,10.047z">
      <animateTransform attributeType="xml" attributeName="transform" type="rotate" from="0 20 20" to="360 20 20" dur="0.5s" repeatCount="indefinite" />
    </path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="magnify">
    <title>magnify</title>
    <path d="M12.667 4a8.667 8.667 0 0 1 8.667 8.667c0 2.147-.787 4.12-2.08 5.64l.36.36h1.053l6.667 6.667-2 2-6.667-6.667v-1.053l-.36-.36a8.689 8.689 0 0 1-5.64 2.08C7.88 21.334 4 17.454 4 12.667S7.88 4 12.667 4zm0 2.667c-3.333 0-6 2.667-6 6s2.667 6 6 6 6-2.667 6-6-2.667-6-6-6z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="menu-down">
    <title>menu-down</title>
    <path d="M9.333 13.333L16 20l6.667-6.667H9.334z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="rss-box">
    <title>rss-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zM10 20c-1.107 0-2 .893-2 2s.893 2 2 2 2-.893 2-2-.893-2-2-2zm-2-6.667V16c4.413 0 8 3.587 8 8h2.667c0-5.893-4.773-10.667-10.667-10.667zM8 8v2.667c7.36 0 13.333 5.973 13.333 13.333H24c0-8.84-7.16-16-16-16z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="star">
    <title>star</title>
    <path d="M16 23.027L24.24 28l-2.187-9.373 7.28-6.307-9.587-.827-3.747-8.827-3.747 8.827-9.587.827 7.267 6.307L7.759 28l8.24-4.973z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="table-of-contents">
    <path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="twitter-box">
    <title>twitter-box</title>
    <path d="M6.667 4h18.667c1.467 0 2.667 1.2 2.667 2.667v18.667c0 1.467-1.2 2.667-2.667 2.667H6.667A2.675 2.675 0 0 1 4 25.334V6.667C4 5.2 5.2 4 6.667 4zm16.946 8.44c.64-.533 1.387-1.173 1.72-1.88-.547.28-1.2.453-1.92.547.667-.48 1.213-1.107 1.493-1.96-.693.373-1.4.693-2.28.853-2.067-2.493-7.013-.467-6.133 3.267-3.48-.213-5.6-1.787-7.36-3.72-1 1.627-.133 4.093 1.053 4.773-.613-.04-1.08-.227-1.52-.44.053 2.053 1.187 3.04 2.773 3.573a4.47 4.47 0 0 1-1.52.04c.493 1.427 1.52 2.32 3.28 2.507-1.2 1.013-3.413 1.72-5.2 1.44 1.533.973 3.28 1.747 5.707 1.64 5.88-.267 9.813-4.48 9.907-10.64z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="twitter">
    <title>twitter</title>
    <path d="M29.947 8a11.423 11.423 0 0 1-3.28.92 5.738 5.738 0 0 0 2.507-3.173 11.52 11.52 0 0 1-3.627 1.4C24.494 6 23.014 5.334 21.334 5.334c-3.133 0-5.693 2.56-5.693 5.72 0 .453.053.893.147 1.307A16.261 16.261 0 0 1 4.001 6.388a5.663 5.663 0 0 0-.773 2.867c0 1.987 1 3.747 2.547 4.747-.947 0-1.827-.267-2.6-.667v.04a5.724 5.724 0 0 0 4.587 5.613 5.644 5.644 0 0 1-2.574.093c.72 2.253 2.813 3.933 5.333 3.973-1.947 1.547-4.413 2.453-7.107 2.453-.453 0-.907-.027-1.36-.08A16.19 16.19 0 0 0 10.827 28c10.507 0 16.28-8.72 16.28-16.28 0-.253 0-.493-.013-.747A11.42 11.42 0 0 0 29.947 8z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="white-balance-sunny">
    <title>white-balance-sunny</title>
    <path d="M4.733 24.72l1.88 1.88 2.4-2.387L7.12 22.32zm9.934 5.213h2.667V26h-2.667zM16 7.333c-4.413 0-8 3.587-8 8s3.587 8 8 8 8-3.587 8-8c0-4.427-3.587-8-8-8zm10.667 9.334h4V14h-4zm-3.68 7.546l2.4 2.387 1.88-1.88-2.387-2.4zm4.28-18.266l-1.88-1.88-2.4 2.387 1.893 1.893zM17.333.733h-2.667v3.933h2.667zM5.333 14h-4v2.667h4zm3.68-7.547l-2.4-2.387-1.88 1.88 2.387 2.4 1.893-1.893z"></path>
  </symbol>
  <symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="window-close">
    <title>window-close</title>
    <path d="M17.947 16l7.387 7.387v1.947h-1.947L16 17.947l-7.387 7.387H6.666v-1.947L14.053 16 6.666 8.613V6.666h1.947L16 14.053l7.387-7.387h1.947v1.947L17.947 16z"></path>
  </symbol>
</svg>  <div class="container">
    <div class="site">
      <header class="site-header">
  <div class="header-left">
    <a class="logo" href="https://manuelviera.com">
        <span class="logo-text">Manuel Viera</span>
    </a>
  </div>
    <nav class="main-nav hidden-xs hidden-sm hidden-md">
        <a class="menu-item menu-item-about" href="https://manuelviera.com/about/">about</a>
  <a class="menu-item menu-item-tech" href="https://manuelviera.com/tag/tech/">tech</a>
  <a class="menu-item menu-item-self-tracking" href="https://manuelviera.com/tag/self-tracking/">self-tracking</a>
  <a class="menu-item menu-item-author" href="https://manuelviera.com/author/mviera/">author</a>

    </nav>
    
    <button class="button-icon hidden-lg hidden-xl js-modal" data-modal="search">
      <svg class="icon"><use xlink:href="#magnify"></use></svg>
    </button>
    <div class="burger hidden-lg hidden-xl">
      <div class="burger-bar"></div>
      <div class="burger-bar"></div>
    </div>

    <div class="mobile-menu hidden-lg hidden-xl">
      <div class="container">
        <nav class="mobile-nav">
            <a class="menu-item menu-item-about" href="https://manuelviera.com/about/">about</a>
  <a class="menu-item menu-item-tech" href="https://manuelviera.com/tag/tech/">tech</a>
  <a class="menu-item menu-item-self-tracking" href="https://manuelviera.com/tag/self-tracking/">self-tracking</a>
  <a class="menu-item menu-item-author" href="https://manuelviera.com/author/mviera/">author</a>

        </nav>
      </div>
    </div>
  <div class="header-right hidden-xs hidden-sm hidden-md">
      <button class="button-icon js-modal" data-modal="search">
        <svg class="icon"><use xlink:href="#magnify"></use></svg>
      </button>
  </div>
</header>

    <header class="sticky kg-width-full">
      <div class="sticky-title">Compartiendo ficheros con GlusterFS</div>
      <button class="button-icon sticky-toc-button">
        <svg class="icon"><use xlink:href="#table-of-contents"></use></svg>
        <div class="sticky-toc"></div>
      </button>
      <div class="sticky-track">
        <div class="sticky-progress"></div>
      </div>
    </header>
      <div class="site-content">
        
<div class="content-area">
  <main class="site-main">
      <article class="single post tag-tech kg-width-narrow">
  <header class="single-header">
      <div class="single-meta">
        <span class="single-meta-item single-meta-date">
          <time datetime="2016-08-02">
            Aug 02, 2016
          </time>
        </span>
        <span class="single-meta-item single-meta-length">
          6 min read
        </span>
          <span class="single-meta-item single-meta-tag">
            <a class="post-tag post-tag-tech" href="/tag/tech/">
              #tech
            </a>
          </span>
      </div>
    <h1 class="single-title">Compartiendo ficheros con GlusterFS</h1>
  </header>
      <div class="single-media kg-width-wide u-placeholder horizontal">
        <img class="lazyload u-object-fit"
          data-srcset="https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ 400w,
https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ 750w,
https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ 960w,
https://images.unsplash.com/photo-1569235186275-626cb53b83ce?ixlib&#x3D;rb-1.2.1&amp;q&#x3D;80&amp;fm&#x3D;jpg&amp;crop&#x3D;entropy&amp;cs&#x3D;tinysrgb&amp;w&#x3D;2000&amp;fit&#x3D;max&amp;ixid&#x3D;eyJhcHBfaWQiOjExNzczfQ 1140w"
          data-sizes="auto"
          src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
          alt="Compartiendo ficheros con GlusterFS"
        >
      </div>
  <div class="single-content u-text-format">
      <!--kg-card-begin: markdown--><p>Cuando aparece la necesidad de escalar una aplicación web, o cualquier otro servicio, en Internet; también aparecen nuevos problemas a resolver que antes incluso ni habíamos reparado en ellos. Uno de estos problemas es <strong>la compartición de ficheros</strong> entre servidores.</p>
<p>En mi opinión, a día de hoy éste sigue siendo un dolor de cabeza para muchos Sysadmins o Systems Architects. Hay muchas formas de compartir ficheros entre servidores como NFS, S3FS, FileConveyor, un crontab con un rsync entre servidores. Hay muchas soluciones, algunas mejores y otras peores; pero hoy quería compartir la que hasta ahora creo que puede ser una buena solución para compartir ficheros, usando <strong>GlusterFS</strong>.</p>
<p><a href="https://www.glusterfs.org">GlusterFS</a> es un sistema de ficheros escalable en red, con el que poder crear soluciones de almacenamiento distribuidos por la red y de gran capacidad. Ni que decir tiene que <strong>GlusterFS</strong> es software libre.</p>
<h2 id="antesdeempezar">Antes de empezar</h2>
<p>Normalmente en los despliegues que hacemos en AWS en <a href="http://crononauta.com">Crononauta</a>, siempre utilizamos un mínimo de un par de instancias EC2 para el sistema de almacenamiento en red con <strong>GlusterFS</strong>. Además, a cada una de estas dos instancias EC2, hacemos <em>attach</em> de un disco EBS donde almacenaremos los ficheros en el clúster de ficheros en red. Esto nos permite tener <strong>redundancia</strong> en los datos, <strong>alta disponibilidad</strong> y <strong>escalabilidad horizontal</strong> en el servicio. Con lo cual, tendremos un par de instancias que mantienen en clúster de almacenamiento actuando como GlusterFS Server y por otro lado, tendremos los clientes de GlusterFS que montarán este volumen compartido por la red.</p>
<p>Como detalle, en <strong>Crononauta</strong> siempre usamos Debian como distribución, en este caso contamos con una Debian 8 (Jessie), aunque es totalmente aplicable a cualquier distribución basada en Debian como Ubuntu y/o derivadas.</p>
<p>Una vez tenemos esto, podemos empezar a trabajar... ;-)</p>
<h2 id="particionandolosdiscos">Particionando los discos</h2>
<p>Utilizaremos <strong>XFS</strong> como sistema de ficheros para el volumen compartido en red. Por lo que necesitaremos instalar las utilidades para trabajar con XFS, si no las tenemos ya instaladas.</p>
<pre><code>apt-get install xfsprogs
</code></pre>
<p>El siguiente paso será crear una partición en el volumen, en mi caso es <code>/dev/xvdf</code>. Usaremos <code>fdisk</code> para ello:</p>
<pre><code>fdisk /dev/xvdf
</code></pre>
<p>y una vez en la shell interactiva de <code>fdisk</code>, teclearemos:</p>
<ol>
<li><code>n</code> para crear una nueva partición. No necesitamos especificar nada más, así que los siguientes datos que pide podemos usar los valores por defecto que ofrece <code>fdisk</code>, asi que pulsaremos <code>Intro</code> hasta finalizar. Una vez hecho esto, seguiremos dentro de la shell interactiva de <code>fdisk</code>, y habremos creado una partición primaria que ocupa todo el espacio del volumen.</li>
<li><code>w</code> indicando que queremos escribir esta definición de partición en el disco y hacerla efectiva.</li>
</ol>
<p>Ya tenemos la partición en el volumen, así que ahora la formatearemos y la añadiremos a nuestro <code>/etc/fstab</code> para montarla en cada arranque del sistema. Seguiremos los siguientes pasos:</p>
<pre><code>mkfs.xfs -i size=512 /dev/xvdf1
mkdir -p /export/brick1
echo &quot;/dev/xvdf1 /export/brick1 xfs defaults 1 2&quot;  &gt;&gt; /etc/fstab
mount -a &amp;&amp; mount
</code></pre>
<h2 id="instalandoglusterfs">Instalando GlusterFS</h2>
<p>Ya tenemos el volumen preparado para GlusterFS, ahora instalaremos el servicio.</p>
<pre><code>apt-get update
apt-get install glusterfs-server glusterfs-client glusterfs-common
</code></pre>
<p>Importante realizar este paso en aquellas instancias / servidores que vayan a actuar como un GlusterFS Server.</p>
<p>Lo siguiente que haremos será configurar nuestro fichero <code>/etc/hosts</code> para definir unos nombres DNS para nuestros GlusterFS Servers. También es posible hacerlo con un DNS interno. Si vuestros servidores, como en el caso de AWS EC2, contáis con IPs privadas, mejor usar esas. Si no, podéis usar las IPs pública.</p>
<p>Definiremos algo como lo siguiente en <code>/etc/hosts</code>:</p>
<pre><code>xxx.xxx.xxx.xxx    gfs01.example.com
xxx.xxx.xxx.xxx    gfs02.example.com
</code></pre>
<h2 id="unanilloparagobernarlosatodos">Un anillo para gobernarlos a todos</h2>
<p>Ya tenemos GlusterFS preparado para ser configurado. Ahora tendremos que configurar el <em>anillo de confianza</em> entre ambos servidores GlusterFS Server. Para ello serán necesarios los siguientes pasos:</p>
<ol>
<li>
<p>Desde <code>gfs01.example.com</code>:</p>
<pre><code> gluster peer probe gfs02.example.com
</code></pre>
</li>
<li>
<p>Desde <code>gfs02.example.com</code>:</p>
<pre><code> gluster peer probe gfs01.example.com
</code></pre>
</li>
</ol>
<p>Es <strong>muy importante</strong> que haya conectividad entre ambos servidores, en caso contrario, los comandos anteriores fallarán. Si estás en AWS, asegúrate de tener bien configurado el <strong>Security Group</strong> para ambas instancias de storage.</p>
<p>Si todo ha ido bien, tendremos el pool de confianza funcionando, así que lo siguiente será definir el volumen compartido. Usaremos la siguiente instrucción desde uno de los servidores GlusterFS:</p>
<pre><code>gluster volume create gv0 replica 2 gfs01.example.com:/export/brick1/&lt;volume-name&gt; gfs02.example.com:/export/brick1/&lt;volumen-name»
</code></pre>
<p>Por último, iniciaremos el volumen que justo acabamos de crear:</p>
<pre><code>gluster volume start gv0
</code></pre>
<p>Como detalle, podemos ver información sobre el volumen con la siguiente instrucción:</p>
<pre><code>gluster volume info
</code></pre>
<p>Llegados a este punto, el cluster de almacenamiento debe estar totalmente operativo. Si queremos hacer una prueba, es posible crear el punto de montaje hacia el volumen compartido y probar si se replican correctamente los ficheros. Crearemos el punto de montaje en <code>gfs01.example.com</code> de la siguiente forma:</p>
<pre><code>mount -t glusterfs localhost:/gv0 /mnt
</code></pre>
<p>Ahora crearemos ficheros para comprobar si el funcionamiento de GlusterFS es correcto. Con la siguiente instrucción crearemos diez ficheros vacíos en el punto de montaje previamente creado:</p>
<pre><code>touch /mnt/test-file{1..10}.txt
</code></pre>
<p>Si GlusterFS funciona correctamente, debemos poder ver estos mismos ficheros en <code>gfs02.example.com</code> en el directorio <code>/export/brick1/&lt;volume-name&gt;</code>.</p>
<h2 id="configurandolosclientes">Configurando los clientes</h2>
<p>Nos falta muy poco para terminar, ya sólo nos falta configurar los clientes de GlusterFS. Necesitaremos tener instalado el cliente de GlusterFS <code>glusterfs-client</code> si no lo tenemos instalado.</p>
<pre><code>apt-get install glusterfs-client
</code></pre>
<p>Hecho esto, podremos probar a montar el volumen compartido por la red, y si todo va bien debemos ver los ficheros de prueba creados previamente.</p>
<pre><code>mount -t glusterfs gfs01.example.com:/gv0 /mnt
</code></pre>
<p>Por último, necesitaremos un script <code>/etc/init.d/glusterfs-mount</code> que se encargue de montar el volumen compartido. En mi caso suelo utilizar el siguiente script:</p>
<pre><code>#! /bin/bash
### BEGIN INIT INFO
# Provides:          glusterfs-mount
# Required-Start:    $remote_fs $syslog
# Required-Stop:     $remote_fs $syslog
# Default-Start:     2 3 4 5 
# Default-Stop:      0 1 6 
# Short-Description: Start daemon at boot time
# Description:       Enable service provided by daemon.
### END INIT INFO
#

MOUNTPOINT=&quot;/var/www/shared&quot;
GLUSTERFS_SERVER=&quot;gfs01.example.com&quot;
GLUSTERFS_VOLUME=&quot;gv0&quot;

# Some things that run always at boot
mount -t glusterfs $GLUSTERFS_SERVER:/$GLUSTERFS_VOLUME $MOUNTPOINT
#
# Uncomment this line if you need to start Apache after mount glusterFS volume
# service apache2 start
#
# Carry out specific functions when asked to by the system
case &quot;$1&quot; in
  start)
    echo &quot;Mounting glusterfs volumes &quot;
    mount -t glusterfs $GLUSTERFS_SERVER:/$GLUSTERFS_VOLUME $MOUNTPOINT
    ;;
  stop)
    echo &quot;Unmount glusterfs volumes&quot;
    umount $MOUNTPOINT
    ;;
  *)
    echo &quot;Usage: /etc/init.d/glusterfs-mount {start|stop}&quot;
    exit 1
    ;;
esac
exit 0
</code></pre>
<p>Ya solo nos queda dar permisos de ejecución a nuestro script y configurarlo para que se ejecute durante el inicio del sistema:</p>
<pre><code>chmod +x /etc/init.d/glusterfs-mount
update-rc.d glusterfs-mount defaults
</code></pre>
<h3 id="faq">FAQ</h3>
<ul>
<li><strong>Q:</strong> No puedo crear el anillo de confianza. Los comandos <code>gluster peer probe</code> terminan fallando con un timeout ¿Qué ocurre?</li>
</ul>
<ul>
<li><strong>A:</strong> Es muy probable que sea un problema de conectividad entre ambos GlusterFS Servers. Revisa si hay algún firewall entre ellos que pueda estar bloqueando conexiones TCP y UDP<br>
entre ellos. Puedes ver los puertos abiertos con <code>netstat -ntlp</code>.</li>
</ul>
<p>Si estás en AWS, asegúrate que el <strong>Security Group</strong> que usan ambas instancias tienen permitidos los accesos a puerto TCP y UDP entre ellos.</p>
<ul>
<li><strong>Q:</strong> No puedo montar el volumen compartido desde las instancias que actuan como clientes. El comando <code>mount</code> responde con <code>mount failed</code>. ¿Qué puede estar ocurriendo?</li>
</ul>
<ul>
<li><strong>A:</strong> Al igual que con los servidores GlusterFS, revisa que las instancias clientes tienen conectividad con los servidores. GlusterFS suele abrir un rango de puertos para cada volumen exportado (gv0, gv1, gv2, etc). Es recomendable permitir todo el tráfico TCP y UDP entre las instancias clientes y servidor. De otra forma es probable que alguna vez tengamos problemas al montar los volumenes.</li>
</ul>
<ul>
<li><strong>Q:</strong> Sigo sin poder crear el punto de montaje desde las instancias clientes. El comando <code>mount</code> indica que hubo un problema. La conectividad entre cliente y servidor de GlusterFS es correcta ¿Qué problema puede haber?</li>
</ul>
<ul>
<li><strong>A:</strong> Es muy común que las versiones de las distribuciones entre cliente y servidor difieran. Si esto es así, es muy probable que la versión de <code>glusterfs-client</code> difiera de la versión de <code>glusterfs-server</code>. En este caso, es muy probable que no podamos montar el volumen compartido con el driver <code>glusterfs</code>.</li>
</ul>
<p>GlusterFS permite montar los volumenes con el driver de NFS. En este tipo de situaciones es normal recurrir al driver de NFS para crear el punto de montaje. Para ello se necesita tener instalado <code>nfs-common</code> y crear el punto de montaje con la siguiente instrucción:</p>
<pre><code>mount -t nfs gfs01.example.com:/gv0 /var/www/shared
</code></pre>
<ul>
<li><strong>Q:</strong> ¿Por qué crear un script en <code>/etc/init.d</code> pudiendo configurar el montaje en el fichero <code>/etc/fstab</code>?</li>
</ul>
<ul>
<li><strong>A:</strong> Sí, es posible configurar el punto de montaje en <code>/etc/fstab</code>, pero a diferencia del resto de punto de montajes, en este caso se trata de un volumen compartido por la red. Es muy probable que cuando se monten los volumenes de <code>/etc/fstab</code>, aún no esté disponible la red en el sistema, con lo cual el montaje no solo fallará, sino que además es posible que ralentize el arranque del sistema hasta que el intento de montar el volumen por la red de un Timeout. Por eso es más fiable hacerlo con un script en <code>init.d</code>, una vez la red ya esté disponible.</li>
</ul>
<p>Creo que esto es todo. ¿Encontráis algún otro problema? ¡Dejadlo en los comentarios!<br>
Saludos.</p>
<!--kg-card-end: markdown-->
  </div>
    <footer class="single-footer kg-width-normal">
      <div class="single-footer-left">
          <div class="navigation navigation-previous">
            <a class="navigation-link" href="/blog/aws-summit-barcelona-2015/">
              <svg class="icon navigation-icon"><use xlink:href="#arrow-left"></use></svg>
            </a>
          </div>
      </div>
      <div class="single-footer-middle">
        <div class="single-footer-top">
          <h3 class="single-footer-title">Published by:</h3>
          <div class="author-list">
              <div class="author-image-placeholder u-placeholder square">
                <a href="/author/mviera/" title="Manuel Viera">
                  <img class="author-image lazyload u-object-fit" data-src="/content/images/size/w150/2020/06/2020-06-22-161222_428x430_scrot.png" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="Manuel Viera">
                </a>
              </div>
          </div>
        </div>
        <div class="single-footer-bottom">
          <div class="share">
            <a class="share-link share-link-facebook" href="https://www.facebook.com/sharer.php?u=https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/" target="_blank" rel="noopener noreferrer">
              <svg class="icon icon-facebook"><use xlink:href="#facebook"></use></svg>
              Share
            </a>
            <a class="share-link share-link-twitter" href="https://twitter.com/intent/tweet?url=https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/&text=Compartiendo%20ficheros%20con%20GlusterFS" target="_blank" rel="noopener noreferrer">
              <svg class="icon icon-twitter"><use xlink:href="#twitter"></use></svg>
              Tweet
            </a>
          </div>
        </div>
      </div>
      <div class="single-footer-right">
          <div class="navigation navigation-next">
            <a class="navigation-link" href="/blog/list-of-goals-for-2020/">
              <svg class="icon navigation-icon"><use xlink:href="#arrow-right"></use></svg>
            </a>
          </div>
      </div>
    </footer>
</article>          <section class="related-wrapper kg-width-full">
      <div class="container">
        <div class="kg-width-normal">
          <h3 class="related-title">You might also like...</h3>
          <div class="related-feed">
              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Sep
    </div>
    <div class="feed-calendar-day">
      20
    </div>
  </div>
  <h2 class="feed-title">PostgreSQL and read-only users - the easiest way</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      1 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/postgresql-and-read-only-users-the-easiest-way/"></a>
</article>              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Sep
    </div>
    <div class="feed-calendar-day">
      13
    </div>
  </div>
  <h2 class="feed-title">PostgreSQL and how to shield your databases well</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      2 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/postgresql-and-how-to-shield-your-databases-well/"></a>
</article>              <article class="feed post featured">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Aug
    </div>
    <div class="feed-calendar-day">
      10
    </div>
  </div>
  <h2 class="feed-title">Find and the importance of parameters order</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      2 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/find-and-the-importance-of-parameters-order/"></a>
</article>              <article class="feed post no-image">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Nov
    </div>
    <div class="feed-calendar-day">
      12
    </div>
  </div>
  <h2 class="feed-title">AWS Summit Barcelona 2015</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      7 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/aws-summit-barcelona-2015/"></a>
</article>              <article class="feed post no-image">
  <div class="feed-calendar">
    <div class="feed-calendar-month">
      Apr
    </div>
    <div class="feed-calendar-day">
      29
    </div>
  </div>
  <h2 class="feed-title">Instalar Solr en Jetty</h2>
  <div class="feed-right">
    <svg class="icon feed-visibility feed-visibility-public"><use xlink:href="#star"></use></svg>
    <div class="feed-length">
      4 min read
    </div>
  </div>
  <svg class="icon feed-icon"><use xlink:href="#chevron-right"></use></svg>
  <a class="u-permalink" href="/blog/instalar-solr-en-jetty/"></a>
</article>          </div>
        </div>
      </div>
    </section>
        <div class="comment kg-width-narrow">
  <div id="disqus_thread">
    <button class="button button-secondary" onclick="loadDisqus();">Load comments</button>
  </div>
</div>

<script>
  // DON'T EDIT BELOW THIS LINE
  if (themeOptions.disqus_shortname == '') {
    document.querySelector('.comment').remove();
  }
  
  var disqus_config = function () {
    this.page.url = 'https://manuelviera.com/blog/compartiendo-ficheros-con-glusterfs-2/';
    this.page.identifier = 'ghost-5ee79a5311a5bb564c241b61';
  };

  function loadDisqus() {
    var d = document, s = d.createElement('script');
    s.src = 'https://' + themeOptions.disqus_shortname + '.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  };
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>  </main>
</div>
      </div>
      <footer class="site-footer">
  <div class="social">
      <a class="social-item social-item-twitter" href="https://twitter.com/mviera" target="_blank" rel="noopener noreferrer">
        <svg class="icon"><use xlink:href="#twitter-box"></use></svg>
      </a>
    <a class="social-item social-item-rss" href="https://feedly.com/i/subscription/feed/https://manuelviera.com/rss.xml" target="_blank" rel="noopener noreferrer">
      <svg class="icon"><use xlink:href="#rss-box"></use></svg>
    </a>
  </div>

  <div class="copyright">
  Powered by <a href="https://ghost.org/" target="_blank">Ghost</a>
</div>
  <nav class="footer-nav">
    
    <a class="menu-item js-theme" href="#" data-system="System theme" data-dark="Dark theme" data-light="Light theme">
      <svg class="icon theme-icon theme-icon-system"><use xlink:href="#circle-half-full"></use></svg>
      <svg class="icon theme-icon theme-icon-dark"><use xlink:href="#brightness-2"></use></svg>
      <svg class="icon theme-icon theme-icon-light"><use xlink:href="#white-balance-sunny"></use></svg>
      <span class="theme-text">System theme</span>
    </a>
  </nav>
</footer>      <div class="modal-overlay">
  <div class="modal modal-search">
    <div class="form-wrapper">
      <input class="modal-input search-input" type="search" placeholder="Enter keyword...">
      <button class="form-button search-button">
        <svg class="icon icon-search"><use xlink:href="#magnify"></use></svg>
        <svg class="icon icon-close"><use xlink:href="#window-close"></use></svg>
      </button>
    </div>
        <div class="popular-wrapper">
          <h4 class="popular-title">Popular tags</h4>
          <div class="popular-feed">
              <a class="popular" href="/tag/tech/">tech</a>
              <a class="popular" href="/tag/self-tracking/">self-tracking</a>
              <a class="popular" href="/tag/offtopic/">offtopic</a>
          </div>
        </div>
    <div class="search-result"></div>
  </div>
  <button class="button-icon modal-close">
    <svg class="icon icon-close"><use xlink:href="#window-close"></use></svg>
  </button>
</div>      <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
  <!-- Background of PhotoSwipe. 
        It's a separate element as animating opacity is faster than rgba(). -->
  <div class="pswp__bg"></div>

  <!-- Slides wrapper with overflow:hidden. -->
  <div class="pswp__scroll-wrap">
      <!-- Container that holds slides. 
          PhotoSwipe keeps only 3 of them in the DOM to save memory.
          Don't modify these 3 pswp__item elements, data is added later on. -->
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>

    <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
    <div class="pswp__ui pswp__ui--hidden">
      <div class="pswp__top-bar">
        <!--  Controls are self-explanatory. Order can be changed. -->
        <div class="pswp__counter"></div>

        <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
        <button class="pswp__button pswp__button--share" title="Share"></button>
        <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
        <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

        <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
        <!-- element will get class pswp__preloader--active when preloader is running -->
        <div class="pswp__preloader">
          <div class="pswp__preloader__icn">
            <div class="pswp__preloader__cut">
              <div class="pswp__preloader__donut"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
        <div class="pswp__share-tooltip"></div> 
      </div>

      <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
      <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button>

      <div class="pswp__caption">
        <div class="pswp__caption__center"></div>
      </div>
    </div>
  </div>
</div>    </div>
  </div>

  <script>
    var body = document.querySelector('body');
    if (window.innerWidth > body.clientWidth + 5) {
      document.documentElement.style.setProperty('--scrollbar', (window.innerWidth - body.clientWidth) + 'px');
    }
  </script>

  <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous">
  </script>
  <script src="/assets/js/main.min.js?v=67116d8245"></script>


  
</body>
</html>
